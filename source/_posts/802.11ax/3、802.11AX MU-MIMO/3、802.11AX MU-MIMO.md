---
title: 802.11AX MU-MIMO
tags: WIFI
categories: WIFI
abbrlink: 7394c9cb
date: 2021-06-07 03:00:00
---

[TOC]

# 简介

MU-MIMO是基于多天线技术的，这个技术的物理层是多天线技术。多天线可以实现多种技术，不仅仅是MU-MIMO，如下图所示：

![img](https://pic2.zhimg.com/80/v2-7b82d624afda64bdea78879ad6778095_720w.jpg)参考：aruba的802.11ax白皮书

上图中，我们可以看到多天线可以做CSD，TxBF，STBC，SDM，MRC等等，这些技术全部在802.11协议中都有应用。这里细节很多，本文不展开了，相关技术我可能会在该技术用到地方再提到。

MU-MIMO的实现是结合波束成型的，波束成型有两种实现方式，一种是智能天线波束成型，一种是基于全向天线的波束成型。在CWNA一书中，已经给出了其定义。

具体描述如原文：

![img](https://pic4.zhimg.com/80/v2-64e5de8582d187bdf1c3e1eff95959bf_720w.jpg)

翻译版：

![img](https://pic2.zhimg.com/80/v2-81e50acb85a337098fd811a4501e81fd_720w.jpg)

MIMO包含2D-MIMO和3D-MIMO两种，目前5G NR已经有3D-MIMO的波束了，Wi-Fi 6里面还停留在2D-MIMO上。打个比方就是说利用定向天线，天线辐射可以参考手电筒打光，波束的概念就是从光束来的，手电筒打的光就是定向的光束，同理，定向天线辐射的信号就是定向的波束。如果发送和接收方同时用两个手电筒打信号，那么一次性就可以传递更多的信息，这种多天线的发送方式就是MIMO。

MIMO和全双工存在区别，MIMO模式下两根天线，只能够同时处于发送，或者接收状态。而全双工可以一根天线是发送状态，一根是接收状态。（PS：全双工也可以通过EBD之类的设备，一根天线实现全双工，这里不加以讨论）

MIMO的概念比较多，是针对多根天线而言的，主要是两个概念分集和复用。如果有多个通路的时候，比如有两个通路。我们可以简单理解如下，如果两个通路传同一个信息，那么就是分集。如果两个通路传两个不同的信息，那么就是复用。在802.11协议的相关培训书籍里面，这个概念实际上给的是比较粗的解释，MIMO 实际上是分集和复用结合的技术，波束成型是发送分集。

在我们常用的路由器中都是配备了全向天线。利用全向天线实现定向天线实际上是基于干涉抵消的机制来做的，通过预编码，让数据流通过两根天线具有一定的相位差发送出去，达到接收方接收功率叠加，或者干扰方接收功率抵消的效果。

预编码可以通过数字编码的形式添加相位差，目前Wi-Fi就是采用这一种。移动通信（比如LTE或者5G NR）里面方式多了一种是电相位差，是通过基带连接到RF这一段的线路上，通过线路的长度差异来做相位差。总之，有了相位差就可以做波束成型了。2维平面上的干涉抵消就是2D-MIMO，3维平面就是3D-MIMO了。

然后需要回顾下，基于MIMO技术，可以做到多发多收。基本的MIMO就是，一个发送者有两根天线，一个接受者有两根天线，发送者一次用两根天线发，接受者用两根天线收，然后两倍传输速率，这个就是802.11n时代做的MIMO技术。

![img](https://pic3.zhimg.com/80/v2-ed1f8f95958911e0579449cd1906e21e_720w.jpg)WRT54M路由

多天线不等于MIMO，在802.11g时代，就有多天线了，Cisco当时的经典路由WRT54M就是多天线的，但是这个不是做MIMO，是做天线选择（实际上也是分集的一种），一次只用一根天线发，但是有可能用左天线，有可能用右天线，也有可能交替（技术上这属于发送分集）。在DD-WRT下我们还可以看到这个选项，如下图

![img](https://pic3.zhimg.com/80/v2-793005cf8a37fcc70c933f571ca2443e_720w.jpg)DD-WRT的配置界面

MIMO是两根天线同时发，同时在物理上两根天线需要差半个波长距离，另外两根天线不能够发送相同的信息，要编码之后，否则就会存在默认的干涉效果，对通信无意义。经过预编码后，两根天线才可以同时发送（编码后的对应两根天线上的数据不同）。

LTE，5G NR和Wi-Fi相比，在波束这一块思想差不多，不过具体实现的时候取目标函数会有点区别，前两者可能偏向波束追踪，也就是目标接收功率最大化，Wi-Fi里面是偏向对其他人的干扰最小化（比如interference nulling技术），用干扰抵消的原理来说明，就是前两者偏向干涉叠加最大，后者偏向干涉抵消最强，这会影响一些预编码结构的设计。所以Wi-Fi强调的是多个波束覆盖到多个用户，各个用户之间不会进行干扰。

在Wi-Fi中，802.11ac仅仅支持下行的MU-MIMO传输。到802.11ax，也就是wi-fi 6以后才支持上行的MU-MIMO传输。

# MU-MIMO和OFDMA

在MAC层协议部分，MU-MIMO的传输和OFDMA传输的过程很像，都是一开始一个TF帧，然后开始一个传输。两个可以叠加，不过先导过程不一样。

- OFDMA过程的先导是BSRP,BSR过程，就是问缓存情况，然后做OFDMA资源分配。如果没有先导过程的话就是UORA，基于随机接入的竞争模式。协议中还有一个BQRP，类似于BSRP但是关注的参数不一样，这也是用来做资源分配预判的，这里就不展开了。
- MU-MIMO的先导过程是NDPA,NDP,beamforming reporting，这样的过程是一个测量过程，测量每一个节点的信道状态，也就是CSI，然后基于该CSI做预编码（协议里面要旋转矩阵）。

同时我们需要注意的是，这两个先导机制都包含了主动模式和被动模式（也就是隐式反馈的模式），这也说明了两者在MAC层协议上的类似性。

![img](https://pic1.zhimg.com/80/v2-a6f2cf307f37c45d32e1c538306c12ec_720w.jpg)NDP过程

另外这两个先导的过程，NDP和BSR过程也可以结合起来一起使用，如下图

![img](https://pic1.zhimg.com/80/v2-7ba685ee6b0c0c4bb624693650913d18_720w.jpg)参考：Aruba的802.11ax白皮书

有了测量矩阵才可以做编码，所以MI-MIMO会做这样的过程。协议没有给定BSR，NDP这样的测量过程和传输过程的关系，所以不是每一次传输都需要测量一次，可选，也可不选。测量周期也是给开发商自己搞定的。关于NDP过程而言，其实与应用场景有关，Wi-Fi大概是100ms左右就可以了，这个从理论上有一个概念，叫做海森堡时间。

![img](https://pic2.zhimg.com/80/v2-9b6638ec2f970435122174f0bdcf87a9_720w.jpg)参考：802.11ac: A Survival Guide

然后有了BSP和NDP过程后，就可以执行一次传输了。这个传输过程内，可以做MU-MIMO，可以做OFDMA，也可以做OFDMA+MU-MIMO，协议不规定，给开发商自己折腾的。但是前提是要先导过程，有获取了足够信息。

还有点需要注意的是，目前Wi-Fi协议都是任意长数据帧的，不像LTE，5G NR一样，始终是按照一个小资源片的时间封帧，也就是其帧，半帧之类大小都是固定的，所以没有帧长度不等的问题。

Wi-Fi中只有一个最大帧传输时间和最大帧长度的限制，这个大小随着协议演进过程中是有变化的。下图所示是截至802.11ac目前的最大值：

![img](https://pic1.zhimg.com/80/v2-91f9ce48c6ffd8c1174b1608636a92a0_720w.jpg)参考：802.11-2016版本

在Wi-Fi中，由于是多用户同时传输，无论上行还是下行，都是存在帧长度不等的。一个基本思想是补，补随机的东西弄到长度相等。在802.11ac里面，由于只有下行发送，所以发送时间是按照最长帧来的，其他短的不够就补。在802.11ax里面，由于引入上行传输，那么传输时间是AP猜的，根据BSR之类的信息来猜的，所以这段时间有可能会长，长就补0，如果短的话，那么引入了一个新概念，就是动态帧切片，把帧给切短了，然后发送。以上这点在动态帧切换中我们已经讨论过了，所以这里就不展开了。
