<!DOCTYPE html>
<html>
  



<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <!-- Global site tag (gtag.js) - Google Analytics -->


  <title>802.11ax | 灵溪驿站</title>

  
    
<link rel="stylesheet" href="/js/aos/aos.css">

  

  <link rel="icon" type="image/png" href="/medias/logo.png">
  <link rel="stylesheet" href="https://at.alicdn.com/t/font_1911880_c1nvbyezg17.css">
  <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  
    <script>
        var themeModelId = '1';
        if (themeModelId) {
            localStorage.setItem('modelId', themeModelId);
        }
    </script>
    
    <script src="/js/live2d/autoload.js"></script>
    <script>
        var live2dOpen = eval('true') || false;
        if (!live2dOpen) {
            localStorage.setItem('waifu-display', 1609323474481);
        }
    </script>
  
  
<link rel="stylesheet" href="/css/animate.min.css">

  
<link rel="stylesheet" href="/css/style.css">

  
  
    
<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="/js/shareJs/share.min.css">

  
  <style>
        @media (max-width: 992px) {
            #waifu {
                display: none;
            }
        }
    </style>
    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="灵溪驿站" type="application/atom+xml">
</head>

  <script src="/js/jquery3.5.1.js"></script>
  <script src="/js/vue2.6.11.js"></script>
  <link href="/js/danmu/barrager.css" rel="stylesheet">
<script src="/js/danmu/jquery.barrager.js"></script>
  <body>
    <!-- 判断是否为黑夜模式 -->
    <script>
      let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');

      if (isDark) {
        $(document.body).addClass('darkModel');
      }
    </script>

    <header class="header bg-color" 
  style="position: fixed; 
  left: 0; top: 0; z-index: 10;width: 100%;"
>
  <div class="header-content">
    <div class="bars">
      <div id="appDrawer" class="sidebar-image">
  <i class="fa fa-bars" aria-hidden="true" @click="showDialogDrawer"></i>
  <transition name="fade">
    <div class="drawer-box_mask" v-cloak style="display: none;" v-show="visible" @click.self="cancelDialogDrawer">
    </div>
  </transition>
  <div class="drawer-box" :class="{'active': visible}">
    <div class="drawer-box-head bg-color">
      <img class="drawer-box-head_logo" src="/medias/logo.png" alt="logo">
      <h3 class="drawer-box-head_title">灵溪驿站</h3>
      <h5 class="drawer-box-head_desc">千磨万击还坚劲，任尔东西南北风</h5>
    </div>
    <div class="drawer-box-content">
      <ul class="drawer-box-content_menu">
        
          <li class="drawer-box-content_item">
            <a href="/" class="menu-item-link">
              
                <i class="fa fa-home" aria-hidden="true"></i>
              
              <span>首页</span>
            </a>
          </li>
        
          <li class="drawer-box-content_item">
            <a href="/archives" class="menu-item-link">
              
                <i class="fa fa-home" aria-hidden="true"></i>
              
              <span>归档</span>
            </a>
          </li>
        
          <li class="drawer-box-content_item">
            <a href="/tags" class="menu-item-link">
              
                <i class="fa fa-tags" aria-hidden="true"></i>
              
              <span>标签</span>
            </a>
          </li>
        
          <li class="drawer-box-content_item">
            <a href="/categories" class="menu-item-link">
              
                <i class="fa fa-bookmark" aria-hidden="true"></i>
              
              <span>分类</span>
            </a>
          </li>
        
          <li class="drawer-box-content_item">
            <a href="/about" class="menu-item-link">
              
                <i class="fa fa-user" aria-hidden="true"></i>
              
              <span>关于</span>
            </a>
          </li>
        
          <li class="drawer-box-content_item">
            <a href="/friends" class="menu-item-link">
              
                <i class="fa fa-link" aria-hidden="true"></i>
              
              <span>友情链接</span>
            </a>
          </li>
        
        <li class="drawer-box-content_item">
          <a target="_blank" rel="noopener" href="https://github.com/flyghost">
            <i class="fa fa-github" aria-hidden="true"></i>
            <span>Github</span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDrawer',
    data: {
      visible: false,
      top: 0,
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'width: 100%; height: 100%; position: fixed; top: -' + this.top  + 'px; left: 0; overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      }
    },
    created() {}
  })
</script>
    </div>
    <div class="blog-title" id="author-avatar">
      <div class="avatar">
        <img src="/medias/logo.png" alt="logo">
      </div>
      <a href="/" class="logo">灵溪驿站</a>
    </div>
    <nav class="navbar">
      <ul class="menu">
        
          <li class="menu-item">
            <a href="/" class="menu-item-link">
              
                <i class="fa fa-home" aria-hidden="true"></i>
              
              <span>首页</span>
            </a>
          </li>
        
          <li class="menu-item">
            <a href="/archives" class="menu-item-link">
              
                <i class="fa fa-archive" aria-hidden="true"></i>
              
              <span>归档</span>
            </a>
          </li>
        
          <li class="menu-item">
            <a href="/tags" class="menu-item-link">
              
                <i class="fa fa-tags" aria-hidden="true"></i>
              
              <span>标签</span>
            </a>
          </li>
        
          <li class="menu-item">
            <a href="/categories" class="menu-item-link">
              
                <i class="fa fa-bookmark" aria-hidden="true"></i>
              
              <span>分类</span>
            </a>
          </li>
        
          <li class="menu-item">
            <a href="/about" class="menu-item-link">
              
                <i class="fa fa-user" aria-hidden="true"></i>
              
              <span>关于</span>
            </a>
          </li>
        
          <li class="menu-item">
            <a href="/friends" class="menu-item-link">
              
                <i class="fa fa-link" aria-hidden="true"></i>
              
              <span>友情链接</span>
            </a>
          </li>
        
      </ul>
      
        <div class="dark">
  <div class="dark-content">
    <i class="fa fa-moon-o" aria-hidden="true"></i>
    <!-- <span>关灯</span> -->
  </div>
  
</div>

<script>
  $(function() {
    let isDark = JSON.parse(localStorage.getItem('dark'))  || JSON.parse('false');
    if (isDark) {
      $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fa fa-lightbulb-o" aria-hidden="true"></i>
          </div>
          `
        );
    }
    $('.dark').click(function() {
      if ($(document.body).is('.darkModel')) {
        $(document.body).removeClass('darkModel');
        localStorage.setItem('dark', false);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fa fa-moon-o" aria-hidden="true"></i>
          </div>
          `
        );
      } else {
        $(document.body).addClass('darkModel');
        localStorage.setItem('dark', true);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fa fa-lightbulb-o" aria-hidden="true"></i>
          </div>
          `
        );
      }
    })
  })
</script>
        
      
        <div id="appSearch">
  <div class="search"  @click="showDialog()"><i class="fa fa-search" aria-hidden="true"></i></div>
  <transition name="fade">
    <div class="message-box_wrapper" style="display: none;" v-cloak v-show="dialogVisible" @click.self="cancelDialogVisible()">
      <div class="message-box animated bounceInDown">
        <div class="close" style="overflow: hidden;">
          <i class="fa fa-close" aria-hidden="true" style="float:right;" @click.self="cancelDialogVisible()"></i>
        </div>
        <h2>
          <i class="fa fa-search" aria-hidden="true"></i>
          <span class="title">本地搜索</span>
          <!-- <i class="fa fa-close" style="float:right;" aria-hidden="true" @click.self="cancelDialogVisible()"></i> -->
        </h2>
        <form class="site-search-form">
          <input type="text"
            placeholder="请输入关键字"
            id="local-search-input" 
            @click="getSearchFile()"
            class="st-search-input"
            v-model="searchInput"
          />
        </form>
        <div class="result-wrapper">
          <div id="local-search-result" class="local-search-result-cls"></div>
        </div>
      </div>
    </div>
  </transition>
</div>
<script src="/js/local_search.js"></script>
<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appSearch',
    data: {
      dialogVisible: false,
      searchInput: '',
      top: 0,
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      showDialog() {
        this.dialogVisible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'overflow: hidden;';
      },
      getSearchFile() {
        if (!this.searchInput) {
          getSearchFile("/search.xml");
        }
      },
      cancelDialogVisible() {
        this.dialogVisible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
    },
    created() {}
  })
</script>
<!-- 解决刷新页面闪烁问题，可以在元素上添加display: none, 或者用vue.extend方法，详情：https://blog.csdn.net/qq_31393401/article/details/81017912 -->
<!-- 下面是搜索基本写法 -->
<!-- <script type="text/javascript" id="local.search.active">
  var inputArea = document.querySelector("#local-search-input");
  inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
  inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script> -->

      

    </nav>
  </div>
  
  <a target="_blank" rel="noopener" href="https://github.com/flyghost" class="github-corner color-primary" aria-label="View source on GitHub"><svg width="60" height="60" viewBox="0 0 250 250" style="fill:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  
    <div id="he-plugin-simple"></div>
    <script>
      WIDGET = {
        CONFIG: {
          "modules": "012",
          "background": 5,
          "tmpColor": "4A4A4A",
          "tmpSize": 16,
          "cityColor": "4A4A4A",
          "citySize": 16,
          "aqiSize": 16,
          "weatherIconSize": 24,
          "alertIconSize": 18,
          "padding": "10px 10px 10px 10px",
          "shadow": "1",
          "language": "auto",
          "borderRadius": 5,
          "fixed": "false",
          "vertical": "middle",
          "horizontal": "center",
          "key": "2784dd3fcb1e4f0f9a9b579bf69641f2"
        }
      }
    </script>
    <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script> 
    
</header>
    <main class="main" style="margin-top: 60px;">
      
 <!-- prismjs 代码高亮 -->
 

<div class="bg-dark-floor" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -1;"></div>
<div id="appBgSwiper" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -2;" :style="{'background-color': bgColor ? bgColor : 'transparent'}">
    <transition-group tag="ul" :name="names">
        <li v-for='(image,index) in img' :key='index' v-show="index === mark" class="bg-swiper-box">
            <img :src="image" class="bg-swiper-img">
        </li>
    </transition-group>
</div>
<script>
    var vm = new Vue({
        el: '#appBgSwiper',
        data: {
            names: '' || 'fade' || 'fade', // translate-fade fade
            mark: 0,
            img: [],
            bgColor: '',
            time: null
        },
        methods: {   //添加方法
            change(i, m) {
                if (i > m) {
                    // this.names = 'fade';
                } else if (i < m) {
                    // this.names = 'fade';
                } else {
                    return;
                }
                this.mark = i;
            },
            prev() {
                // this.names = 'fade';
                this.mark--;
                if (this.mark === -1) {
                    this.mark = 3;
                    return
                }
            },
            next() {
                // this.names = 'fade';
                this.mark++;
                if (this.mark === this.img.length) {
                    this.mark = 0;
                    return
                }
            },
            autoPlay() {
                // this.names = 'fade';
                this.mark++;
                if (this.mark === this.img.length) {
                    this.mark = 0;
                    return
                }
            },
            play() {
                let bgImgDelay = '' || '180000'
                let delay = parseInt(bgImgDelay) || 180000;
                this.time = setInterval(this.autoPlay, delay);
            },
            enter() {
                clearInterval(this.time);
            },
            leave() {
                this.play();
            }
        },
        created() {
            this.play()
        },
        beforeDestroy() {
            clearInterval(this.time);
        },
        mounted() {
            let prop = ''|| '/medias/post_background.png';
            let isImg = prop.includes('.bmp') || prop.includes('.jpg') || prop.includes('.png') || prop.includes('.tif') || prop.includes('.gif') || prop.includes('.pcx') || prop.includes('.tga') || prop.includes('.exif') || prop.includes('.fpx') || prop.includes('.psd') || prop.includes('.cdr') || prop.includes('.pcd') || prop.includes('.dxf') || prop.includes('.ufo') || prop.includes('.eps') || prop.includes('.ai') || prop.includes('.raw') || prop.includes('.WMF') || prop.includes('.webp') || prop.includes('.jpeg')
            if (isImg) {
                let img = prop.split(',');
                let configRoot = '/'
                let arrImg = [];
                img.forEach(el => {
                    var Expression=/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/;
			        var objExp = new RegExp(Expression);

                    if(objExp.test(el)) {
                        // http or https
                        arrImg.push(el);
                    } else {
                        // 非http or https开头
                        // 本地文件
                        let firstStr = el.charAt(0);
                        if (firstStr == '/') {
                            el = el.substr(1); // 删除第一个字符 '/',因为 configRoot最后一个字符为 /
                        }
                        el = configRoot + el;
                        arrImg.push(el);
                    }
                })
                this.img = arrImg;
            } else {
                this.bgColor = prop;
            }
        }
    })
</script>

<style>
    .bg-swiper-box {
        position: absolute;
        display: block;
        width: 100%;
        height: 100%;
    }
    .bg-swiper-img {
        object-fit: cover;
        width: 100%;
        height: 100%;
    }
</style>



<div class="post-detail-header lazyload" id="thumbnail_canvas" data-original="/medias/5.jpg" style="background-repeat: no-repeat; background-size: cover; 
  background-position: center center;position: relative;">
  <div class="post-detail-header-mask"></div>
  <canvas id="header_canvas"style="position:absolute;bottom:0"></canvas>
  
    <div class="title-box">
      
        <span class="title" id="post-detail-header-title"></span>
        <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>
          <script>
            var typed = new Typed("#post-detail-header-title", {
              strings: ['802.11ax'],
              startDelay: 100,
              typeSpeed: 100,
              loop: false,
              backSpeed: 50,
              showCursor: false
            });
          </script>
        
    </div>
  
  
  
    <script src="/js/bubble/bubble.js"></script>
  
</div>


<div class="row justify-position">
  <div class="main-content">
    <article class="post post-detail">
      
      
      <div class="post-meta">
        <i class="fa fa-clock-o" aria-hidden="true"></i>
        <span class="post-time">2021-04-01</span>
      </div>
      
      <div class="post-tags-categories">
        
        <div class="tags">
          <i class="iconfont icontag"></i>
          
            <a href="/tags/WLAN/" class="">
              WLAN
            </a>
          
        </div>
        
        
        <div class="categories">
          <i class="iconfont iconbookmark1"></i>
          
            <a href="/categories/wifi6/" class="">
              wifi6
            </a>
          
        </div>
        
      </div>
      <div class="post-content">
        <p>[TOC]</p>
<h1 id="协议简介">1 协议简介</h1><h2 id="序言">1.1 序言</h2><p>参考资料：</p>
<p><a target="_blank" rel="noopener" href="https://www.ni.com/zh-cn/innovations/white-papers/16/introduction-to-802-11ax-high-efficiency-wireless.html">Introduction to 802.11ax High-Efficiency Wireless</a></p>
<p><a target="_blank" rel="noopener" href="https://forum.huawei.com/enterprise/zh/forum.php?mod=viewthread&tid=639329">WLAN从入门到精通-WIFI6</a></p>
<p><a target="_blank" rel="noopener" href="https://www.extremenetworks.com/wifi6/what-is-80211ax/">What is 802.11ax (Wi-Fi 6)?</a></p>
<h2 id="什么是wifi6">1.2 什么是wifi6</h2><p>说起Wi-Fi 6，其实是Wi-Fi联盟对IEEE的最新一代无线局域网标准802.11ax的命名。<br>这里面讲到了2个组织IEEE和Wi-Fi联盟。</p>
<p>首先介绍一下电气和电子工程师协会IEEE（Institute of Electrical and Electronics Engineers）。</p>
<p><img src="/posts/f22bd777/151355ph5nyjtdkb8frbxt.png" alt="Institute of Electrical and Electronics Engineers"></p>
<p>IEEE作为标准组织，通信人应该非常了解，有兴趣可以百度一下。在该组织制定的一系列标准中，通信人最熟悉802.3标准对应以太网，而属于无线局域网的就是802.11。早在1990年，IEEE就已经成了802.11工作组用来制定无线局域网的相关标准，并在1997年发布了第一个标准802.11-1997。之后的每4-5年，802.11标准就会升级换代一次，至今已有6代。</p>
<p><img src="/posts/f22bd777/151043pqg616mmve8a3q1j.png" alt="802.11升级过程"></p>
<p>而另一个组织，Wi-Fi联盟（英语全称Wi-Fi Alliance，简称WFA），其实是一个商业组织，这个联盟最初的目的是为了推动802.11b标准的制定，并在全球范围内推行Wi-Fi产品的兼容认证。兼容认证其实非常重要，因为802.11标准是很理论化，一旦产品化，每家厂商有可能会做的五花八门，所以Wi-Fi联盟所要解决的就是不同厂家的兼容性，此外Wi-Fi联盟还负责产品测试等工作。</p>
<p><img src="/posts/f22bd777/152808aef9ogfirof0r5hc.png" alt="Wi-Fi Alliance"></p>
<p>我们现在熟悉的大部分手机厂商、部分运营商都是这个联盟的成员。<br>而我们常常说的Wi-Fi，实际上就是来自Wi-Fi联盟的商标。Wi-Fi联盟把符合802.11标准技术统一称为Wi-Fi。</p>
<p>2018年，为了方便记忆和理解，Wi-Fi联盟终于决定抛弃之前802.11n、802.11ac等专业标准名称，仿照移动通信中代际3G、4G、5G的划分，将现有标准简化为数字命名。</p>
<p><img src="/posts/f22bd777/151136t23q4r4mx21b2tq3.png" alt="WiFi数字命名"></p>
<h2 id="802-11ax简介">1.3 802.11ax简介</h2><p>802.11ax是在802.11ac以后，无线局域网协议本身的进一步扩展，可以当做ac以后的一个直系版本。其初始的命名代号为HEW（High Efficiency WLAN ），该起始于2013年。</p>
<p>802.11ax的使用场景关注于密集用户环境（Dense User Environments），与之前的协议有所不同。根据香农定理<img src="https://www.zhihu.com/equation?tex=C=Blog_%7B2%7D+%5Cleft(+1+SNR+%5Cright)+" alt="香农定理">而言，当SNR不变的情况下（由于发送机总功率是固定的），只要适当的增加带宽，就可以获得更高的物理层吞吐量。所以802.11a/b/g/n/ac的演进，一般都是关注在单AP的网络中，提高物理层的吞吐量，以提高网络的整体速率。</p>
<p>802.11ax的设计场景初始关注的就是密集环境，换言之，其初始设计思想就会和传统的802.11存在一定的区别。而且802.11ax的设计也并没有在当前802.11ac的160M带宽以上，新增更大的带宽（其实也是在2.4G和5G频谱资源下，无法找到更大带宽的信道）。所以协议命名的HEW，其关注的效率，也是希望更加有效的使用当前的频段资源，从而提供更高的实际网络速率。我们可以简单总结802.11ax的以下特点：</p>
<h3 id="协议兼容性">1.3.1 协议兼容性</h3><p>802.11ax要求与以往的802.11a/b/h/n/ac都进行兼容，这也证明了其是第二款同时能工作在2.4G和5G频段下的协议（802.11ac仅工作在5G频段）。故在其数据帧结构和MAC接入协议上，都需要兼容设计，以便于传统协议兼容。</p>
<h3 id="更高的速率">1.3.2 更高的速率</h3><p>过去每一代Wi-Fi的标准，一直致力于提升速率。</p>
<p><img src="/posts/f22bd777/151155agcncgezdghaappp-7762481.png" alt="WiFi不同版本的最高速率"></p>
<p>经过20多年的发展，Wi-Fi 6（802.11ax）在160MHz信道宽度下，理论最大速率已经达到9.6Gbps，是802.11b的近900倍。</p>
<p>而Wi-Fi 6速率的提升是因为采用了更高阶的1024-QAM、更多的子载波等技术。</p>
<p>① <strong>提供更高阶的编码组合</strong>（MCS10和MCS11）。其中主要是QAM-1024的引入，在802.11ac中，最高阶是256QAM。</p>
<p><img src="/posts/f22bd777/v2-23e7a0aea03ab5cf9979acfe80272789_720w.png" alt="QAM-1024"></p>
<p>  ② <strong>在相同带宽下，802.11ax采用点数更多的FFT</strong>（即原始的FFT的4倍大小）。FFT点数越多，说明其子载波数越多，以及子载波的带宽也就越小（带宽从312.5kHz降到78.125kHz。其对应的symbol时间也增加了4倍），从而可以覆盖更远的范围。（覆盖范围与相干带宽有关。只要信道的带宽小于相干带宽的话，那么就是平坦衰落，信号不会受到多径的影响。所以越小的信道带宽，可以覆盖更远的范围）</p>
<p><img src="/posts/f22bd777/v2-693acb951a420a431164d2b9eac7c78b_720w.png" alt="fft"></p>
<h3 id="高并发">1.3.3 高并发</h3><p>  ① <strong>引入上行MU-MIMO</strong>。</p>
<p>Wi-Fi 6引入了5G中的OFDMA和上行MU-MIMO等多用户技术，进一步提升了频谱利用率，使得Wi-Fi 6相比于Wi-Fi 5，并发用户数提升了<strong>4倍</strong>。</p>
<p><img src="/posts/f22bd777/151218yltjwjnt116ry6gr.png" alt="WiFi5和WiFi6的并发性"></p>
<p>在802.11ac中，协议只规定了下行的MU-MIMO。上行还是单个节点独立传输的，而在802.11ax中，上下行都需要支持MU-MIMO。</p>
<p><img src="/posts/f22bd777/v2-c38c6eac16d6a23c4deeacdbbb34808c_720w.png" alt="MU-MIMO"></p>
<p>  ② <strong>引入OFDMA技术</strong>。802.11ax设计中参考了LTE中OFDMA的使用，可以让多个用户通过不同子载波资源同时接入信道，提高信道的利用率。不过因为802.11是一个分布式接入的场景，所以802.11ax中的OFDMA实际是比LTE中复杂度要低一些。</p>
<p><img src="/posts/f22bd777/v2-8a40e3e461980dd315b5d08ce8d88894_720w.png" alt="OFDMA"></p>
<p>至于其中一些具体的介绍和一些其他的特性，建议参考NI的文章：<a target="_blank" rel="noopener" href="https://www.ni.com/zh-cn/innovations/white-papers/16/introduction-to-802-11ax-high-efficiency-wireless.html">Introduction to 802.11ax High-Efficiency Wireless</a>。</p>
<h3 id="更好的节能性">1.3.4 更好的节能性</h3><p>用以增加移动设备的续航能力</p>
<p>随着IoT设备广泛应用，除了提升终端速率外，Wi-Fi 6更是关注了终端的耗电情况。</p>
<p>Wi-Fi 6采用TWT技术，按需唤醒终端Wi-Fi，加上20MHz-Only技术，使得终端的功耗降低**30%**。</p>
<p><img src="/posts/f22bd777/151248d0fxmtavpramxrty.png" alt="功耗对比"></p>
<h3 id="降低时延">1.3.5 降低时延</h3><p>在低时延场景，例如VR/AR-互动操作模拟、全景直播、互动式游戏、沉浸式会议、高清无线投屏等，Wi-Fi 5的30ms时延已经无法满足需求，而Wi-Fi因为引入了OFDMA和空间复用技术BSS Coloring，令时延降低至<strong>20ms</strong>。</p>
<p><img src="/posts/f22bd777/151234uza8ce4hd7mvz8ha.png" alt="WiFi5和WiFi6时延"></p>
<h1 id="OFDMA">2 OFDMA</h1><h2 id="序言-1">2.1 序言</h2><p>参考资料：</p>
<p><a target="_blank" rel="noopener" href="https://www.extremenetworks.com/extreme-networks-blog/">What are OFDMA Resource Units in 802.11ax?</a></p>
<p><a href="/books/Wi-Fi_6_FD_Extreme_Networks_Special_Edition.pdf">Wi-Fi_6_FD_Extreme_Networks_Special_Edition</a></p>
<p><a href="/books/Draft_P802.11ax_D8.0.pdf">Draft P802.11ax_D8.0.pdf</a>第27.3.2节(Subcarrier and resource allocation)</p>
<p><a target="_blank" rel="noopener" href="https://www.extremenetworks.com/extreme-networks-blog/ofdm-and-ofdma-subcarriers-what-are-the-differences/">OFDM and OFDMA Subcarriers – What Are the Differences?</a></p>
<h2 id="简介">2.2 简介</h2><p>无线和有线通信不同。有线通信中信息是承载在线缆上，通过高低电平来标识不同的信息010010。但是在无线通信中，信息的载体就变成了高频信号，这种将信息加载到某个高频信号进行传播的过程就叫做载波调制，而承载着信息的高频信号，我们也称之为载波。拿日常生活中的例子来说，Wi-Fi通信类似快递送货，载波就像是送货的小车，发送方通过载波调制将货物(信息)放到小车上再送达到接收方。</p>
<img src="/posts/f22bd777/093931auljualk348u3gik.png" alt="载波调制" style="zoom:50%;">

<p>不过这些频段不仅Wi-Fi可以用，其他短距无线传输技术比如RFID、蓝牙等，也都可以使用，所以干扰也很多。</p>
<p>在Wi-Fi 4/5，载波调制用的是正交频分复用OFDM（Orthogonal Frequency Division Multiplexing）技术。</p>
<p>OFDMA技术是802.11ax引入了新的物层机制，其可以让多个用户并行进行接入。</p>
<p>由于引入了OFDMA技术，所以需要定义时频资源块（Resource Unit）的概念，这些时频资源块都是彼此正交的。802.11ax中的OFDMA实际上是借鉴LTE的，但是没有LTE资源块那么复杂（比如RE，RB，CP，REG，CCE这些），802.11ax中仅仅有RU（Resource unit）的概念。</p>
<p><img src="/posts/f22bd777/v2-87a082c97fe8b36c6bd5332b36366737_720w.png" alt="OFDMA"></p>
<p>以上图为例，左图是OFDM的工作模式，右图是OFDMA的工作模式。图中一共有4个节点，分别以4种颜色进行标识。图中横轴为时域，纵轴为频域（即对应不同的子载波）。</p>
<ul>
<li><strong>OFDM工作模式</strong>（左图）：用户是通过不同时间区分出来的。每一个时间片段，一个用户完整占据全部的子载波，并且发送一个完整的数据包（如图中红色部分标出的WLAN Packet）。</li>
<li><strong>OFDMA工作模式</strong>（右图）：用户是根据时频资源块RU区分出来的。首先将整个信道的资源分成一个个小的固定大小的时频资源块，这个时频资源块也就是RU（Resource unit）。在该模式下，用户的数据是承载在每一个RU上的，故从总的时频资源上来看，每一个时间片上，有可能有多个用户同时发送。</li>
</ul>
<p>OFDMA相比OFDM一般有两点好处：</p>
<ul>
<li><strong>资源的更细腻分配</strong>。特别是在部分节点信道状态不太好的情况下，可以根据注水定理的思想（即根据信道质量分配发送功率），来更细腻化的分配信道时频资源</li>
<li><strong>能够更好的提供QOS</strong>。因为初始的802.11是占据整个信道的，如果有一个QOS数据包需要发送，其一定要等之前的发送者释放完整个信道才行，所以会存在较长的延迟。在OFDMA的情况下，由于一个发送者只占据部分信道，所以能够减少QOS节点接入的延迟。</li>
</ul>
<p>拿小车来举例，OFDMA相当于在小车中划出专门的隔间，通过调度每个隔间放置不同用户的货物，这样一次可以为多个接收方送货。</p>
<img src="/posts/f22bd777/093958hy2qj6spsqo4akzj.png" alt="OFDMA比喻" style="zoom:50%;">

<p>OFDMA没有多天线的要求，在单天线条件下，也可以做到OFDMA。</p>
<p>资源片段会根据需求被分配到各个用户上。这里要区分上下行，如果是下行的话，那么AP直接发送一个数据帧即可，当然，该帧内部的资源映射关系是提前告知用户的，Wi-Fi帧中是通过Trigger帧告知。用户实际上可以解调所有的信息，即全部片段都可以解调，然后根据映射关系，选取自己的信息即可。安全性是通过数据层的加密完成的。</p>
<p>上行的话，Wi-Fi是允许上行的OFDMA。OFDM有一个问题就是PAPR，峰均比，也就是所有的子载波由于是周期成倍数关系的，所以如果所有子载波都是加载相同数据的时候，出来的峰值就是所有子载波上单位峰值的叠加。如果大家都是1，那么这个1冲到很高，如果大家都是0，那么就是0，换言之是0（打个比方，虽然传输的时候是用双极性的，所以不会有0的存在）。（这样峰值和均值的区间很大，就会对放大器的工作区有要求)</p>
<ul>
<li>LTE子载波多，一共2048个，所以峰均比空间大，最后就没有采用OFDMA做上行。LTE的上行是SC-FDMA。主要原因是PAPR高，但是不是技术不可行，是相应实现时候，PA需要更高的成本，以及会产生更高的功耗。</li>
<li>Wi-Fi子载波最多256个（上述都是在20MHz信道带宽下），所以峰均比还可以承受，所以上行可以允许OFDMA。</li>
</ul>
<p>目前OFDMA在Wi-Fi 6里面是一次性添加了上行和下行，下行在整个接入过程中很简单，AP抢到的信道，然后发送即可。上行接入的时候包含了有两种接入方式，一共是基于竞争的（就是UORA），一种是基于非竞争的，也就是基于BSR的，缓存情况，根据节点的缓存情况，AP进行资源分配，然后告知。其实搞两种接入方式也是和LTE类似的，LTE中在PRACH信道上也有两种接入模式，基于竞争和基于非竞争，基于竞争的是随机选择竞争序列（也就是竞争所采用的Code），而非竞争的则是通过eNodeB指定。这点上LTE和WiFi 6在框架上是类似的。</p>
<p>在这里还需要注意的一个是，OFDMA和CDMA一样，存在远近效应。其含义是接收方，也就是AP，在接收信号的时候，需要所有节点发送到AP处的信号功率，近似相等。如果功率差异过大，那么就不能够很好解调了。（功率差异大就是用SIC技术，而不是OFDMA技术了）。</p>
<p>所以在上行发送的时候，触发帧实际上包含了三个重要信息，1）资源分配，2）发送速率指定，3）功率指定。通过以上技术，在OFDMA的场景下，Wi-Fi基本和LTE能够做到的差不多了，精准的频谱资源分配。</p>
<h2 id="子载波">2.3 子载波</h2><p>在传统的802.11a/g/n/ac中，采用了正交频分复用（OFDM，Orthogonal Frequency Division Multiplexing）作为单用户传输的物理层技术。</p>
<p>在802.11ax中，引入了一种新型的基于OFDM的OFDMA技术，其是OFDMA对应的多用户版本，其将信道划分成更小的时频资源单元，即RU（Resource Unit）。</p>
<p>通过OFMDA的划分，多个用户可以并行进行传输，提高信道利用率。</p>
<p>每一个RU内的数据和导频，在OFDMA子信道内都是相邻而且连续的。</p>
<p>OFDM和OFDMA技术的实现是通过快速傅里叶变换（FFT）和快速傅里叶逆变换（IFFT）来构成的。</p>
<p>在OFDM中，信道被分成了多个子载波，每一个子载波是正交的，不会互相干扰，所以其子载波之间是没有保护间隔的。</p>
<p>在OFDM中，也会分配一个子载波作为Null子载波，其不承载任何数据，用来防止载波间干扰（Inter-Carrier Interference ，ICI）。</p>
<p>OFDM和OFDMA都通过一个数学函数（快速傅里叶逆变换）IFFT将信道划分为子载波。</p>
<p>如下图所示，802.11n/ac 20MHZ信道带宽包含64个子载波。其中52个子载波用于承载调制数据（data subcarriers），4个用于导频载波（pilot subcarriers），8个作为保护频带（grard bands）。每个OFDM子载波间隔为312.5KHZ，也就是3.2us。OFDM子载波可以称为OFDM subcarriers或者OFDM tones。</p>
<p><img src="/posts/f22bd777/image-20210412161728872.png" alt="802.11n/ac 20 MHz channel – OFDM subcarriers"></p>
<p>在802.11ax中，相同的信道带宽采用的FFT的点数增加4倍。比如原来20M信道采用64点的FFT（即64个子载波），现在就变成了256点的FFT（即256个子载波）。</p>
<p>OFDMA子载波间隔为78.125KHZ，也就是12.8us。因此如下图所示，由于存在78.125KHZ的间隔，OFDMA 20MHZ通道总共包含256个子载波（tone）。</p>
<blockquote>
<p>更窄的子载波间隔，允许会提供更高的频域分辨率，提升均衡能力，并且增强信道鲁棒性</p>
</blockquote>
<p><img src="/posts/f22bd777/image-20210412163150100.png" alt="OFDM and OFDMA subcarrier spacing"></p>
<p>类似于OFDM一样，OFDMA存在三种类型的子载波：</p>
<ul>
<li><strong>数据子载波</strong>（Data subcarriers）：这些子载波用于承载数据，其传输速率是在802.11ac的基础上（即在802.11ac的MCS上），引入了两个新的MCS（Modulation and Coding Schemes），包含1024-QAM这种更高的调制阶数。</li>
<li><strong>导频子载波</strong>（Pilot subcarriers）：这些子载波用于发射器和接收器之间的同步，并且不携带任何调制数据。</li>
<li><strong>未使用的子载波</strong>（Unused subcarriers）：剩余未使用的载波主要用于保护子载波（gard carriers）或者空子载波（null carriers），以抵抗来自相邻信道或相邻子信道的干扰（即抵抗ICI）。</li>
</ul>
<p>利用OFDMA，这些子载波组合在一起成为分区子信道，也成为资源单元（RU）。通过将信道进行进一步的细分，发送到多个用户的比较小帧可以同时传输。在OFDMA信道内，每个资源单元内的数据和导频子载波既相邻又连续。</p>
<blockquote>
<p>为了兼容早期的其他802.11协议，802.11ax仍将支持OFDM。在802.11ax中，管理帧和控制帧仍将使用802.11a/g/n/ac的OFDM技术，以及以基本的传输速率进行传输（一般就是最低传输速率），这保证了其他早期的802.11终端能够互相理解。此时管理帧和控制帧都是采用整个20MHz信道，利用整个64个子载波进行传输。OFDMA技术仅仅用于802.11ax AP和802.11ax终端之间的数据帧交互。</p>
</blockquote>
<p>在802.11ax中，20M信道一共有256个子载波，而实际资源块RU总共只使用了234个，两者相差了22个子载波。这些子载波是用来做保护间隔的：包含了DC，Null Sub-carriers以及Guard Sub-carriers，如下图：</p>
<p><img src="/posts/f22bd777/image-20210412143049142.png" alt="RU locations in a 20 MHz HE PPDU"></p>
<p>图中分别列举了RU为26,52,106个子载波的情况，我们具体解释如下：</p>
<ul>
<li><p><strong>DC保护</strong>：以<strong>中心子载波</strong>为核心，一共有7个子载波作为DC保护的，即DC的保护带宽一共是7*78.125kHz=546.875kHz，与原来的一个DC保护（即312.5kHz）是比较接近的。</p>
</li>
<li><p><strong>Guard Sub-carriers</strong>：保护子载波这里指的是<strong>信道之间的保护子载波</strong>了（比如20MHz信道之间的保护），如上图所示，其选取了左边的6个子载波以及右边的5个子载波作为保护，这点设计是和802.11a的载波设计是一样的，只是子载波的带宽不一样而已。</p>
</li>
<li><p><strong>Null Sub-carriers</strong>：在一些早期的书里面，比如《MIMO-OFDM Wireless Communications with MATLAB》，其中是将Guard Sub-carriers和Null Sub-carriers等价看待的。不过在802.11ax中，Null子载波是指的<strong>RU之间的保护间隔</strong>，一般是1个子载波。</p>
</li>
</ul>
<p>下面这张彩图可能更清晰一些：</p>
<p><img src="https://pic2.zhimg.com/80/v2-b954e40221673d43b26dbde3c69958c1_720w.png" alt="RU locations in a 20 MHz HE PPDU"></p>
<p>以RU为26所示，这里一共损耗了6+1+1+7+1+1+5=22个子载波。</p>
<p>最后介绍一下在802.11ax中，导频子载波（Pilot）的设计。</p>
<ul>
<li><p>导频子载波是用来做信道估计的，利用估计出的信道系数完成解调的工作。</p>
</li>
<li><p>由于802.11ax还是一个分布式接入的工作，所以<strong>Pilot是包含在每一个RU内部的</strong>。</p>
</li>
<li><p>在802.11中，始终是用特定的子载波作为导频子载波，从而完成信道估计的功能，在802.11ax中，导频子载波的分配如下：</p>
</li>
</ul>
<p><img src="https://pic2.zhimg.com/80/v2-57e6b71de33ab680e7c40b4438b7e0f1_720w.png" alt="pilot subcarriers"></p>
<p>其中红色的直线即代表导频子载波的位置，代表的是子载波序号，其导频资源是均匀分布在整个信道上的。</p>
<p><img src="/posts/f22bd777/image-20210412181104053.png" alt="Data and pilot subcarrier indices for RUs in a 20 MHz HE PPDU and in a non-OFDMA 20 MHz HE PPDU"></p>
<p>如上图所示带宽为20MHZ，RU为26时，-116号子载波为导频子载波，102号子载波为导频子载波。也就是每个RU的第6个子载波为导频子载波，倒数第七个为导频子载波。</p>
<p>在RU为26个子载波的情况下，每一个RU中都包含了2个pilot，在RU为52个子载波的情况下，每一个RU包含4个pilot。通过这些pilot的设置，在传输过程中，接收方才可以有效地估计信道，并完成解调的工作。</p>
<h2 id="OFDMA资源块RU（Resource-unit）">2.4 OFDMA资源块RU（Resource unit）</h2><p>在802.11ax中，一个最小的时频单位为RU。与LTE中的RE（Resource Element）和RB（Resource Block）不同，LTE中的RE和RB都是一个固定值。</p>
<p>在802.11ax中RU是一个相对的概念，即存在很多种不同大小的RU，如下图所示：</p>
<p><img src="/posts/f22bd777/image-20210412142128738.png" alt="Maximum number of RUs for each channel width"></p>
<p>图中，一共定义了6中RU类型，分别是26，52，106，242，484以及996个子载波。</p>
<p>正交频分多址（Orthogonal Frequency-Division Multiple Access<em>，</em>OFDMA）作为主要的802.11ax增强功能，其是OFDM数字调制技术的多用户版本。 OFDMA将信道细分为较小的资源单元RU。通过OFDMA的资源细分，多个客户端可以通过占据不同的RU资源进行并行传输。</p>
<p><img src="/posts/f22bd777/image-20210412145820774.png" alt="OFDMA RUs – 20MHz信道带宽"></p>
<p>一个20MHz的OFDMA信道包含了256个子载波（Subcarriers，或者称为Tones）组成。这些子载波组成了一些子信道，我们称一个子信道为一个资源单元（RU）。如上图所示，当20MHz信道时被细分时，802.11ax终端可以使用4种不同大小的RU单元，分别包含26个子载波，52个子载波，106个子载波和242子载波，大约相当于2MHz，4MHz，8MHz和20MHz信道带宽的分别。802.11ax的AP决定了在一个20MHz信道内可以使用多少个RU，以及RU形成的不同组合。</p>
<blockquote>
<p>本人理解的是存在不同类似RU共存的情况，比如在20M带宽情况下，2个52-subcarrier RU和1个106-subcarrier RU是可以共存的。这样设计的好处在于可以更有效的分配频率资源，比如在20M的信道条件下，一共可以存在9个26-subcarrier的RU，故需要9个人竞争才可以占据全部信道，否则就会有资源浪费（在802.11ax中，每一个发送者每次只能够竞争一个信道）。所以在发送者数量不足的情况下，只有通过不均等的分配，才可以更加有效的利用信道资源。</p>
</blockquote>
<p>802.11ax AP可以将整个信道分配给一个客户端，也可以利用OFDMA技术将信道分给多个终端同时接入。</p>
<p>例如，802.11ax AP可以使用8 MHz的带宽与一个802.11ax终端通信，同时使用4 MHz的带宽与另外三个802.11ax终端通信。</p>
<p>这些通信过程可以是下行链路，也可以是上行链路。</p>
<p><img src="/posts/f22bd777/image-20210412150306471.png" alt="OFDMA传输过程"></p>
<p>在上图示例中，802.11ax AP首先向Client 1和Client 2发送下行数据。</p>
<p>在第一时刻，20MHz的信道通过OFDMA技术被划分成了两个子信道。在OFDMA技术中，20MHz信道包含了256个子载波，Client 1和Client 2分别占据106个子载波，这些子载波互相没有交叠。</p>
<p>在第二时刻，802.11ax AP向Client 3，Client 4，Client 5和Client 6发送下行信息。在此时，信道被划分成4个子信道，分别占据52个子载波。</p>
<p>在第三时刻，802.11ax AP使用整个信道发送下行数据帧给Client 5，此时一共使用了242个数据子载波，其可以有效的利用整个20MHz的信道。</p>
<p>在第四时刻，AP使用两个子信道，分别是106个子载波向Client 4和Client 6发送数据。</p>
<p>在第五时刻，AP在此向单个终端（即Client 1）发送下行数据，其占据整个20MHz信道，包含242个数据子载波。</p>
<p>在第六时刻，AP同时向Client 3，Client 4和Client 6发送下行数据。此时，信道被划分成3个不等大小的子信道，其中Client 3和Client 4分别占据52个子载波，Client 6占据106个子载波。</p>
<h1 id="MU-MIMO">3 MU-MIMO</h1><h2 id="简介-1">3.1 简介</h2><p>MU-MIMO是基于多天线技术的，这个技术的物理层是多天线技术。多天线可以实现多种技术，不仅仅是MU-MIMO，如下图所示：</p>
<p><img src="https://pic2.zhimg.com/80/v2-7b82d624afda64bdea78879ad6778095_720w.jpg" alt="img">参考：aruba的802.11ax白皮书</p>
<p>上图中，我们可以看到多天线可以做CSD，TxBF，STBC，SDM，MRC等等，这些技术全部在802.11协议中都有应用。这里细节很多，本文不展开了，相关技术我可能会在该技术用到地方再提到。</p>
<p>MU-MIMO的实现是结合波束成型的，波束成型有两种实现方式，一种是智能天线波束成型，一种是基于全向天线的波束成型。在CWNA一书中，已经给出了其定义。</p>
<p>具体描述如原文：</p>
<p><img src="https://pic4.zhimg.com/80/v2-64e5de8582d187bdf1c3e1eff95959bf_720w.jpg" alt="img"></p>
<p>翻译版：</p>
<p><img src="https://pic2.zhimg.com/80/v2-81e50acb85a337098fd811a4501e81fd_720w.jpg" alt="img"></p>
<p>MIMO包含2D-MIMO和3D-MIMO两种，目前5G NR已经有3D-MIMO的波束了，Wi-Fi 6里面还停留在2D-MIMO上。打个比方就是说利用定向天线，天线辐射可以参考手电筒打光，波束的概念就是从光束来的，手电筒打的光就是定向的光束，同理，定向天线辐射的信号就是定向的波束。如果发送和接收方同时用两个手电筒打信号，那么一次性就可以传递更多的信息，这种多天线的发送方式就是MIMO。</p>
<p>MIMO和全双工存在区别，MIMO模式下两根天线，只能够同时处于发送，或者接收状态。而全双工可以一根天线是发送状态，一根是接收状态。（PS：全双工也可以通过EBD之类的设备，一根天线实现全双工，这里不加以讨论）</p>
<p>MIMO的概念比较多，是针对多根天线而言的，主要是两个概念分集和复用。如果有多个通路的时候，比如有两个通路。我们可以简单理解如下，如果两个通路传同一个信息，那么就是分集。如果两个通路传两个不同的信息，那么就是复用。在802.11协议的相关培训书籍里面，这个概念实际上给的是比较粗的解释，MIMO 实际上是分集和复用结合的技术，波束成型是发送分集。</p>
<p>在我们常用的路由器中都是配备了全向天线。利用全向天线实现定向天线实际上是基于干涉抵消的机制来做的，通过预编码，让数据流通过两根天线具有一定的相位差发送出去，达到接收方接收功率叠加，或者干扰方接收功率抵消的效果。</p>
<p>预编码可以通过数字编码的形式添加相位差，目前Wi-Fi就是采用这一种。移动通信（比如LTE或者5G NR）里面方式多了一种是电相位差，是通过基带连接到RF这一段的线路上，通过线路的长度差异来做相位差。总之，有了相位差就可以做波束成型了。2维平面上的干涉抵消就是2D-MIMO，3维平面就是3D-MIMO了。</p>
<p>然后需要回顾下，基于MIMO技术，可以做到多发多收。基本的MIMO就是，一个发送者有两根天线，一个接受者有两根天线，发送者一次用两根天线发，接受者用两根天线收，然后两倍传输速率，这个就是802.11n时代做的MIMO技术。</p>
<p><img src="https://pic3.zhimg.com/80/v2-ed1f8f95958911e0579449cd1906e21e_720w.jpg" alt="img">WRT54M路由</p>
<p>多天线不等于MIMO，在802.11g时代，就有多天线了，Cisco当时的经典路由WRT54M就是多天线的，但是这个不是做MIMO，是做天线选择（实际上也是分集的一种），一次只用一根天线发，但是有可能用左天线，有可能用右天线，也有可能交替（技术上这属于发送分集）。在DD-WRT下我们还可以看到这个选项，如下图</p>
<p><img src="https://pic3.zhimg.com/80/v2-793005cf8a37fcc70c933f571ca2443e_720w.jpg" alt="img">DD-WRT的配置界面</p>
<p>MIMO是两根天线同时发，同时在物理上两根天线需要差半个波长距离，另外两根天线不能够发送相同的信息，要编码之后，否则就会存在默认的干涉效果，对通信无意义。经过预编码后，两根天线才可以同时发送（编码后的对应两根天线上的数据不同）。</p>
<p>LTE，5G NR和Wi-Fi相比，在波束这一块思想差不多，不过具体实现的时候取目标函数会有点区别，前两者可能偏向波束追踪，也就是目标接收功率最大化，Wi-Fi里面是偏向对其他人的干扰最小化（比如interference nulling技术），用干扰抵消的原理来说明，就是前两者偏向干涉叠加最大，后者偏向干涉抵消最强，这会影响一些预编码结构的设计。所以Wi-Fi强调的是多个波束覆盖到多个用户，各个用户之间不会进行干扰。</p>
<p>在Wi-Fi中，802.11ac仅仅支持下行的MU-MIMO传输。到802.11ax，也就是wi-fi 6以后才支持上行的MU-MIMO传输。</p>
<h2 id="MU-MIMO和OFDMA">3.2 MU-MIMO和OFDMA</h2><p>在MAC层协议部分，MU-MIMO的传输和OFDMA传输的过程很像，都是一开始一个TF帧，然后开始一个传输。两个可以叠加，不过先导过程不一样。</p>
<ul>
<li>OFDMA过程的先导是BSRP,BSR过程，就是问缓存情况，然后做OFDMA资源分配。如果没有先导过程的话就是UORA，基于随机接入的竞争模式。协议中还有一个BQRP，类似于BSRP但是关注的参数不一样，这也是用来做资源分配预判的，这里就不展开了。</li>
<li>MU-MIMO的先导过程是NDPA,NDP,beamforming reporting，这样的过程是一个测量过程，测量每一个节点的信道状态，也就是CSI，然后基于该CSI做预编码（协议里面要旋转矩阵）。</li>
</ul>
<p>同时我们需要注意的是，这两个先导机制都包含了主动模式和被动模式（也就是隐式反馈的模式），这也说明了两者在MAC层协议上的类似性。</p>
<p><img src="https://pic1.zhimg.com/80/v2-a6f2cf307f37c45d32e1c538306c12ec_720w.jpg" alt="img">NDP过程</p>
<p>另外这两个先导的过程，NDP和BSR过程也可以结合起来一起使用，如下图</p>
<p><img src="https://pic1.zhimg.com/80/v2-7ba685ee6b0c0c4bb624693650913d18_720w.jpg" alt="img">参考：Aruba的802.11ax白皮书</p>
<p>有了测量矩阵才可以做编码，所以MI-MIMO会做这样的过程。协议没有给定BSR，NDP这样的测量过程和传输过程的关系，所以不是每一次传输都需要测量一次，可选，也可不选。测量周期也是给开发商自己搞定的。关于NDP过程而言，其实与应用场景有关，Wi-Fi大概是100ms左右就可以了，这个从理论上有一个概念，叫做海森堡时间。</p>
<p><img src="https://pic2.zhimg.com/80/v2-9b6638ec2f970435122174f0bdcf87a9_720w.jpg" alt="img">参考：802.11ac: A Survival Guide</p>
<p>然后有了BSP和NDP过程后，就可以执行一次传输了。这个传输过程内，可以做MU-MIMO，可以做OFDMA，也可以做OFDMA+MU-MIMO，协议不规定，给开发商自己折腾的。但是前提是要先导过程，有获取了足够信息。</p>
<p>还有点需要注意的是，目前Wi-Fi协议都是任意长数据帧的，不像LTE，5G NR一样，始终是按照一个小资源片的时间封帧，也就是其帧，半帧之类大小都是固定的，所以没有帧长度不等的问题。</p>
<p>Wi-Fi中只有一个最大帧传输时间和最大帧长度的限制，这个大小随着协议演进过程中是有变化的。下图所示是截至802.11ac目前的最大值：</p>
<p><img src="https://pic1.zhimg.com/80/v2-91f9ce48c6ffd8c1174b1608636a92a0_720w.jpg" alt="img">参考：802.11-2016版本</p>
<p>在Wi-Fi中，由于是多用户同时传输，无论上行还是下行，都是存在帧长度不等的。一个基本思想是补，补随机的东西弄到长度相等。在802.11ac里面，由于只有下行发送，所以发送时间是按照最长帧来的，其他短的不够就补。在802.11ax里面，由于引入上行传输，那么传输时间是AP猜的，根据BSR之类的信息来猜的，所以这段时间有可能会长，长就补0，如果短的话，那么引入了一个新概念，就是动态帧切片，把帧给切短了，然后发送。以上这点在动态帧切换中我们已经讨论过了，所以这里就不展开了。</p>
<h1 id="MAC层接入机制">4 MAC层接入机制</h1><h2 id="序言-2">4.1 序言</h2><p>在802.11ax以前，MAC的接入机制是典型的CSMA机制（即DCF中所采用的CSMA/CA）。</p>
<p>在引入了OFDMA的需求之后，802.11ax的MAC层随机接入机制也发生了变化，在协议中，代替传统的CSMA思想，802.11ax采用了基于ALOHA思想设计了竞争协议。其基本思想已经从强调分布式的场景，逐渐变成了强调中心式，高密度，优化资源分配上了。</p>
<p>本节主要就是介绍802.11ax中所采用的TF（Trigger Frame）以及TF-R（Trigger Frame for Random access）机制。</p>
<p>参考资料：</p>
<ul>
<li><a href="/books/Wi-Fi_6_FD_Extreme_Networks_Special_Edition.pdf">Wi-Fi_6_FD_Extreme_Networks_Special_Edition</a></li>
</ul>
<h2 id="MAC层接入机制-1">4.2 MAC层接入机制</h2><p>802.11ax提升效率的秘诀之一就是OFDMA技术。OFDMA是OFDM技术的多用户版本，在诸如LTE等的其他无线技术中已经被广泛采用。在OFDMA中，信道被细分称更小的单元，称为资源单元（Resource Units，RU） 。通过细分信道，OFDMA通过分配不同的RU给多终端，从而允许多个终端执行并行传输，同时接入无线网络。即总结而言，OFDMA是一种多用户传输技术。</p>
<p><img src="/posts/f22bd777/image-20210412150306471.png" alt="OFDMA传输过程"></p>
<p>如上图所示，在802.11ax中，1个802.11ax AP将1个20 MHz信道划分为多个资源单元（RU），每一个RU被分配给不同的终端，802.11ax AP同时向这些终端进行下行传输。</p>
<p>同时，802.11ax AP还可以同步调度802.11终端，让其执行并行的上行传输。</p>
<p>在802.11ax中，竞争的规则还是存在的（即CSMA/CA）的规则，任何节点（包括AP）在发送之前都需要竞争。</p>
<p>在此技术上，AP通过利用竞争（比如利用更高优先级的竞争参数）获得信道后，通过TXOP（transmission opportunity ）技术占据信道一段时间，从而达到控制信道接入的目的，因此802.11ax中AP具有一定的控制能力。</p>
<p>一旦AP竞争并获得了TXOP是时间，AP可以控制高达9个802.11ax的终端进行上行传输或者下行传输（指的是在20MHz信道带宽下，最多可以承载9个RU，每一个RU为26个子载波）。</p>
<p>针对于不同的TXOP，其RU的数量也是不一样的。对于上行接入（UL-OFDMA），AP采用触发帧机制（Trigger Frames），向802.11ax的终端进行调度和RU资源的分配。</p>
<p><img src="https://pic4.zhimg.com/80/v2-e90b62f696539d2e138501fef5ce205f_720w.png" alt="img"></p>
<p>在802.11ax中，还存在一个OMI机制，这个机制是为了解决802.11终端是采用竞争接入信道（即单用户接入）还是采用OFDMA调度接入信道的（即多用户接入）。在OMI中，终端可以向AP发送信息，通知AP其支持的上下行所支持的最大空间流数目以及信道带宽。如上图所示，802.11ax终端采用OM控制字段（在数据帧或者管理帧中），来指示传输模式或者接收模式的变化。比如802.11ax终端可以在单用户接入或者多用户接入模式间切换。</p>
<h2 id="TF机制（Trigger-Frame）">4.3 TF机制（Trigger Frame）</h2><p>802.11ax与传统的DCF所需求的MAC层机制是不同的。传统的DCF同一个时刻只有一个用户接入信道，而由于802.11ax采用OFDMA技术，其需求多个用户可以同一时间接入信道（选择的RU是正交的）。</p>
<p>本节所介绍的TF机制，主要是用在UL MU（Uplink Multi-users）这种上行传输的场景下的。</p>
<p>TF机制是一个<strong>上行传输</strong>的框架，其具体的随机接入的方法是TF-R机制。</p>
<p><img src="/posts/f22bd777/v2-36dd8f6976d4c1dbc024e4af7a6a4ad9_720w.png" alt="TF机制"></p>
<p>TF是一种上行接入的传输框架，其定义了一个很简单的过程：</p>
<ul>
<li>AP发送Trigger frame，宣称这一轮接入开始。Trigger frame中，包含了节点上传所使用的时频资源（RU）信息。</li>
<li>根据Trigger frame中的指示，节点选择其对应的RU位置，进行OFDMA的接入。多个节点同时向AP发送上行PPDU。</li>
<li>AP接收完全部数据后，反馈ACK，结束这一轮传输。</li>
</ul>
<p>TF帧不仅仅指定了什么节点发，还指定了节点的发送一系列参数，如下图：</p>
<p><img src="/posts/f22bd777/v2-40798acd9390959006eb515d18831499_720w.png" alt="TF帧"></p>
<p>其中第一列是该RU被分配给那个用户（具体是指定用户的AID），如果AID设置为RA（协议中RA的AID号还没给定，即TBD），那么该RU就是供节点竞争的。后面的几列包含了比如Coding Type以及MCS值，这一块细节较多，暂时不展开。</p>
<p>以上就是一个TF的接入框架，对比传统的802.11有以下不同：</p>
<ul>
<li><strong>单节点接入和多节点接入：</strong>传统的802.11中，都是单个节点占据整个信道的。在TF中，多个节点基于OFDMA，同时接入信道。</li>
<li><strong>发起者不同</strong>：在传统的802.11中，节点只要竞争到信道，就可以立刻发起传输。而在TF中，只有当AP发送了TF帧之后，节点才可以发起上行接入竞争。</li>
<li><strong>ACK反馈时机不同</strong>：在传统802.11中，ACK是在发送完之后，立刻被反馈的。而在TF中，ACK实际上是等所有用户都传输完之后，再一次反馈给所有接受者的。由于每一个发送者可能发送的数据包长短不一，所以先发送完的，需要等待后发送完的。这一点实际上也是多用户接入协议一个设计的公共问题。</li>
<li><strong>使用场景不同</strong>：基于以上的几点不同，我们还可以理解，TF机制本身就是在假定网络是工作在基础架构的情况下，进行的设计，其不好在IBSS网络情况下工作。而传统802.11中的DCF设计，是既可以在基础架构模式下，也可以在IBSS模式下工作的。</li>
</ul>
<blockquote>
<p>注：802.11ax中不是完全把DCF删除，而是分时采用不同的模式。TF机制主要是用在上行接入这一部分的。</p>
</blockquote>
<h2 id="TF-R机制（Trigger-Frame-for-Random-access）">4.4 TF-R机制（Trigger Frame for Random access）</h2><p>TF-R是基于TF的进一步扩展，是在TF机制中，引入了竞争的机制，其基本思想是Slot-Aloha。</p>
<p><img src="/posts/f22bd777/v2-c5996e9a2c4a167b20f559a9e1483238_720w.png" alt="TF-R接入机制"></p>
<p>TF-R是将原来时域竞争转为频域竞争（如左边红色竖线上所示）。</p>
<p>TF-R是在前面所述的TF过程之前执行的，在每一次接入时，AP首先发送TF-R帧，在该帧中的部分RU其相应AID=X，这个X代表这个RU是供节点竞争接入的。节点在识别到TF-R帧之后，具体是采用OBO（UL-OFDMA Backoff）的机制竞争（TF-R的接入思想是基于Aloha而不是CSMA的主要原因也在这里）。</p>
<blockquote>
<p>注：Aloha和CSMA的核心区别在于LBT（Listen Before Talk）机制上：Aloha是没有LBT的，而CSMA是基于LBT的。</p>
</blockquote>
<p>在OBO中，每一个节点首先从CWO（Contention Window for UL-OFDMA）窗口中，选择一个随机数并放入Backoff counter中。</p>
<p>如上图，STA1选择的是10，STA2选择的是4，STA3选择的是0。</p>
<p>然后节点比较，这一轮TF-R帧中，可供竞争的RU slot的数目，比如上图RU数目为3。若Backoff counter小于RU的总数（比如STA3选择为0，其小于3），那么节点就可以发送数据，反之不行。那么该节点就随机选择一个RU（比如上图，从3个中随机选择1个，即RU=3），然后在该RU上进行数据传输。</p>
<p>当RU=3被竞争之后，开始下一个的TF-R。此时节点首先要进行Backoff过程，即本地的Backoff counter要减去上一轮总的竞争RU数目（比如STA2选择为4，那么要减去3，即将Backoff counter设置为1）。若新的一轮中节点的Backoff counter小于这一轮的可供竞争的RU数目（比如STA2现在Backoff counter为1，RU数目为2），那么该节点竞争胜利，可以任意选择一个RU（比如选择RU=1）。</p>
<p>只有当TF帧中，有被用来Random Access的RU的时候（即TF-R帧），其才会触发OBO的过程，若该TF帧中没有这种RU，那么不会进行Backoff。</p>
<p>当RU资源被竞争好以后，AP发送TF帧，节点正式向AP反馈上行数据，其过程就和我们之前所述的TF过程一样了。</p>
<blockquote>
<p>注：Slot-Aloha的思想是用来判断节点在这个时刻可不可以发送，并没有包含在哪个位置具体传输的机制。故OBO主要是用来判断，节点能不能发的，至于使用哪个信道具体发送，那么这里是随机的。这一块可能有性能评估的问题，不过目前协议是这样设定的。</p>
</blockquote>
<h2 id="TF帧">4.5 TF帧</h2><p>当进行上行（UL-OFDMA）或者下行（DL-OFDMA）传输时，都需要触发帧（Trigger Frame）来实现多用户通信间，调度信息的交换。触发帧也用户MU-MIMO间帧的交换。例如，AP使用触发帧将OFDMA RU分配给WiFi6客户端。</p>
<p><img src="/posts/f22bd777/image-20210413145008785.png" alt="Trigger Type subfield encoding"></p>
<p>触发帧包含了多种子类型，其在802.11ax中提供了很多重要的功能。上图列举了802.11ax中触发帧具体对应的子类型。</p>
<p>触发帧中包含了有关RU资源分配的信息，RU分配信息分别存放在PHY和MAC层来发送给客户端。</p>
<p>在物理层，可以在触发帧的HE-SIG-B字段中找到RU分配信息，HE-SIG-B字段用于将RU分配信息传达给客户端。</p>
<p>如下图所示，HE-SIG-B由两个字段组成：公共字段（common filed）和用户特定字段(user specific filed)。公共字段用于指示如何将信道划分为各种RU。例如，一个20MHZ的信道可能被细分为一个106-tone的RU和四个26-tone的RU。用户特定字段包括多个用户字段，用于表示将哪些用户分配给每个单独的RU。</p>
<img src="/posts/f22bd777/image-20210412222340737.png" alt="RU allocation at the PHY layer" style="zoom:67%;">

<p>在MAC层，RU分配信息存在触发帧的用户信息字段中。如下图显示了如何在MAC层传递RU分配信息。</p>
<img src="/posts/f22bd777/image-20210412225905723.png" alt="RU allocation at the MAC layer" style="zoom: 67%;">

<p>在下图中，触发帧将特定的RU分配给三个客户，以在20MHZ OFDMA信道上同时进行上行链路传输。</p>
<img src="/posts/f22bd777/image-20210412232604536.png" alt="RU allocation with trigger frames" style="zoom:67%;">

<p>对于UL-OFDMA，AP发送的触发帧还用于告诉客户端在其分配的RU上传输上行链路时要使用多少空间流以及要使用那种调制和编码方案（MCS）。这些信息分布在触发帧的Payload中的user information字段（即其中SS Allocation和UL-MCS）内。</p>
<p><img src="/posts/f22bd777/image-20210413145356572.png" alt="User Info field format"></p>
<p>AP还可以通过触发帧来调整802.11ax终端的发送功率。在触发帧内的UL Target RSSI子字段上，其按照dBm标注了AP所期待的接收功率（通过所有天线接收到的总功率）。这个功率也是根据RU来分配的，每一个RU分配的字段都有对应的UL Targer RSSI字段。UL Target RSSI字段采用0-90的数值来映射-110dBm到-20dBm，并且其数值127代表其时采用最大功率来发送的。基于触发帧的信息，802.11ax终端在其能力范围内调整功率，由于终端的能力不同，所以这个功率时一个期望功率，当终端的硬件或者地方监管限制（比如说法定的无线电的发射功率限制），那么可能终端就无法调节。</p>
<h1 id="OMI机制">5 OMI机制</h1><h2 id="序言-3">5.1 序言</h2><p>**Operating Mode Indication (OMI)**是802.11ax MAC层运行的一种基本机制，用以交互形式分配兼容性以及信道带宽的协商。</p>
<p>参考资料：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.extremenetworks.com/extreme-networks-blog/what-is-operating-mode-indication-omi/">What is Operating Mode Indication (OMI)?</a>。</li>
</ul>
<h2 id="Operating-Mode-Indication-OMI">5.2 Operating Mode Indication (OMI)</h2><p>在802.11ax中，上行和下行链路都引入了OFDMA技术，以实现802.11ax AP和终端间的多用户通信。当任意节点竞争胜利后，其会发起一次TXOP传输（Transmit Opportunity）。在TXOP期间，AP会利用OFDMA技术，将信道分成一个个资源单元（Resource Units ，RUs），以便可以同时进行多用户传输。</p>
<p>传统的802.11a/b/g/n/ac终端想要传输上行数据时（比如进行TXOP传输），其必须通过竞争。在802.11ax中，终端的上行接入机会是可以被AP进行同步和控制的。那么这里常被问的一个问题，即“802.11ax终端能不能不参与一个OFDMA的上行传输，而做为一个独立终端竞争信道，并进行单独的上行传输? ”</p>
<p><img src="/posts/f22bd777/image-20210413151332699.png" alt="Transmit Operating Mode"></p>
<p>802.11ax为此目的定义了操作模式指示（OMI）过程，802.11ax通过OMI机制完成传输模式的切换。如上图所示，终端作为OMI发起者（OMI Initiator）发送具有OM控制字段的帧给AP，AP作为OMI的响应者（OMI Responder）。</p>
<p>802.11ax终端使用802.11数据使用OM控制字段（OM Control Subfield，其通常位于数据或者管理帧中），其用来指示改变AP的发送或者接收模式。802.11ax终端可以通过发送TOM信息（Transmit Operating Mode）给AP，从而在单用户或多用户UL-OFDMA之间切换。若多用户模式，即根据AP控制进行UL-OFDMA传输，若单用户模式，那么终端就自行竞争，并执行单用户的数据传输。802.11ax的终端可以在上行OFDMA传输期间（UL-OFDMA），暂停并且恢复对AP发送的触发帧（Trigger Frames）反馈。</p>
<p><img src="/posts/f22bd777/image-20210413151356053.png" alt="Receive Operating Mode"></p>
<p>另外，OMI还可以用作802.11ax终端和AP进行接收模式（Receive Operating Mode ，ROM）的切换。802.11ax终端作为OMI Initiator向AP指示，其支持的下行链路的最大空间流数量和最大的信道带宽。如上图所示，终端会通过发送ROM信息给AP，指示其工作的信道大小从80MHz切换到20MHz。</p>
<p>OMI功能对于802.11ax客户端是可选的。</p>
<h2 id="Operating-Mode-Notification-frame">5.3 Operating Mode Notification frame</h2><p>操作模式通知帧是VHT类别中的一个action帧，其帧格式如下所示。</p>
<p><img src="/posts/f22bd777/image-20210413154115678.png" alt="Operating Mode Notification frame Action field format"></p>
<p>category字段值为</p>
<p><img src="/posts/f22bd777/image-20210413154421104.png" alt="Category values"></p>
<p>VHT Action字段为：</p>
<p><img src="/posts/f22bd777/image-20210413154522070.png" alt="VHT Action field values"></p>
<p>Operation Mode字段为：</p>
<p><img src="/posts/f22bd777/image-20210413154730764.png" alt="Operating Mode field"></p>
<p>STA通过发送该帧，表示当前工作的信道宽度和它可以接收的空间流的数量。</p>
<h1 id="DL-OFDMA">6 DL-OFDMA</h1><h2 id="序言-4">6.1 序言</h2><p>在介绍完802.11ax的信道接入以及其触发帧机制后，本文着重介绍下行OFDMA的接入机制（即DL-OFDMA）。</p>
<p>参考资料：<a href="/books/Wi-Fi_6_FD_Extreme_Networks_Special_Edition.pdf">Wi-Fi_6_FD_Extreme_Networks_Special_Edition</a></p>
<h2 id="下行OFDMA接入机制（DL-OFDMA）">6.2 下行OFDMA接入机制（DL-OFDMA）</h2><p>OFDMA是一种多用户通信机制，其只适用于802.11ax AP和802.11ax用户之间的数据帧交换。为了保证协议的兼容，在802.11ax中，管理和控制帧还是按照传统的单用户OFDM进行传输。在此之中，OFDMA和OFDM的工作切换需要进行一系列的特定帧交换，比如之前提到的触发帧（Trigger Frame），这种机制在下行OFDMA（DL-OFDMA）和上行OFDMA（UL-OFDMA）中都需要被引入。</p>
<p><img src="/posts/f22bd777/image-20210413172631964.png" alt="Downlink OFDMA"></p>
<p>接下来分析一下触发帧（Trigger Frames）机制是如何用户DL-OFDMA通信，即802.11ax AP向802.11ax终端们进行多用户下行传输。</p>
<p>首先，802.11ax AP需要通过竞争（即CSMA/CA的竞争过程），竞争胜利后，其发起一个TXOP传输时间，相当于这一段TXOP时间内，信道都是被AP所预约占据的，其余所有节点都会被延迟。如上图所示，一旦802.11ax AP获得了TXOP传输时间，AP可以给多个目标终端发送MU-RTS帧，这也是一种类型的触发帧。该MU-RTS帧有以下两个目的：</p>
<ul>
<li><strong>预约信道（Reserve the medium）</strong>：MU-RTS采用传统的OFDM技术，在整个20MHz信道上进行传输，所有的节点（包含802.11ax节点和传统的802.11节点）都可以接收。其功能和传统的RTS是类似的。通过该MU-RTS帧中的Duration/ID字段，该帧设置其余所有节点的NAV定时器，在预约时间内（即定时器设置的时间），所有的终端都处于被动接收状态，不会主动竞争信道。NAV定时器设置的时间值用于DL-OFDMA的数据帧交换。在802.11ax AP向802.11ax终端之间进行OFDMA传输时，信道是必须保证空闲的。</li>
<li><strong>RU分配（RU allocation）</strong>：MU-RTS还被用来同步802.11终端的RU分配。MU-RTS由于是一种触发帧（Trigger Frames），触发帧内部包含了RU分配对应的字段。802.11ax AP通过MU-RTS作为触发帧，告诉每一个终端其被分配的时频资源（即对应的RU）。当接收到MU-RTS后，终端需要向AP反馈CTS用于确认。</li>
</ul>
<p>当收到来自于802.11ax终端的CTS后，802.11ax AP将执行一次下行的OFDMA数据传输（如图，即传输Multi-user DL-PPDU部分）。由于AP已经将信道划分成了多个RU，当终端在自己对应的RU上接收数据，并校验成功后，其需要向AP反馈ACK。该ACK还是通过Block-ACK的形式进行反馈的。具体为当传输完成后，AP会等待SIFS时间，然后发送BAR帧（Block ACK Request）向节点请求Block-ACK，然后终端并行反馈Block-ACK。这里反馈ACK还可以采用Automatic Block-ACK（即AutoBA，Auto Block-Ack ）机制。</p>
<blockquote>
<p>注：在以上传输过程中，CTS和Block-ACK都是并行传输的，这里并行传输实际上还是利用到了MU传输的机制。</p>
</blockquote>
<p>当本轮的DL-OFDMA传输完成后，所有节点（包含AP和终端）都需要进行下一次竞争。若802.11ax AP竞争成功，那么可以执行新的一次DL-OFDMA传输。若802.11n/ac的终端竞争成功，那么会执行一次传统的OFDM传输，以此类推。</p>
<h1 id="UL-OFDMA">7 UL-OFDMA</h1><h2 id="序言-5">7.1 序言</h2><p>在802.11ax以前，协议仅仅支持过下行的多用户接入，比如说MU-MIMO技术（在802.11ac中仅仅支持下行），为了进一步增加并发传输的能力，在802.11ax中引入了上行OFDMA技术和上行的MU-MIMO接入。在协议中上行OFDMA和上行MU-MIMO是组合出现的，其是采用同一种接入思想，区别只在于触发帧内的参数以及数据帧的物理层头部上，本文仅介绍上行OFDMA接入机制。</p>
<p>参考资料：<a href="/books/Wi-Fi_6_FD_Extreme_Networks_Special_Edition.pdf">Wi-Fi_6_FD_Extreme_Networks_Special_Edition</a></p>
<h2 id="上行OFDMA和PCF的区别">7.2 上行OFDMA和PCF的区别</h2><p>在802.11ax中，UL-OFDMA的接入机制也是基于触发帧（Trigger Frames）的，这一种机制和传统802.11中的PCF机制有一些类似，但是也有点区别。</p>
<p>在传统的802.11标准中定义了一种PCF工作模式（Point Coordination Function），该模式是一种基于轮询的工作模式。AP执行轮询者的角色（point coordinator ），其可以在CFP时间范围内（contention-free period ），轮询客户端并执行上下行的传输。在PCF之后，802.11e修正案中为了整体解决无线网络中QoS的问题，定义了一种HCCA的方式（HCF Controlled Channel Access）。在HCCA中，AP作为具有QoS的中心调度器（Hybrid Coordinator ，HC），其在接入网络时默认具有比较高的优先级。利用该优先级，其可以将TXOP分给自身或者其他的节点，以提供一个受控的接入时间段，该时间段也被称为CAP时间（Controlled Access Phase ）。在这段时间内，QoS数据可以无需竞争，直接传输。PCF以及HCCA直至目前也很少在实际产品中实现过，有传言指该机制有可能会在将来的802.11标准中被逐步淘汰。</p>
<p>在802.11ax中，AP可以控制信道并调度上行OFDMA（UL-OFDMA）的接入。这一种控制和PCF或者HCCA时有区别的。基于CSMA/CA的竞争规则在UL-OFDMA中还是使用的，<strong>只有当802.11ax AP首先竞争胜利，并开启一个TXOP时间之后，其才可以占据并调度信道上其他的节点执行UL-OFDMA</strong>。在UL-OFDMA中，也会类似HCCA一样轮询终端的buffer情况以及其对应数据的QoS情况，但是和HCCA的区别在于，HCCA是主动轮询的，而802.11ax终端可以隐式的反馈其缓存的信息，无需主动轮询。另外还有一点区别在于802.11ax中引入了资源分配，即<strong>AP还需要为UL-OFDMA调度的时候，为多用户分配分配RU资源</strong>。在UL-OFDMA传输之前，AP会通过触发帧来指示每一个终端其对应的RU资源，以及对应RU资源上的传输模式（包含空间流数量，MCS速率等）。</p>
<h2 id="Scheduled-UL-OFDMA">7.3 Scheduled UL-OFDMA</h2><p>下面介绍上行OFDMA的工作机制（UL-OFDMA），其基本思想是802.11ax AP通过竞争获取信道后，发起一次TXOP传输时间，并在该时间内通过触发帧调度对应的节点进行并发的上行OFDMA传输。具体过程中UL-OFDMA比DL-OFDMA更为复杂一些，其会采用三个触发帧进行交互，每个触发帧都是AP向节点获取特定的信息反馈。UL-OFDMA中AP会要求终端反馈缓存情况（即Buffer Status Report, BSR）。BSR中包含了终端缓存数据的多少以及对应的QoS类别信息，这些信息会帮助AP优化RU的资源分配。AP将利用这些信息分配对应的RU，上行传输的时间，以及终端传输时对应的速率和功率。BSR信息是可以AP轮询请求的，也可以是非请求（也就是隐式反馈的）。</p>
<p><img src="/posts/f22bd777/image-20210413174859455.png" alt="Uplink OFDMA"></p>
<p>以上图作为示例简单说明，当802.11ax竞争成功后，其首先会发送第一个触发帧（即Trigger #1），该触发帧类型是BSRP（Buffer Status Report Poll ），其用于请求终端的Buffer信息。当终端收到BSRP以后，其会反馈BSR（Buffer Status Reports）信息，就如之前我们提到的，该信息用于辅助AP进行UL-OFDMA中RU资源的分配。</p>
<p>当BSRP,BSR交互后，如果网络中存在传统的802.11客户端，那么AP还需要发送MU-RTS帧（即Trigger #2），该帧也是一种触发帧，并采用传统的OFDM技术进行发送，所有的终端（包含802.11ax和非802.11ax）都可以接收。非802.11ax的终端会通过接收MU-RTS帧中的Duration/ID字段，设置本地的NAV计时器，以保证在剩余UL-OFDMA时间内不会发起主动竞争。同时该MU-RTS帧中还包含了RU资源分配内容。</p>
<blockquote>
<p>AP进行RU资源分配是在MU-RTS帧，而下一个触发帧仅仅是指示开启传输的作用。因为在AP分配RU资源后，需要得到终端的反馈，即终端会反馈CTS帧，告知AP其认可并知道了当前资源分配的情况。</p>
</blockquote>
<p>当MU-RTS，CTS交换完后，AP会发送第三个触发帧（即Triiger #3），通知终端在对应的RU资源上进行上行传输，该触发帧还指示了本次上行传输的时间。</p>
<blockquote>
<p>一次UL-OFDMA需要所有节点同时开始和同时结束（如果存在不同步的情况，那么需要在数据帧添加PAD用以填充，如图上STA2所示）。</p>
</blockquote>
<p>该触发帧还包含了节点对应的功率控制信息，以便终端增加或者减少发送功率，这样有利于多终端均衡接收，并提高接收信号的质量。当上行UL-OFDMA传输完成后，AP会向终端们反馈Multi-STA Block ACK确认。另外，AP也可以逐个客户端反馈Block ACK，这在协议中是可选的。</p>
<blockquote>
<p>并不是所有的上行链路传输需要三个触发帧，仅仅出于对传统客户端的保护机制的目的才需要MU-RTS触发帧。</p>
</blockquote>
<h2 id="UL-OFDMA-Random-Access-UORA">7.4 UL-OFDMA Random Access (UORA)</h2><p>前面所介绍的802.11ax的接入机制中，都是由AP通过获取全局的缓存情况，然后为上行和下行传输统一分配RU资源。然而，如果缓存情况未知的情况下，协议如果需要工作的话，那么就需要引入随机接入机制，该随机接入机制就是UORA（UL-OFDMA Random Access）。本文将会对UORA做一个简单介绍。在介绍TF-R机制中，提过UORA机制。</p>
<p>在802.11ax中，AP利用OFDMA技术，将信道分成多个RU，不同终端可以通过占据不同的RU，从而并行的执行多用户传输。AP可以在上行和下行传输中，站在全局的角度，进行RU资源的最优化分配。在分配过程中，AP可以通过显式请求的方式，或者被动收集的方式，获取节点的缓存情况（即BSR反馈）。AP会根据BSR信息，做全局资源的分配，当分配完成后，AP通过触发帧机制启动一次传输过程。</p>
<p>在802.11ax中还存在一种可选的随机接入机制（UORA），在该方法下，上行UL-OFDMA链路中RU资源的分配不是由AP决定的，而式通过随机接入机制UORA来竞争的。这种接入机制不需要终端侧实时的反馈BSR信息，对于AP不知道终端缓存情况下是有利的。</p>
<p>在UORA中，会使用一种频域的back-off技术（即OFDMA back-off，OBO）。在OBO中，一开始终端会选择一个随机数，然后AP会发送一个竞争类型的触发帧，其中还包含了本轮可用的RU数量。终端会将自己的随机数减去本轮的RU数量，直到减为0。如果终端利用随机数相减之后，本轮值为0的话，那么相当于竞争成功，终端将会随机选择一个RU进行占据。如果本轮相减后，没有为0，那么相当于本轮竞争失败，那么会保持这个数值，下一轮进行继续相减。</p>
<img src="/posts/f22bd777/v2-adec2f422eea8fd4d9e41a2e620ba751_720w.jpg" alt="img" style="zoom:33%;">

<p>具体还有一些细节如下</p>
<ul>
<li><p>802.11ax AP发送一个触发帧，该触发帧是用于触发一次OBO随机接入的，并且包含了可以被分配的RU数目</p>
</li>
<li><p>该触发帧中的User Info字段中包含了AID字段（每一个RU都有一个AID指示），该AID字段表示该RU是否可用被用来进行随机接入</p>
<ul>
<li>如果AID=0，表示该RU用于一个或者多个已关联的终端进行随机接入（如上图中，STA 1,2,4是已经关联的）</li>
<li>如果AID=2045，表示该RU可用于一个或者多个没有被关联的终端进行随机接入（如上图中，STA 3是没有被关联的）</li>
</ul>
</li>
<li><p>终端在初始时刻选择的随机值的范围是通过AP指定的，AP会利用OFDMA contention window (OCW) 字段（在UORA Parameter Set Information字段内）进行范围指定</p>
</li>
<li><p>终端会在OCW范围内选择一个随机数，然后每次OBO随机接入开始的时候，进行一次相减</p>
<ul>
<li>如果OBO计数器（OBO counter）的数值是小于本轮可用的RU的数值的话（其实这个和前面说的，OBO计数器的值减去可用的RU数目，如果小于等于0的话），那么本轮相当于竞争成功，然后会选择一个随机的RU进行占据（在其可用选择的RU范围内)</li>
<li>如果OBO计数器是大于本轮RU的数值的话，那么相减完之后，等待下一轮OBO的开始，直到递减为0</li>
</ul>
</li>
</ul>
<p>大致的OBO的执行流程我们已经解释完了，为了更清楚一些，我们下面举个具体的例子：</p>
<p>首先AP发送一个触发帧（如下图 Trigger 1），该触发帧中的OCW标识了随机数的选择范围，并且标识了可以用于随机接入的RU资源（即eligible RA-RUs，可用于Random Access的RU）。在图中，我们还需要关注到终端所对应的AID，STA 1对应的AID=1，STA 2对应AID=2，STA 4对应AID=3，AID仅仅是分配给已关联的节点的，由于STA3没有关联，所以其没有被分配的AID。在该Trigger 1帧中，标识了RU 1 ~ RU 3是可以用于已关联节点进行随机接入的（即允许STA 1，2，4竞争），RU 4 ~ RU 5是可以用于未关联的节点进行随机接入（即允许STA 3竞争），RU6是已经被分配给特定节点了（即分配给了AID=3，也就是STA 4）。</p>
<p>当收到Trigger 1之后，终端们在OCW范围内，各自选择一个随机数进行OFDMA Back-off（OBO），如图中，STA 1的OBO counter =3，STA 2的OBO counter =5，STA 3的OBO counter =4，STA 4的OBO counter =2。其中STA 1，2，4和AP已经关联的，STA3是和AP没有关联的。</p>
<img src="/posts/f22bd777/v2-3bbec9f2af7a2d75f5a9a8978b2c649a_720w.jpg" alt="img" style="zoom:33%;">

<p>由于STA 4在触发帧中已经被分配了资源（即RU 6），那么只剩STA 1和STA 2进行本轮的OBO，已经有资源的终端本轮就不需要进行OBO了，随机数保持不变。对于STA 1和STA 2而言，本轮可用竞争使用的RU数目为3个，其对应的STA 1的OBO counter = 3，STA 2的OBO counter = 5。在本轮相减后，STA 1的OBO counter = 3-3 = 0，STA 2的OBO counter = 5-3 = 2。对于STA 3而言，本轮可用的RU数目为2个（即RU 4和RU 5），所以本轮相减后，STA 3的OBO counter = 4-2 =2。</p>
<img src="/posts/f22bd777/v2-46302b09c24a39feefbf8e716eb14b14_720w.jpg" alt="img" style="zoom:33%;">

<p>如上图所示，由于STA 1本轮相减后OBO counter = 0，其相当于竞争胜利，可用随机选择一个RU占据（图中即RU 2）。STA 2本轮相减后，OBO counter = 2，那么本轮竞争失败，其会保持该值，直到下一轮OBO中继续相减。STA 3本轮相减后，OBO counter = 2，那么本轮竞争也是失败的，需要进行下一轮的OBO竞争。STA 4由于一开始AP已经指定了其对应的RU（即RU 6），那么本轮其不用进行OBO，所以保持其OBO counter不变，即STA 4的OBO counter =2。然后已经竞争成功或者分配成功的终端，就在其选择的RU位置上，进行上行数据的传输，从而本轮OBO完成。</p>
<img src="/posts/f22bd777/v2-89b427eebc632dad21e7b7d23ffcd04d_720w.jpg" alt="img" style="zoom:33%;">

<p>当上一轮传输完成后，AP发送了一个新的触发帧（即Trigger 2）开启一轮新的OBO。如上图所示，在该触发帧中，RU 1 ~ RU 2是用于给已关联的终端进行OBO（由于该RU的AID=0），RU 3 ~ RU 4是给未关联的终端进行OBO（由于该RU的AID=2045），RU5 ~ RU 6是被分配给了特定终端，即AID = 6。</p>
<p>当收到Trigger 2帧后，由于STA 1上一轮竞争成功，所以其需要在OCW范围内重新选择一个随机数，本轮STA 1的OBO counter = 4，其余STA 2，STA 3，STA 4都是保留上一轮OBO之后的OBO counter。</p>
<p><img src="/posts/f22bd777/v2-b9286487cef9fb2ed12127491dd8282c_720w.jpg" alt="img"></p>
<p>然后要执行本轮的OBO相减了。</p>
<p>首先关注已经关联的终端，即对于STA 1，STA 2和STA 4而言，本轮可用的RU数目（eligible RA-RUs）为2，所以相减完后，STA 1的OBO counter = 4-2 = 2，STA 2的OBO counter = 2-2 = 0，STA 4的OBO counter = 2-2 = 0。那么本轮竞争的胜利者为STA 2和STA 4，其分别随机选择了RU 1（STA 4）和RU 2（STA 2）占据，STA 1本轮没有竞争成功，所以不能进行传输。</p>
<p>对于未被关于的终端，即STA 3，本轮可用的RU数目为2，所以相减后，STA 3的OBO counter = 2-2 = 0，即本轮竞争成功。其选择了RU 4占据，并执行上行传输。</p>
<p>其余RU 5 ~ RU 6被分配给了特定节点，上图中就没有表示了。</p>
<p>当本轮分配好RU后，终端就会在自己对应的RU上进行上行数据的反馈。</p>
<blockquote>
<p><strong>Remark</strong>：在UORA的过程中，还是有可能会出现冲突的。即终端OBO counter=0之后，需要随机占据一个RU进行上行传输，若此时有两个或者两个以上节点占据了同一个RU，那么在这个一个RU上就会发生一次冲突。如果发生冲突，那么AP就无法成功收到该RU上对应的数据帧，从而不会反馈ACK。终端通过ACK来得知本轮是否传输成功，如果失败的话，那么他们会增大其OCW的大小至两倍（即double OCW范围，直到OCWmax值），这里和传统802.11的backoff中的BEB机制是类似的，用于减少冲突概率。802.11ax中的UORA实际上冲突概率还是小于传统802.11的，主要是因为其是多资源中，任意选择一个RU，这种冲突概率还是小于原来单信道模式下，所有节点进行竞争的。</p>
</blockquote>
<h1 id="Buffer-Status-Report">8 Buffer Status Report</h1><h2 id="序言-6">8.1 序言</h2><p>上文叙述了上行OFDMA接入机制。该机制的基本思想就是通过AP竞争，获得TXOP传输时间后，根据各个终端的缓存情况，进行RU资源的分配，当分配完成后，进行上行OFDMA的传输。在这个过程中，缓存情况的反馈可以通过AP询问的方式主动完成（即AP发送BSRP帧向终端请求），也可以进行非主动的反馈，本文就针对于非主动反馈缓存信息BSR（Buffer Status Reports）做一个介绍。</p>
<p>参考资料：</p>
<ul>
<li><a href="/books/Wi-Fi_6_FD_Extreme_Networks_Special_Edition.pdf">Wi-Fi_6_FD_Extreme_Networks_Special_Edition</a></li>
</ul>
<h2 id="非主动的BSR反馈">8.2 非主动的BSR反馈</h2><p>在802.11ax中，UL-OFDMA一共有三次帧交换过程，一共包含了3个触发帧</p>
<ul>
<li>Trigger #1：BSRP帧，用于请求终端的缓存情况</li>
<li>Trigger #2：MU-RTS帧，用于兼容保护传统的802.11终端，以及分配RU资源</li>
<li>Trigger #3：Basic-Trigger帧，用于触发节点进行并行的上行传输</li>
</ul>
<p>在此叙述中，重点描述的是，AP采用<strong>显式</strong>的请求终端们的缓存情况（即BSRP，BSR过程）。在实际情况下，UL-OFDMA不一定具备完整的这个三个触发帧。比如，若网络中不存在传统的802.11终端，则不需要MU-RTS帧，或者为了减少开销，AP不用显式的发送BSRP帧，而是将其和其他的控制帧，数据帧或者管理帧结合进行发送。</p>
<p>终端是可以在未经BSRP请求的时候，直接反馈非主动的BSR帧给AP，即unsolicited buffer status report。终端可以在任意一个帧中利用以下字段发送这种非主动的BSR：</p>
<p><strong>QoS控制字段（QoS Control field）</strong>：802.11 ax终端可以在其发送的<strong>QoS数据帧</strong>或者<strong>QoS Null帧</strong>（也就是只有Header，payload部分为空）中，利用<strong>Queue Size字段</strong>（每一个QoS类型有一个单独该字段），来反馈缓存的状态信息。另外，终端还可以用聚合帧的形式，反馈多个QoS类别，其不同的缓存情况。不同的QoS类别利用TID进行区分（Traffic identifier，TID）。Queue Size字段用来指示具体的缓存信息。</p>
<p><strong>BSR控制字段（BSR Control subfield）</strong>：如果是在一个802.11ax的网络中，AP支持BSR控制字段的话，那么终端还可以在发送的<strong>任意帧中添加BSR控制字段</strong>内，进行BSR信息的反馈。如下图所示，802.11ax会标识不同的QoS接入类别（Access Category，AC）通过ACI High字段，并且反馈具体的Buffer信息通过Queue Size High字段（图上粉色标识为反馈单个接入类型的BSR情况）。终端会决定哪个QoS队列相对于其他队列具备更高的优先级。这一种相对QoS设置的方法并没有在协议中严格规定，从而为不同类型的终端分配优先级提供灵活性。</p>
<p><img src="/posts/f22bd777/image-20210420105910432.png" alt="Control Information subfield format in a BSR Control subfield"></p>
<p>一个802.11ax终端还可以报告多个QoS类别的缓存情况。这要通过上图中的ACI Bitmap，Delta TID和Queue Size All字段来反馈（图中蓝色标识为反馈多个接入类型的BSR情况）。ACI Bitmap和Delta TID标识多个QoS的接入类型，QoS Size All字段标识其对应的缓存情况。另外还有一个字段为Scaling Factor（SF），这个字段代表缩放因子，用以表示缓存的单位大小。即QoS Size High或者QoS Size All需要配合SF字段才表示真实的缓存情况。SF一共有两位，分别表示了4种缩放情况，如下图所示。这种缩放的表示方法也是为了不同终端其反馈对应流量时候，具有比较高的灵活性。</p>
<p><img src="/posts/f22bd777/image-20210420110122893.png" alt="Scaling Factor subfield encoding"></p>
<p>另外一点需要注意的是，在802.11协议中，协议支持同时在QoS控制字段（QoS Control field）和BSR控制字段（BSR Control subfield）中，同时反馈BSR信息，当然这也协议中是一种可选的选项，而且同时包含BSR信息时，其两个字段所包含的信息需要一致才行。</p>
<h1 id="BSS-color">9 BSS color</h1><h2 id="序言-7">9.1 序言</h2><p>参考资料：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.extremenetworks.com/extreme-networks-blog/">What Is BSS Coloring In 802.11ax?</a></li>
<li><a target="_blank" rel="noopener" href="https://www.extremenetworks.com/extreme-networks-blog/what-is-bss-color-in-802-11ax/">What is BSS Color in 802.11ax?</a></li>
<li><a target="_blank" rel="noopener" href="https://www.extremenetworks.com/extreme-networks-blog/how-does-bss-coloring-work-in-802-11ax/">How Does BSS Coloring Work in 802.11ax?</a></li>
<li><a href="/books/802.11%E2%84%A2-2016.pdf">802.11-2016.pdf</a></li>
<li><a href="/books/Draft_P802.11ax_D8.0.pdf">Draft P802.11ax_D8.0.pdf</a></li>
</ul>
<h2 id="介绍">9.2 介绍</h2><p>BSS Coloring是最初在802.11ah中引入的一种机制，用于为每个BSS分配不同的“颜色”。该技术目的是增加在密集环境中，无线网络的系统容量，增加BSS之间的频率重用。然而，当前的802.11的MAC层机制，其会导致一个BSS的设备会被同频道的另一个BSS影响，无法同时进行传输，从而对于网络容量没有提升。</p>
<p>在802.11ax中，BSS Coloring是一种用于解决由于重叠基本服务集（OBSS）提升空间重用率的方法，减少因为重叠BSS导致的MAC层竞争开销。BSS Coloring的目标是提升空间复用，同时不会因为BSS间的干扰而导致节点间PHY层传输速率的降低（即降低MCS值）。802.11ax设备通过向PHY头部添加字段（即BSS Coloring字段）来区分BSS，节点在竞争时，根据检测到物理层头部的BSS Coloring字段来分配MAC层的竞争行为。若BSS Coloring字段信息相同，那么代表在同一个BSS内(intra-BSS)。若BSS Coloring字段信息不同，那么代表这里是重叠覆盖区域，在多个BSS间(inter-BSS)。 在传统802.11中，若在BSS间(inter-BSS)，当节点检测到信道忙时，需要推迟自己的传输，直到信道空闲才可以发送。在802.11ax中，引入了<strong>自适应CCA机制</strong>(adaptive CCA)。通过提高BSS间(inter-BSS)信号检测阈值，同时保持BSS内(intra-BSS)的较低信号检测阈值（两个阈值，大约4dB左右的差值），来减少MAC层竞争时的竞争问题，提升MAC层效率。</p>
<p>BSS Color特性如下：</p>
<ul>
<li>STA可以使用信道接入规则（26.10 Spatial reuse operation）</li>
<li>降低能量消耗</li>
<li>更新NAV</li>
</ul>
<h2 id="什么是802-11ax中的BSS-Coloring技术？">9.3 什么是802.11ax中的BSS Coloring技术？</h2><p>整理自<a target="_blank" rel="noopener" href="https://www.extremenetworks.com/extreme-networks-blog/what-is-bss-color-in-802-11ax/">What is BSS Color in 802.11ax?</a></p>
<p>802.11协议是采用CSMA/CA作为MAC层的协议，其采用的是半双工通信机制，这表示在同一个时间只有一个无线电设备可以在网络上进行传输。如果一个802.11终端检测到任意一个802.11终端的传输信号(即PHY层的Header)，其会推迟传输。我们称多个AP和客户端在同一个信道上进行部署，并执行竞争传输叫做OBSS(具有重叠的基本服务集)。在OBSS中，我们描述这种同信道的干扰为co-channel interference(CCI).</p>
<p>信道复用的核心问题是最小化空口传输时间并减少由于OBSS场景导致的性能下降。 802.11ax修正案基于提升空间复用的思想，提出<strong>自适应的CCA机制</strong>(adaptive clear channel assessment, adaptive-CCA)来对于信道进行检测。</p>
<p>BSS Coloring，是用于识别重叠基本服务集（OBSS）的方法。 其最先是在802.11ah-2016修正案中定义，现在也沿用到了802.11ax中。 BSS Coloring是一个字段，标识了BSS的ID。当多个无线终端在同一信道上传输时，802.11ax无线电能够使用BSS Coloring字段区分BSS。</p>
<p>BSS Coloring的信息是同时被添加在PHY层和MAC层中的。在802.11ax PHY头部的Preamble中，其SIG-A字段包含6个Bit的BSS Coloring信息字段，如下表所示，该字段可以识别多达63个BSS。</p>
<table>
<thead>
<tr>
<th>bit0</th>
<th>1</th>
<th>2</th>
<th>3-6</th>
<th>7</th>
<th>8-13</th>
<th>14</th>
<th>15-18</th>
<th>B19-B20</th>
<th>…</th>
</tr>
</thead>
<tbody><tr>
<td>Format</td>
<td>Beam change</td>
<td>UL/DL</td>
<td>HE-MCS</td>
<td>DCM</td>
<td>BSS Color</td>
<td>Reserved</td>
<td>Spatial Reuse</td>
<td>Bandwidth</td>
<td>…</td>
</tr>
</tbody></table>
<p><img src="/posts/f22bd777/bss-color.png" alt="802.11管理帧中BSS color字段"></p>
<p>在802.11管理帧中也可以看到BSS Coloring信息(如上图所示)。在Beacon帧中的HE Element中，包含BSS Coloring的子字段。其也是6个Bit的BSS Coloring信息字段，可以标识63个BSS。</p>
<p>在802.11ax中，MAC层的竞争取决于检测到的BSS Coloring。其将CCA的阈值和BSS Coloring信息关联起来(即adaptive-CCA)，从而提升空间复用能力。让节点可以忽略OBSS间的传输，可以在此时同时进行传输，从而提升信道利用率。802.11ax修正案定义了两种的空间重用模式，一种称为基于OBSS PD的空间重用，另一种称为基于SRP的空间重用。</p>
<h2 id="BSS-Color原理">9.4 BSS Color原理</h2><p>整理自<a target="_blank" rel="noopener" href="https://www.extremenetworks.com/extreme-networks-blog/how-does-bss-coloring-work-in-802-11ax/">How Does BSS Coloring Work in 802.11ax?</a></p>
<p>基本服务集（BSS）是任意802.11网络的基础拓扑。构成BSS的元素包含，包括1个AP和多个节点。在多个节点在信道传输时，802.11ax通过BSS Coloring字段来区分BSS。若BSS Coloring信息相同，那么是BSS内的传输，若BSS Coloring不同，那么是BSS间的传输，即来自于OBSS内部的传输。</p>
<img src="/posts/f22bd777/1f.png" alt="颜色冲突" style="zoom: 67%;">

<p>对于802.11ax的AP，其如果检测到使用相同颜色的OBSS，则它能够更改变其BSS颜色，减少同频干扰。若AP与AP间的BSS Coloring一样，那么这也是一种BSS Coloring的冲突，即颜色冲突。如上图所示，如果802.11ax AP听到来自其他AP或者该AP节点的不同BSS Coloring字段，那么是检测到一次颜色冲突。</p>
<img src="/posts/f22bd777/2f.png" alt="上报颜色冲突" style="zoom:67%;">

<p>另外，如果终端检测到颜色冲突，则该终端会向其关联的AP发送颜色冲突报告。如上图所示，AP-1无法听到AP-2，但AP-1的关联的终端可以听到来自于OBSS区域内，其他不同BSS Coloring的传输，从而向AP发送颜色冲突报告。终端向AP会报告其能够监听到的所有OBSS的BSS Coloring信息。</p>
<p>当AP检测到颜色冲突后，其可以决定改变其BSS颜色。不过改变BSS Coloring的标准和选择新BSS Coloring信息的方法超出802.11ax草案修正案的范围。WLAN供应商目前可以自行制定，例如Aerohive信道选择协议（ACSP）。</p>
<p><img src="/posts/f22bd777/v2-16f827ae3d3c33cc2d1577f0ce9b9075_720w.jpg" alt="BSS color change announcement"></p>
<p>AP会通过Beacon告知所有关联在本BSS内部的节点，BSS Coloring的改变。BSS Coloring的改变还可以通过探测响应和重新关联响应帧中进行通知。如上图所示，AP告知节点BSS Coloring的颜色变化，其New BSS Color子字段则包含新BSS Coloring的数值。</p>
<h2 id="初始化BSS-color">9.5 初始化BSS color</h2><p>当HE AP开始一个基础BSS（infrastructure BSS）或者HE STA开始一个IBSS或者MBSS，在它发送的第一个<strong>HE Operation element</strong>中，其帧格式如下图所示，设置BSS Color子字段为1~63中的一个值，并且在BSS的存在时间或直到BSS color改变，都需要维持这个值不变。如果选择一个BSS Color，HE STA需要考虑相邻OBSS中BSS color的使用。</p>
<img src="/posts/f22bd777/image-20210331232050904.png" alt="HE Operation element format" style="zoom:50%;">

<p>其中<strong>BSS Color Information</strong>字段如下所示</p>
<p><img src="/posts/f22bd777/image-20210401104143752.png" alt="BSS Color Information"></p>
<p><strong>Partial BSS Color</strong>字段为1表示将基于(AID 分配)中定义的BSS颜色的AID分配规则应用于BSS</p>
<p>AID分配规则：<img src="/posts/f22bd777/image-20210401104001452.png" alt="AID分配公式"></p>
<h2 id="禁用BSS-color">9.6 禁用BSS color</h2><p>当HE STA探测到BSS color collision时，发送一个HE Operation element来禁止BSS使用BSS color，设置HE Operation element中的BSS Color Disabled子字段为1来通知该BSS下的其他STA禁止使用BSS Color；否则HE STA设置BSS Color Disabled子字段为0。</p>
<blockquote>
<p>NOTE: 发送了HE Operation element的HE STA不要长时间禁止BSS color，否则会影响其他依赖BSS color的HE STAs的功能。</p>
</blockquote>
<p>如果AP接收到的HE operation element中的BSS Color Disabled子字段为1，则：</p>
<ul>
<li>non-AP HE STA使用HE PPDU中的Address 1, Address 2, Duration/ID代替RXVECTOR parameters BSS_COLOR和TXOP_DURATION来决定STA是否更新intra-BSS NAV</li>
<li>non-AP HE STA使用HE PPDU中的Address 1, Address 2代替RXVECTOR parameters BSS_COLOR和STA_ID来决定STA在PPDU持续时间是否进入休眠</li>
</ul>
<h2 id="BSS-color冲突">9.7 BSS color冲突</h2><p>BSS冲突上报使用的是管理帧，这里先复习一下管理帧的具体细节。</p>
<table>
<thead>
<tr>
<th align="left">字段</th>
<th>Frame Control</th>
<th>Duration</th>
<th>Address1</th>
<th>Address2</th>
<th>Address3</th>
<th>Sequence Control</th>
<th>HT Control</th>
<th>Frame Body</th>
<th>FCS</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Octets</td>
<td>2</td>
<td>2</td>
<td>6</td>
<td>6</td>
<td>6</td>
<td>2</td>
<td>0 or 4</td>
<td>Variable</td>
<td>4</td>
</tr>
</tbody></table>
<p>管理帧：Beacon、ATIM、Disassociation、Association Request、Association Response、Reassociation Request、Reassociation Response、Probe Request、Probe Response、Authentication、Deauthentication、Action、Action No Ack、Timing Advertisement。</p>
<p>其中Action frame的frame body格式如下所示。</p>
<p><img src="/posts/f22bd777/image-20210402143824652.png" alt="Action frame body"></p>
<p>Action字段格式如下</p>
<p><img src="/posts/f22bd777/image-20210331175719479.png" alt="Action field"></p>
<p>Action frame的类别如下图所示：Spectrum management Action、QoS Action、DLS Action、Block Ack Action、Vendor-specific action、Radio Measurement action、Public Action、FT Action、SA Query Action、Protected Dual of Public Action、HT Action、TDLS Action、WNM Action、Unprotected WNM Action等。</p>
<p><img src="/posts/f22bd777/image-20210406105156487.png" alt="Category filed"></p>
<p><img src="/posts/f22bd777/image-20210406105300871.png" alt="Category filed"></p>
<p><img src="/posts/f22bd777/image-20210406105318271.png" alt="Category filed"></p>
<p>这里讨论的BSS color冲突上报就隶属于WNM Action类别中的Event Report Frame中，Action字段格式如下。</p>
<p><img src="/posts/f22bd777/image-20210331174935637.png" alt="Event Report Action field format"></p>
<p>Category（类别）：值为10，代表WNM Action</p>
<p>WNM Action：其他值省略，这里为上报，所以为1</p>
<table>
<thead>
<tr>
<th>WNM Action field value</th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>Event Request</td>
</tr>
<tr>
<td>1</td>
<td>Event Report</td>
</tr>
<tr>
<td>2-255</td>
<td>此处省略</td>
</tr>
</tbody></table>
<p><strong>Dialog Token</strong>判断是上报还是响应帧</p>
<table>
<thead>
<tr>
<th>Dialog Token value</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>该帧为事件报告帧</td>
</tr>
<tr>
<td>非零</td>
<td>对应Event Request frame</td>
</tr>
</tbody></table>
<p><strong>Event Report Elements</strong>格式如下图所示，注意，由于对应的是BSS Color事件，则<strong>Event Report Status</strong>为0(Successful)，并且<strong>Event Type</strong>是4（BSS Color collision）或者5（BSS Color in use）,则在事件上报状态后面的字段使用Event TSF, UTC Offset, Event Time Error, Event Report等字段。</p>
<img src="/posts/f22bd777/image-20210331235333867.png" alt="Event Report element format" style="zoom:50%;">

<p>Element格式如下如所示，对于BSS Color事件，其中Element ID Extension长度为1个字节。</p>
<p>其中<strong>Element ID</strong>定义如下表所示。</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Element id</th>
<th><strong>Element ID</strong> Extension</th>
<th>Extensible</th>
<th>Fragmentable</th>
</tr>
</thead>
<tbody><tr>
<td>BSS Color Change Announcement</td>
<td>255</td>
<td>42</td>
<td>YES</td>
<td>NO</td>
</tr>
</tbody></table>
<p><strong>Event Token</strong>事件令牌：由于BSS Color冲突事件是自动上报的，所以该字段为0</p>
<p><strong>Event Type</strong>事件上报类型：定义如下表所示</p>
<table>
<thead>
<tr>
<th>Event Type</th>
<th>Name</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>Transition</td>
</tr>
<tr>
<td>1</td>
<td>RSNA</td>
</tr>
<tr>
<td>2</td>
<td>Peer-to-peer link</td>
</tr>
<tr>
<td>3</td>
<td>WNM log</td>
</tr>
<tr>
<td><strong>4</strong></td>
<td><strong>BSS Color Collision</strong></td>
</tr>
<tr>
<td><strong>5</strong></td>
<td><strong>BSS Color In Use</strong></td>
</tr>
<tr>
<td>6-220</td>
<td>Reserved</td>
</tr>
<tr>
<td>221</td>
<td>Vendor Specific</td>
</tr>
<tr>
<td>222-255</td>
<td>Reserved</td>
</tr>
</tbody></table>
<p><strong>Event Report Status</strong>定义如下图所示</p>
<img src="/posts/f22bd777/image-20210331235803357.png" alt="Event Report Status" style="zoom:50%;">

<p><strong>Event TSF</strong>:当STA记录事件时，该字段为TSF的值。</p>
<p><strong>UTC Offset</strong>：当TSF timer等于0时，该字段是与UTC事件相对应的UTC值。如果UTC Offset未知，则改字段为0。</p>
<p><strong>Event Time Error</strong>：UTC标准偏差，对应事件记录的TSF值。如果Event Time Error未知，则该字段为0.</p>
<p><strong>Event Report</strong>：该字段包含单个事件报告的说明。相对于BSS color collision event report，该字段是一个八字节共64位，每一位对应BSS Color(1-63)，如果该bit的值为1，则表示non-AP HE STA检测到与该位置对应的BSS Color已被使用，我理解的是第0位保留不用。举例：如果第10bit位为1，则表示non-AP HE STA检测到BSS Color=10已经被OBSS使用。</p>
<h2 id="BSS-color-change发布">9.8 BSS color change发布</h2><p>当监测到bss color collision，禁用BSS color后，HE AP使用<strong>BSS Color Change Announcement element</strong>来宣布即将到来的BSS color改变。</p>
<blockquote>
<ul>
<li>non-AP HE STA不应该发送BSS Color Change Announcement element。</li>
<li>Beacon, Probe Response, (Re)Association Response和HE BSS Color Change Announcement帧可以携带BSS Color Change Announcement element，AP通过发送这些帧来宣布bss color change。</li>
<li>HE AP公告即将到来的BSS color change的时间要足够长，这样BSS内的所有STA，包括处于PS模式下的，可以确保在BSS Color改变之前收到携带BSS Color change Announcement element的帧。</li>
</ul>
</blockquote>
<p>如果使用Action frame来通知颜色改变，帧细节在上一节已经讨论过。</p>
<blockquote>
<p>注意：HE AP可能会将HE BSS color change announcement frame作为action frame来发送给一些错过了颜色更改公告并仍以旧颜色发送的STA.</p>
</blockquote>
<p>在802.11ax中新增两个类别，category字段新增的值如下所示</p>
<p><img src="/posts/f22bd777/image-20210406110855445.png" alt="category filed"></p>
<p>BSS Color change announcement frame对应于Protected HE Action frame，其帧格式如下所示。</p>
<p><img src="/posts/f22bd777/image-20210401154758894.png" alt="HE BSS Color change announcement frame"></p>
<p>其中category就是新增的值：31</p>
<p>则Protected HE Action字段值如下所示，对应value=0，为颜色更改公告。</p>
<p><img src="/posts/f22bd777/image-20210402145037669.png" alt="image-20210402145037669"></p>
<p><strong>BSS Color Change Announcement element</strong>格式如下所示</p>
<p><img src="/posts/f22bd777/image-20210331154920218-7177023.png" alt="BSS clor change announcement element format"></p>
<p>其中New BSS Color Information字段如下</p>
<p><img src="/posts/f22bd777/image-20210331155505916.png" alt="New BSS Color Information filed format"></p>
<ul>
<li>如果BSS Color Change Announcement element中的Color Switch Countdown字段的值大于1，那么下一个TBTT后，AP应该将Color Switch Countdown减1。当Color Switch Countdown等于1时，就是BSS color change TBTT，也就意味着<strong>在该时刻修改BSS color</strong>。当HE AP公示BSS Color即将改变后，不应该修改BSS Color change TBTT。</li>
<li>属于共同托管的BSSID集的AP（请参见26.17.7（共同托管的BSSID集））应选择“ Color Switch Countdown”字段的值，以使集合中各个BSS之间的BSS颜色变化TBTT间隔不大于该集合中具有最大信标间隔的BSS的信标间隔。</li>
</ul>
<p>在导致BSS color change TBTT内，也就是Color Switch Countdown的值大于1的时间段内：</p>
<ul>
<li>HE AP应该设置BSS Color Disabled子字段为1，同时，继续通过HE Operation element中的BSS Color子字段发布之前存在的BSS color。</li>
<li>HE AP不能改变BSS Color Change Announcement elemen中New BSS Color子字段的值。</li>
<li>HE AP应该设置HE PPDU中的TXVECTOR parameter BSS_COLOR为之前存在的BSS color。</li>
</ul>
<p>在BSS color change TBTT内，也就是Color Switch Countdown的值等于1的时间段内：</p>
<ul>
<li>HE AP应该将它发送的HE Operation element中的BSS Color Disabled子字段置为0，除非HE AP属于co-hosted BSSID set（共同托管的BSSID集），这样它可以继续保持该值为1，直到co-hosted BSSID set中所有的BSS都结束了各自的BSS color change TBTT。</li>
<li>HE AP在HE operation element中的BSS Color子字段中使用新的BSS color。</li>
<li>HE AP在TBTT之后在它发送的所有帧中使用新的BSS color。</li>
</ul>
<h1 id="SRP空间复用和Adaptive-CCA">10 SRP空间复用和Adaptive-CCA</h1><h2 id="序言-8">10.1 序言</h2><p>BSS Coloring技术是802.11ax中引入，目的进一步优化空间复用（Spatial Reuse Parameter）。在前文讨论过关于BSS Coloring技术，但是关于如何基于BSS Coloring进行Spatial Reuse Parameter，还需要额外介绍Adaptive-CCA机制。本文就关于这两个问题做一个阐述。</p>
<p>本文参考自：</p>
<ul>
<li><a href="/books/Future-and-Indoor-Networks.pdf">Future Indoor Networks: The role of Wi-Fi and its evolution - nokia bell lab</a></li>
<li><a href="/books/IEEE-802.11ax-Highly-Efficient-WLANs-for-Intelligent-Information-Infrastructure.pdf">IEEE 802.11ax: Highly Efficient WLANs for Intelligent Information Infrastructure</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ni.com/zh-cn/innovations/white-papers/16/introduction-to-802-11ax-high-efficiency-wireless.html">Introduction to 802.11ax High-Efficiency Wireless</a></li>
<li><a href="/books/Draft_P802.11ax_D8.0.pdf">Draft P802.11ax_D8.0.pdf</a></li>
<li><a target="_blank" rel="noopener" href="https://www.wifi-professionals.com/2019/07/bss-colouring-or-spatial-reuse-802-11ax-aka-wifi6">BSS COLOURING OR SPATIAL REUSE (802.11AX AKA WIFI6)</a></li>
</ul>
<h2 id="SRP空间复用（Spatial-Reuse-Parameter）">10.2 SRP空间复用（Spatial Reuse Parameter）</h2><p>在802.11ax中，基于BSS Coloring，我们可以区分出Inter-BSS和Intra-BSS。如果现在一个Inter-BSS的节点检测到信道是忙的，但是其知道这个信道不是自己BSS正在进行传输，那么其可以认为信道是idle状态，进而继续backoff。如果backoff到0，那么其可以进行传输。</p>
<p><img src="/posts/f22bd777/image-20210407163921854.png" alt="image-20210407163921854"></p>
<p>如上图所示，假设一个BSS的AP发送了一个SR-enable trigger frame（协议中称为SRP PPDU），代表当前的AP是允许一个SRP传输的。目前我理解的SRP仅仅支持AP上行接收的情况。AP发送完SRP TF帧后，其执行自己BSS内的一次传输，比如说一次上行传输。此时，如果一个支持SRP技术的Inter-BSS STA，也就是其他BSS Color下的节点，收到该SRP TF帧后。其会采用adaptive-CCA机制进行信道检测。如果其在adaptive-CCA的阈值下（即OBSS_PD阈值）检测信道是idle的，那么其可以继续执行backoff的操作。当backoff到0以后，其就可以执行一次数据的传输。</p>
<p>SR-enable的标志位应该是在PHY头部的HE-SIG-A1里面的Spatial Reuse field，这里面一共有4个field，可以设置disable SRP技术，也可以设置对应延迟或者具体的adaptive-CCA阈值等。</p>
<p>另外需要注意的是，这里允许传输的inter-BSS STA的数据帧大小也是有限制的。在一开始AP发送的TF帧中，实际上是包含了duration参数设置，代表其上行接收PPDU过程所需要的时间。inter-BSS需要在该Duration时间内完成SRP空间复用的传输，这里可能又会应用到动态帧分片技术了。</p>
<p>SRP技术实际上是一种利用捕获效应的空间复用技术，简单理解就是，如果当前AP的接收信号质量不错，不容易被干扰。那么此时就允许在该网络内，一个其他BSS的节点传输。由于本身我的信号强度够强，所以不会受到其他节点的干扰。该技术可以利用的核心机制就是adaptive-CCA机制，AP可以控制CCA的阈值，从而控制让部分节点（也就是不对自己产生干扰的节点）进行空间复用。</p>
<h2 id="Adaptive-CCA（自适应CCA）">10.3 Adaptive-CCA（自适应CCA）</h2><p><strong>CCA技术是</strong>802.11协议用来检测信道是否有数据包在传输的<strong>物理载波监听技术</strong>。</p>
<p>802.11ax除了传统的ED_Threshold和CS_Threshold，进一步引入了OBSS_PD这个参数。</p>
<p><img src="/posts/f22bd777/image-20210407180033598.png" alt="Using Color Codes for Clear Channel Assessment"></p>
<p>上面左图描述的是传统802.11的情况，其中CCA-Energy Detection对应到EDThreshold（-82 dBm），CCA-Signal Detection对应到CS_Threshold（-62 dBm）。右边描述的是802.11ax中的情况，我们可以看到起CCA_SD实际上一个新的阈值（协议命名是OBSS_PD），其高于原来的CS_Threshold（-62 dBm），这个阈值是自适应调节的，所以被称为Adaptive-CCA。该阈值的目的就是用来区分，目前CCA检测到的数据帧是不是本BSS域内的。<strong>按照SRP的规则，如果STA检测到该数据帧不是本BSS的，而且STA的信号强度是小于该Adaptive-CCA的，那么可以认为信道是idle，可以继续backoff</strong>。</p>
<p><img src="/posts/f22bd777/Colouring-decision-process.png" alt="Colouring-decision-process"></p>
<p>上面两个图进行分析：</p>
<ul>
<li>首先STA进行能量检测</li>
<li>如果RSSI小于-82，则认为没有数据在传输，信道空闲。</li>
<li>如果RSSI大于-82，说明有数据在传输，开始PLCP解调，</li>
<li>如果PLCP解调失败，那么等待EIFS，等待完挂起到当前数据帧的传输结束</li>
<li>如果PLCP成功，那么它将读取框架标题以查看框架的颜色。</li>
<li>如果其颜色相同，说明信道忙，有数据，开始接收数据。如果要发送数据，则必须经过正常的CSMA / CA过程。</li>
<li>如果颜色与其自己的BSS不同，则说明它是一个BSS间帧，不需要接收该数据帧，但如果要发送数据，则需要与动态CCA值进行比较</li>
<li>如果RSSI大于OBSS_SD，说明OBSS的传输对MYBSS的干扰较大，标记MYBSS信道忙，不进行SR传输。</li>
<li>如果RSSI小于OBSS_SD，说明OBSS的传输对MYBSS的干扰较小，标记MYBSS信道空闲，可以开始backoff，到0时，可以进行上行传输</li>
<li>此时，还有另一个阈值检查，它检查帧的信号强度是否高于-62或低于。</li>
</ul>
<p>在协议中，该OBSS_SD（本文命名有点杂，对应协议是OBSS_PD）是一个范围值，是AP根据网络情况自适应调节的，并且在Spatial Reuse field给出。</p>
<p><img src="/posts/f22bd777/image-20210407163311302.png" alt="image-20210407163311302"></p>
<p>如上图所示，该范围是在-62dBm和-82dBm之间，也就是对应传统的ED_Threshold和CSThreshold之间。该图上的21dBm描述的参考的发送功率，TXPWR_Ref。</p>
<h1 id="AMPDU">11 AMPDU</h1><h2 id="序言-9">11.1 序言</h2><p>帧聚合（Frame Aggregation）是802.11中为了提升传输效率的一种方式，自802.11n开始被引入，本文介绍一下802.11ax中对帧聚合的进一步使用。</p>
<p>参考资料：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.extremenetworks.com/extreme-networks-blog/802-11ax-frame-aggregation-enhancements/">802.11ax Frame Aggregation Enhancements</a>。</li>
</ul>
<h2 id="802-11ax帧聚合增强功能">11.2 802.11ax帧聚合增强功能</h2><p>802.11n和802.11ac的主要目标是提高物理层传输速率和吞吐量。在802.11n/ac中，帧聚合(Frame Aggregation)是一个提高空口效率的关键技术。帧聚合是将多个无线帧组合成单个更长的无线帧传输，然后一次进行传输。在MAC层的竞争开销不变的情况下（由于用一个帧代替多个帧，所以只有一次竞争开销），增加了传输的内容，导致减少额外的空口时间。</p>
<p>为了理解帧聚合技术，需要知道两个概念：MSDU和MPDU。SDU和PDU是两个基本单元，M代表MAC层。在802.11中，MAC服务数据单元（MAC Service Data Unit <em>,</em> MSDU）是802.11数据帧的第3-7层有效载荷(即Payload)，MSDU仅仅是Payload部分，没有Header。 802.11 MAC协议数据单元（MAC Protocol Data Unit ,MPDU）本质是除了Payload以外，还包含了MAC层的数据包头部，即MDPU包含了MAC层头部以及MSDU。</p>
<p>802.11n定义了两种帧聚合方法：</p>
<ul>
<li>针对MSDU的帧聚合（A-MSDU），将多个MSDU组合成一个数据帧，共享一个MAC头部</li>
<li>针对MPDU的帧聚合（A-MPDU），将多个MPDU组合，其结构如下图所示</li>
</ul>
<p><img src="/posts/f22bd777/image-20210420164520531.png" alt="Multi-TID AMPDU"></p>
<p>当节点接收到聚合帧后，采用块ACK（Block ACK）的形式进行反馈。</p>
<p>在实际场景中，A-MPDU最为常用。因为其采用Block ACK，重传开销较少。因此，在802.11ac中，仅仅定义了A-MPDU（即没有定义A-MSDU了）。802.11ac的数据帧仅仅采用A-MPDU进行聚合传输。所有的802.11ac数据帧都是采用A-MPDU的形式传输的。尽管802.11ac传输采用A-MPDU，但是需要被指出的是A-MSDU可以和A-MPDU一起使用，一个A-MPDU的Payload部分可以携带A-MSDU，这样两者就是结合使用了。</p>
<p>802.11ax在物理层定义了多种增强功能，比如引入OFDMA提高效率。另外，实际上在MAC层上还存在一种有效增强效率的机制，即帧聚合技术的改进。</p>
<p>在802.11ax之前，A-MPDU中每个MPDU必须都具有相同的802.11e QoS接入类别，也就是所有的MPDU都要是同一个优先级的流量。比如高优先级的MPDU（比如语音）不能和其他相对低优先级（比如Best Effort或Video）的MPDU组成聚合帧进行传输。 <strong>802.11ax引入多流量标识符</strong>（Multi-Traffic Identifier，Multi-TID）的A-MPDU，其允许来自相同或不同QoS接入类别流量进行聚合，其通过流量标识符（TID）进行识别。通过组合不同QoS流量类别的MPDU，其能更有效的让802.11ax终端进行聚合传输，减少竞争开销，提高吞吐量，最终提高整体网络效率。</p>
<h1 id="双重NAV技术">12 双重NAV技术</h1><h2 id="序言-10">12.1 序言</h2><p>NAV是802.11中最基本的MAC层元素之一，在802.11协议中起着非常重要的功能，而且先行协议下，基本上所有的兼容性机制都围绕的NAV展开。在802.11ax中，引入了双重NAV技术（Dueling NAVs）进一步扩展其功能，本文即针对这项技术做一个展开。</p>
<p>参考资料：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://note-on-clouds.blogspot.com/2019/07/new-wifi-dueling-navs-in-80211ax.html">Dueling NAVs in 802.11ax</a></li>
<li><a target="_blank" rel="noopener" href="https://www.programmersought.com/article/19873582929/">802.11ax Preview 9: Dual NAV technology (Dueling NAVs)</a></li>
</ul>
<h2 id="802-11ax中的双重NAV技术（Dueling-NAVs）">12.2 802.11ax中的双重NAV技术（Dueling NAVs）</h2><p>Wi-Fi使用两种载波侦听方法来确定信道是否繁忙，若繁忙那么要延迟进行传输。空闲信道评估（clear channel assessment，CCA）是检测信道是否繁忙的物理机制，同时在WiFi中，还存在一种虚拟载波监听机制，其和物理载波监听机制并行工作。虚拟载波侦听机制的核心是网络分配矢量（network allocation vector ，NAV）的定时器机制。</p>
<p>在802.11ax中已经引入了BSS Coloring机制，以适应在OBSS环境下，自适应调节空闲信道评估阈值（即adaptive CCA)，以增加空间信道的复用率，提供更多并行传输的可能性。</p>
<p>在BSS Coloring中引入的adaptive CCA也可以和虚拟载波监听的NAV组合使用，由于adaptive CCA中已经引入了两个不同的监测阈值，那么意味着其和NAV机制组合使用时，也需要两个独立的NAV定时器。在802.11ax中，目前已经新定义了两个NAV定时器：BSS内部的NAV定时器（intra-BSS NAV timer），和基本NAV定时器（basic NAV timer）。</p>
<ul>
<li><strong>BSS内部NAV定时器（intra-BSS NAV timer）</strong>：其只够通过来自于同一个BSS内部的终端来设置，通过BSS内部终端传输的Duration/ID字段来设置NAV定时器的数值。</li>
<li><strong>基本NAV定时器（basic NAV timer）</strong>：其可由来自于不同BSS区域的终端来设置，也是根据这些终端传输的Duration/ID字段来设置NAV定时器的数值。</li>
</ul>
<p>以上两个NAV定时器同时工作，如果由<strong>任意一个NAV设置为非0</strong>，也就是正在定时中，那么就认为信道是忙，正在被占据。</p>
<p>引入了两个NAV定时器是有益的，尤其在密集场景下。802.11ax的终端不仅仅需要保护其在BSS内部 （intra-BSS）传输的帧，还需要避免来与于其他BSS（即BSS间，inter-BSS）传输的干扰。</p>
<p><img src="/posts/f22bd777/image-20210422141942909.png" alt="image-20210422141942909"></p>
<p>如上图所示，802.11ax AP-1发送了一个RTS帧（包含设置NAV=200us），以保护其与终端STA#1的数据帧交换。因为STA#1与AP-1相关联，即STA#1是AP-1这个BSS内部的终端（称该BSS为BSS#1），所以STA#1将<strong>BSS内部NAV定时器</strong>设置为200μs。然而，在数据帧交换期间，属于BSS#1（即AP-1）的终端（即STA#1）还可以收到不同BSS的客户端传递的RTS帧。比如终端STA#2传输的RTS帧（包含Duration=125us），其也会设置STA#1的NAV定时器，此时由于是不同BSS的终端设置，STA#1会将其<strong>基本NAV定时器</strong>设置成125us。在上图中，STA#1的内部NAV定时器首先倒数到0，但是其基本NAV定时器还没有倒数到0，还将继续递减。在此两个NAV定时器没有全部倒数至0之前，STA#1无法进行新的一轮发送。这种双重NAV的机制可以保证BSS#2中，帧的交换不受到干扰。</p>
<h1 id="TWT节能机制">13 TWT节能机制</h1><h2 id="序言-11">13.1 序言</h2><p>关于802.11协议的节能机制，包含了PSM，APSD，PSMP以及SMPS。在802.11ax中，为了在速率提高的场景下，降低所花费的功耗，协议采用了一种新的节能机制TWT（Target Wake Time）。TWT首先是在802.11ah中被引入的，在802.11ax中又经过一些改良。本文就针对于TWT技术做一个介绍。</p>
<p>本文参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.commscope.com/blog/2018/802.11ax-fundamentals-target-wake-time-twt/?utm_source=ruckus&utm_medium=redirect">802.11ax fundamentals: Target Wake Time (TWT)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cleartosend.net/802-11ax-target-wake-time/">CTS 164: 802.11ax Target Wake Time</a></li>
<li><a href="/books/WP_802.11AX.pdf">Aruba 802.11ax White Paper</a></li>
</ul>
<h2 id="简介（Target-Wake-Time）">13.2 简介（Target Wake Time）</h2><p>TWT定时唤醒机制（<strong>Target Wake Time</strong>，<strong>TWT</strong>）首次出现在802.11ah “Wi-Fi HaLow”标准中，其用于支持大规模物联网环境下的节能工作。随着IEEE 802.11ax标准的发展，TWT的功能获得了进一步的扩展，这使得IEEE 802.11ax标准能够更加优化设备的节能机制，提供更可靠，更节能的传输机制。在802.11ax中，TWT机制在ah的基础上，已经被修改为支持基于触发的上行链路传输，从而扩展了TWT工作的范围。</p>
<p>在TWT中，终端和AP之间建立了一张时间表（该时间表是终端和AP协定的），时间表是由TWT时间周期所组成的。通常终端和AP所协商的TWT时间周期包含一个或者多个beacon周期（总体时间比如几分钟，几小时，甚至高达几天）。当终端和AP所协商的时间周期到达后，终端会醒来，并等待AP发送的触发帧，并进行一次数据交换。当本次传输完成后，返回睡眠状态。每一个终端和AP都会进行独立的协商，每一个终端都具有单独的TWT时间周期。AP也可以将终端们根据设定的TWT时间周期进行分组，一次和多个终端进行连接，从而提高节能效率。</p>
<p><img src="/posts/f22bd777/medium.png" alt="The Target Wake Time mechanism first appeared in the IEEE"></p>
<p>如上图所示，User 1和User 2分别和AP协定了两个TWT时间周期，分别为TW1和TW2。终端User 1和User 2默认就工作在睡眠模式下（sleep mode），保持一个较低的功耗。当TWT时间周期到达时，AP会发送一个触发帧（Trigger）给终端，终端进而苏醒并和AP执行数据交换，当数据交换完成后，终端恢复睡眠模式。TWT和传统PSM模式的差别是，终端只在TWT时间开始的时候苏醒，而在PSM模式中，从该beacon周期开始，终端就会通过该beacon帧中的DTIM信息，观察是否AP是否由缓存自己的数据帧，如果有的话，那么就保持苏醒，直到接收完成后，才恢复到睡眠模式。在上图中，如果是传统的PSM的话，若本轮beacon帧中提示有User 1的信息，那么其不会在TW1时间内睡眠，会保持苏醒，直到数据交换完成后，才恢复睡眠。</p>
<h2 id="三种工作模式">13.3 三种工作模式</h2><h3 id="Individual-TWT">13.3.1 Individual TWT</h3><p>该模式下终端会和AP协商特定的TWT时间，该时间会被存放在AP的时间表中。终端会在特定的时间醒来并和AP进行帧交换。每一个终端仅仅直到自己和AP协商的TWT时间，不需要知道其他终端的TWT时间。Individual TWT还有多种工作模式，比如说显式工作模式。</p>
<p>其大致工作流程如下：</p>
<p>1、终端想要建立一个TWT连接，其会将自己的节能调度信息告知给AP</p>
<p>2、AP将会分配TWT周期，并将该周期反馈给终端</p>
<p>3、终端会在指定的TWT周期时苏醒，并和AP进行数据帧交换</p>
<p>4、在本轮交换中，会分成显式和隐式两种工作模式</p>
<p>①、显式工作模式</p>
<p>在本次数据帧交换中，AP会显式告诉终端，下一轮的TWT周期</p>
<p>终端会在新的指定的TWT周期时苏醒，并再一次和AP进行数据帧交换</p>
<p>②、隐式工作模式</p>
<p>在本次数据帧交换中，AP不会告诉终端，下一轮的TWT周期<br>终端会自己计算出下一轮的TWT周期（通过在当前TWT周期上增加一个特定的时间）<br>终端会在自己计算的TWT周期时苏醒，并再一次和AP进行数据帧交换</p>
<p><img src="/posts/f22bd777/v2-ec145d8747af4677e0b9fba559b01719_720w.png" alt="img"></p>
<p>如上图所示，终端会在苏醒的时候，首先和AP发起一个TWT建立请求，终端和AP协商一个TWT时间（即图中Negotiate a schedule），当协商完成后，终端就进入睡眠状态。在该图上，AP发送Beacon时，也会包含了公开的TWT信息，在Individual TWT工作模式下，该信息终端时不需要的。终端一直保持睡眠状态，直到TWT时间到达。终端苏醒，并接收AP的触发帧，即TWT Trigger。当终端接收到该触发后，其会和AP进行数据帧交互。于此同时，AP会告知终端下一次的TWT时间（在显式TWT中，睡眠间隔是逐次设定的），终端会在新的TWT时间上，定时苏醒，并执行数据帧交换。TWT的一次苏醒间隔有可能是小于一个beacon周期，也有可能是大于一个beacon周期的，相比于传统的PSM，APSD之类的节能方式，更加具有一般性。</p>
<p><img src="/posts/f22bd777/v2-87f88e9269bcd820138de1cd9145e96b_720w.jpg" alt="img"></p>
<p>终端和AP可以关于TWT时间周期进行协商，终端可以要求取消TWT参数，或者向AP请求特定的TWT时间。如果AP统一终端的请求，其会反馈“Accept TWT”。还有多种协商的具体参数，可以参考上图。</p>
<h3 id="Broadcast-TWT">13.3.2 Broadcast TWT</h3><p>广播TWT机制是一种由AP负责管理的工作机制。在该机制下，TWT时间周期是由AP宣告，通常AP会在每一个beacon帧中宣告本轮的TWT时间周期。在一些特殊的情况下，AP也会在其他的管理帧中宣告，比如Association帧，Reassociation帧或者Probe Response帧等等。我们需要注意在Broadcast TWT中，存在加入组和离开组的交互动作，终端需要向AP申请加组才可以执行Broadcast TWT，这个加组交互动作也是通过在终端和AP交换管理帧中，通过携带TWT elements完成的。当终端完成加组后，终端会按照最近接收到的TWT时间周期进行工作，此时这一类型的终端也被叫做“TWT Scheduled STA”，AP被称为“TWT Scheduling AP”。终端在TWT时间周期到达后进行苏醒，AP会发送广播的触发帧，发现哪些终端正在处于苏醒状态（加组后的终端们），并向这些终端发送数据帧，这里由于是广播通信，所以只有AP向节点发送。当AP发送完成后，终端恢复到睡眠状态，直到下一次广播TWT时间到达。通常，这种广播TWT中的时间间隔，我们也称为“TWT SP (Service Period)”。</p>
<p><img src="/posts/f22bd777/v2-64658809cffd8f6a8013f41949ba8a5f_720w.png" alt="img"></p>
<p>如上图所示，AP会在Beacon帧中，进行TWT Broadcast时间周期（即TWT SP时间）的宣告。终端们苏醒并接收该Beacon信息。然后在对应的TWT时间到达时，对应的终端们会提前苏醒，接收AP发送的TWT trigger，以及AP发送的下行数据帧，在此过程中，AP也由可能发送新的一次的TWT Broadcast时间周期（即TWT SP时间）。终端接收完成后，进入睡眠状态，并在新的TWT SP时间到达时，再次苏醒，以后以此类推。</p>
<h3 id="Opportunistic-PS">13.3.3 Opportunistic PS</h3><p>机会PS模式和前面两种工作模式是类似的，但是没有AP和节点的协商过程。AP会在每一个Beacon内，公开宣告一个TWT时间。任意终端可以选择在这个公开TWT时间内进行苏醒，并和AP执行数据帧交换。这个交换可以是单个节点的，也可以是采用OFDMA机制进行交换。</p>
<p><img src="/posts/f22bd777/v2-9c1d1b7a9da20b7c1f9de1c06b23b7be_720w.png" alt="img"></p>
<p>如上图所示，AP在Beacon帧中宣告了一个公开的TWT时间，任意终端都可以直到该TWT时间。当该TWT公开时间到达后，AP会发送触发帧，此时苏醒的节点可以和AP进行交互，并执行数据帧的交换。在图中，由多个节点苏醒，从而触发了一次OFDMA类型的数据帧交互。</p>
<h2 id="其他节能机制">13.4 其他节能机制</h2><p>802.11ax协议对于功耗这一面是很关注的，除了TWT以外，还包含了一些其他的特殊设计，用以节能，并延长终端的电池寿命。这些在IoT场景中都是非常重要的。</p>
<ul>
<li><strong>选择性的接收数据帧</strong>：在传统的802.11中，节点需要接收所有的数据帧，即使该数据帧不是自己的，那么也需要接收完成后，检查MAC地址（即BSSID），判断之后才可以丢包。接收无用的数据帧也是要耗费能量的，所以在802.11ax中，节点可以在数据帧的物理层头部就判断，该帧是不是要进行接收的，如果不是需要接收的，那么就可以停止接收，从而节约能量。</li>
</ul>
<p>在802.11ax协议中，这一点的实现是基于新的物理层头部的：</p>
<p><img src="/posts/f22bd777/image-20210420170741665.png" alt="Timing boundaries for HE PPDU fields if midamble is not present"></p>
<p>如上图所示，为一个802.11ax的帧结构，我们红色标出的位置HE-SIG-A是其物理层头部的一部分。在节点接收过程中，节点需要首先接收物理层头部，并完成解调，获取了相应的信息后，才可以进行数据部分的解调。在物理层头部HE-SIG-A字段中，有两个字段我们需要关注：</p>
<p><img src="/posts/f22bd777/image-20210420171108181.png" alt="image-20210420171108181"></p>
<p><img src="/posts/f22bd777/image-20210420171124117.png" alt="image-20210420171124117"></p>
<p><img src="/posts/f22bd777/image-20210420171153148.png" alt="image-20210420171153148"></p>
<p><strong>Uplink/downlink字段（即UL/DL）</strong>：终端可以通过物理层头部的UL/DL字段知道这个帧是由AP发送给节点的，还是由别的节点发送给AP的。由于当前的无线网络基本都是工作在基础架构模式，或者扩展服务集模式，总之该模式都是有中心节点AP的，任何的流量转发都需要经过AP，节点和节点直接无法直接交换数据。这种情况下，节点要不是向AP发送，要不是接收AP的数据帧。所以当一个节点通过HE-SIG-A中的UL/DL字段判断该数据帧是其他节点发送的话（即UL状态），那么其就不需要接收，反之如果是DL状态的话，那么就表示是AP发送的下行帧，所以需要接收。</p>
<blockquote>
<p>Remark：由于下行数据帧有可能是广播或者组播，也有可能是单播，所以无论下行数据帧是不是自己的，节点都需要接收。节点只有在识别到是其他上行流量时，才会停止接收。</p>
</blockquote>
<p><strong>BSS Color字段</strong>：在多AP的场景下，节点仅仅会接收感兴趣的AP（比如本地关联的AP）信息，如果非感兴趣的下行信息，其是可以不接收，从而节能的。BSS Color字段也是在物理层头部HE-SIG-A中（如上图所示）。在802.11ax中，不同的AP可以通过BSS Color字段来进行识别，每一个AP都有预设的BSS Color，节点也知道不同AP对应的BSS Color。节点如果识别到非感兴趣的帧，那么会停止接收帧，并返回睡眠模式。</p>
<ul>
<li><strong>发送功率限制</strong>：在OFDMA接入模式中，AP会通过发送Trigger帧通知不同节点，其上行传输所用的功率和MCS。一方面是为了优化接收信号的性能，即为了执行OFDMA，需要不同节点的信号到AP处近似相等，否则会出现远近效应。另外一方面，可以优化能耗，让部分节点不需要满功率发送，从而节能。</li>
</ul>
<p><img src="/posts/f22bd777/image-20210420171330790.png" alt="User Info field format"></p>
<p>如上图所示，在Trigger帧中的User Info Field中，UL MCS指示了节点发送时候的速率，已经UL Target RSSI指示了AP端期望接收的功率，节点根据该位计算出合适自己的发送功率。由于这种功率调节机制，节点不会一直以满功率进行传输，从而进行节能。</p>
<ul>
<li><strong>OMI模式（Operating mode indication）</strong>：我们之前介绍过OMI模式，该模式节点和AP之间会协定传输参数，以及是否采用OFDMA形式进行传输。OMI还分成“Receive operating mode”（ROM），“Transmit operating mode”（TOM）。</li>
</ul>
<p><img src="/posts/f22bd777/v2-2e58fd82e3d87a87b2962f705e60337b_720w.png" alt="img"></p>
<p>上图给出了OMI模式中可以控制的参数。通过OMI可以控制数据传输时的信道带宽，空间流数目，工作模式，OMI可以限定工作模式，对于IoT场景而言，节点可以用OMI来限定发送和接收数据时的带宽以及空间流的数目，从而实现节能的目的。</p>
<ul>
<li><strong>20MHz-only工作模式</strong>：支持该模式的设备只能够以20MHz的方式，接入2.4GHz或者5GHz频段的AP，具体时接入主信道（即Primary Channel）。限定节点的工作带宽，可以减少大带宽信号所使用的功率，从而实现节能。</li>
</ul>
<p><img src="/posts/f22bd777/image-20210420171548215.png" alt="20 MHz-only Wi-Fi 6 Client"></p>
<p><img src="/posts/f22bd777/v2-81c02ffb80b19412961417ccda6574b0_720w.jpg" alt="img"></p>
<p>如上图所示，我们认为这里有4个20MHz的信道，对于接入者而言，只有1个主信道（即Primary Channel）是信道3，然后还有3个从信道（secondary Channel)。当节点启用20MHz-only时，其只会在Primary 20MHz信道上工作，该工作可以是采用OFDM技术，也可以使用OFDMA技术，即占据部分的子载波。在Secondary Channel上，节点不会进行工作。</p>
<h2 id="帧格式">13.5 帧格式</h2><p><img src="/posts/f22bd777/image-20210421161836600.png" alt="image-20210421161836600"></p>
<p><img src="/posts/f22bd777/image-20210421161824717.png" alt="image-20210421161824717"></p>
<p><img src="/posts/f22bd777/image-20210421161805490.png" alt="image-20210421161805490"></p>
<p><img src="/posts/f22bd777/image-20210421161853921.png" alt="image-20210421161853921"></p>
<p><img src="/posts/f22bd777/image-20210421165400875.png" alt="image-20210421165400875"></p>
<p><img src="/posts/f22bd777/image-20210421165414882.png" alt="image-20210421165414882"></p>
<h1 id="TXOP时间设置和动态分片技术">14 TXOP时间设置和动态分片技术</h1><h2 id="序言-12">14.1 序言</h2><p>前面已经介绍过了UL/DL-OFDMA的接入机制。下行接入是AP分配的，上行接入过程包含两种：(1) 允许竞争的UORA; (2) 无竞争，完全是由AP分配的模式。</p>
<p>无论在上行还是下行的OFDMA接入机制中，都可以简单概述成：先发送一个TF帧，AP会在这个TF帧中指定用户所占据的RU，或者指定特定的RU让用户做竞争接入。</p>
<p>该TF帧会启用TXOP机制，换言之，它会设置信道在一定时间内为NAV状态，从而让AP获得更高等级的调度权。然而，一个基本问题就引发了，这个TXOP时间是怎么设置的，有没有什么限定？因此，本文简单讨论了这个一个问题，以及该问题所需要引入的新技术，动态分片技术。</p>
<h2 id="UL-DL-OFDMA接入过程">14.2 UL/DL-OFDMA接入过程</h2><p>首先回顾下在802.11ax中的UL-OFDMA过程，ax中的接入过程最简化可以为三个帧，TF，UP-OFDMA PPDU，MU-BlockACK，如下图所示：</p>
<p><img src="https://pic1.zhimg.com/80/v2-b6d66730777b25fec8f34ec1d4655dc4_720w.jpg" alt="img"></p>
<p>在首先发送的Trigger帧中，会开启一个TXOP时间，该时间内，所有的节点都被强制设置为NAV，即虚拟载波监听状态，无法主动的竞争信道。Trigger帧是一个触发传输的帧，其包含了节点上行传输所需要的设置信息，包含了MCS和传输功率控制，如下图所示：</p>
<p><img src="https://pic4.zhimg.com/80/v2-bea350aff7d90031ca73c7d5a0b729df_720w.jpg" alt="img"></p>
<p>其中的User ID对应用户的AID，对应AID的用户会在该资源块RU上进行对应的上行传输，可以通过AID=STA来指定特定节点，也可通过AID=RA（具体可以是0，也可以是2045）来指定该RU用于随机接入。</p>
<p>每一个RU才还被指定了MCS以及其对应的数据流数目，即SS Allocation，以及MCS，这是802.11协议中首次引入的机制，AP可以控制节点的发送速率。</p>
<h2 id="UL-DL-OFDMA的TXOP时间设置">14.3 UL/DL-OFDMA的TXOP时间设置</h2><p>TXOP机制是首次在802.11e中被引入，其允许“一次竞争，多次传输”。即在节点竞争胜利后，可以持续占用信道一段时间。标准的TXOP时间是和数据包的业务优先级AC有关的，并在802.11e中是给出了默认值，如下图所示（不同协议版本的TXOP时间设置不同）：</p>
<p><img src="https://pic3.zhimg.com/80/v2-2741ff864c97be812b9a03e06c7c9dee_720w.jpg" alt="TXOP默认值"></p>
<p>在802.11后期的发展中，TXOP成为一种机制。在一些其他用处下，比如802.11ax中的OFDMA接入过程，其TXOP的时间不是按照上图的默认机制，而是和传输数据包的大小有关。</p>
<img src="/posts/f22bd777/image-20210425151244812.png" alt="Setting for single and multiple protection under enhanced distributed channel access (EDCA)" style="zoom:67%;">

<p>从上述协议可以得到，<strong>TXOP时间=TF+CTS+PPDU+ACK</strong></p>
<p>该TXOP时间的核心设置为一次对应传输的PPDU时间（即HE_TB_PPDU）。</p>
<ul>
<li>下行：由于传输方是AP，所有AP知道待传输的数据包大小，并且所有的RU传输速率都是已经设定好的，所以该PPDU传输时间是一个固定值，可以设置。</li>
<li>上行：因为在传统的802.11中，AP是无法知道节点上行数据包的对应情况的。传统的802.11中，AP不仅预知节点的数据包情况（比如包大小之类），同时期物理层传输参数也是无法预知的（比如传输的速率）。</li>
</ul>
<p>那么在802.11ax中，需要引入新的机制，已知一些信息才可以确定性的设置对应传输的TXOP时间。所以协议中有两个设置：</p>
<ol>
<li>OFDMA传输时，AP发送Trigger帧，指定各个RU对应的MCS和NSS，确定传输速率。</li>
<li>通过BSR，BSRP机制，AP获取节点对应的buffer信息，确定数据包大小。</li>
</ol>
<p>基于以上两点，AP可以设置该传输所需要的PPDU时间。</p>
<h2 id="动态帧分片（Dynamic-Fragmentation）">14.4 动态帧分片（Dynamic Fragmentation）</h2><p>除了基于BSR机制的上行传输机制外，还有一种基于随机接入的上行机制UORA。</p>
<p>在UORA情况下，假设AP设置的时间为A。而节点上行传输所需要的时间为B。那么会分两种情况：</p>
<ul>
<li>如果A&gt;B，可以实现，但是效率低下，节点传输完自己数据包之后，需要padding，充填一些冗余数据，将时间填充满A。</li>
<li>如果A&lt;B，AP给出的时间不够一个数据包传输的，在传统的TXOP中，是不传输（也就是TXOP最后的时间片段，是否能够传输一个数据帧）。在802.11ax中，这不仅仅是一个效率问题了，而是出现这种情况，一个上行帧都无法传输出去，造成的问题比较大。</li>
</ul>
<p>所以在802.11ax中，为了解决该问题，引出了一个新的设计即为动态帧分片技术。</p>
<p>在802.11ax中，传输都是由AP同意调度的。无论上行还是下行，AP都会为节点分配好传输所用的RU数目，传输速率MCS之类。</p>
<p>然而，在OFDMA传输过程时，传输时间也是由AP设定的。标准情况下，AP可以通过BSR机制，基于节点的待传数据包大小设置。然而，在UORA传输时则无法准确设置。此时有可能会出现，节点待传数据所需时间会大于TXOP时间，比如节点传输需要30ms，但是txop时间只有20ms，此时我们就需要引入动态帧分片。动态帧分片是针对于传统的静态帧分片技术做个补充。</p>
<p>其实除了上述这一个角度，我们可以理解动态帧分片技术的必要性。我们还可以换一个角度理解，也就是结合帧聚合技术理解动态帧分片。</p>
<p><img src="/posts/f22bd777/v2-6d78d6e905e0bc05dfff60c8ef97d662_720w.jpg" alt="TXOP时间较长"></p>
<p>如上图所示，如果TXOP时间较长，那么多余的部分是需要padding的。这一块padding能不能传输内容呢？在最传统的802.11中是不可以的，但是在帧聚合模式下，这是一个特例。</p>
<p>如果物理层传输的PPDU对应的是一个A-MPDU的话，也就是一个聚合帧的话。那么在传输过程前，节点可以决定我的聚合长度是多少。此时，如果节点一直传输的TXOP时间，并且剩余所需要的Padding的时间，那么此时节点可以利用动态帧分片技术，切出来一个短帧来补充这一块需要的Padding片段，从而提升效率。从这个角度而言，动态帧分片也是非常有价值的一个设计。</p>
<p>在协议中，动态帧分片一共包含3个等级：</p>
<p><img src="/posts/f22bd777/image-20210425163638902.png" alt="Fragmentation and defragmentation"></p>
<p>这三个实际上是针对不同场景的帧分片，比如说针对于非帧聚合模式下，以及针对于帧聚合模式下的帧分片。</p>
<h1 id="QTP（Quiet-Time-Period）和QP">15 QTP（Quiet Time Period）和QP</h1><h2 id="序言-13">15.1 序言</h2><p>QTP（Quiet Time Period）是802.11ax中新引入的技术，而QP（Quiet Period）是802.11协议初始就有的一个技术，两者都是在802.11协议中比较冷门的一个技术。在笔者的认知中，这两个技术最大的用处就是为了兼容，毕竟是商业协议，各种场景都需要考虑到。所以本文仅仅做一个笔记记录下。</p>
<h2 id="信道静默QP（Quiet-Period）">15.2 信道静默QP（Quiet Period）</h2><p>这里Quiet Period我们翻译成信道静默，这是参考802.11权威指南的翻译。我们知道802.11协议是工作在2.4GHz和5GHz频段的，这个频段在很多国家是有雷达设备也工作的。为了避免对雷达的干扰，802.11协议中采用了TPC和DFS两项技术。然而，究竟周边有没有雷达设备呢，这个时候实际上要802.11设备做一个探测的。</p>
<p>但是由于无线网络传输本身会影响探测结果。此时，我们就需要把整个网络静默一段时间，也就是不允许任何的数据包传输，让网络去检测周围有没有雷达信号。这个机制就是QP（Quite Period）机制。</p>
<p>QP时间是一个周期的时间，该周期间隔是通过Beacon或者Probe Response中的Quiet Element元素进行安排的。而QP时间的保护是通过NAV机制来实现的，这里是通过Quiet Element来实现NAV，有点类似于CFP时间可以由CF Parameter Set里面元素设置的一样。</p>
<p><img src="https://pic2.zhimg.com/80/v2-df6ef2432bb63c077d4ec1572b8599a1_720w.png" alt="img"></p>
<p>Quiet Element的结构如上图所示，其中Quiet Period是静默期，代表了QP时间的间隔（单位为几个Beacon间隔，也就是TBTT时间），Quiet Duration为静默持续的Duration时间。Quiet Offset是一个时间偏移，一般而言，Quiet时间是紧接着Beacon开始的，停止时间就是Quiet Duration，然而该时间也可以向后延迟，那么延迟的时间就是Quiet offset。</p>
<h2 id="静默时间QTP（Quiet-Time-Period）">15.3 静默时间QTP（Quiet Time Period）</h2><p>Quiet Time Period（QTP）我们目前就直译成静默时间。该机制是802.11ax中新引入的，由于802.11ax需要兼容过往的工作模式，其中最主要的就是ad-hoc模式，其他还有相关的P2P，TLS模式等，这一系列通信模式我们成为STA-STA直接通信。STA-STA通信会对密集网络场景的性能造成影响。因此，为了避免STA-STA通信对密集网络的性能影响，我们需要做一个时间调度，所以才有了QTP这个设计。</p>
<p>QTP是一个兼容类型的设计，其是通过设置了一个NAV保护时间，该保护时间内，基础架构模式的节点都不会通信，把信道让给STA-STA类型的节点，实际上就是进行了时间分配，关于STA-STA模式和基础架构模式下的节点。</p>
<p><img src="https://pic3.zhimg.com/80/v2-9cae957acc5324833310b03918591b86_720w.jpg" alt="img">参考：IEEE 802.11-16/1459r0</p>
<p>如上图所示，这里有三个帧，QTP Request，QTP Response以及QTP Setup。在802.11ax中，网络的控制基本是掌握在AP手里的，这点是802.11ax的一个特点。因此，待传输的P2P节点首先需要向AP发送QTP Request帧，申请QTP传输。如果AP同意的话，那么AP会向其反馈QTP Response，与此同时，该AP还会向其余所有节点广播QTP Setup，这些节点收到QTP Setup后，实际上就被设置为了NAV状态。此时，收到QTP Response的节点知道信道已经被预约好了，可以直接进行一次P2P传输了，传输完成后，P2P的接收节点会反馈ACK。</p>
<p>这里的QTP Setup可以按照802.11ax的帧格式发送，如下图</p>
<p><img src="https://pic3.zhimg.com/80/v2-81473ef0bee6d98caa750043b0d26422_720w.jpg" alt="img"></p>
<p>此时，由于传统的802.11节点无法识别该802.11ax的帧（HE PPDU），所以这些传统的节点不会被置为NAV状态，只有802.11ax的节点才会。</p>
<p>如果是按照传统的802.11帧的形式发送QTP Setup，那么所有的节点都会在QTP时间被设置为NAV状态，如下图：</p>
<p><img src="https://pic1.zhimg.com/80/v2-0fa5064049fe0afffda1ea9c18e9bd0c_720w.jpg" alt="img"></p>
<p>以上，我们简单阐述了QTP技术的应用场景。主要是协议目前已经很复杂了，概念较多，尤其是QTP和QP这两个概念，因此做一个笔记记录下。</p>

      </div>
      
        <div class="copyright">
  <ul class="post-copyright">
    <li class="post-copyright-author">
    <strong>作者:  </strong>creekwater</a>
    </li>
    <li class="post-copyright-link">
    <strong>文章链接:  </strong>
    <a href="/posts/f22bd777.html" target="_blank" title="802.11ax">https://www.creekwater.cn/posts/f22bd777.html</a>
    </li>
    <li class="post-copyright-license">
      <strong>版权声明:   </strong>
      本网站所有文章除特别声明外,均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
      许可协议。转载请注明出处!
    </li>
  </ul>
<div>
      
    </article>
    <!-- 上一篇文章和下一篇文章 -->
    
      
<div class="post-nav">



  
  <div class="post-nav-prev post-nav-item">
    <div class="post-nav-img lazyload" data-original="/medias/2.jpg" style="background-size: cover; 
      background-position: center center;">
    </div>
    <a href="/posts/b9e0ade6.html" class="post-nav-link">
      <div class="title">
        <i class="fa fa-angle-left"></i> 上一篇:
        <div>Control OBSS/PD Sensitivity Threshold for IEEE 802.11ax BSS Color</div>
      </div>
      
      <!-- <div class="content">
        参考资料：Control_OBSS-PD_Sensitivity_Threshold_for_IEEE_802.11ax
      </div> -->
    </a>
  </div>



  
  <div class="post-nav-next post-nav-item">
    <div class="post-nav-img lazyload" data-original="/medias/4.jpg" style="background-size: cover; 
      background-position: center center;">
    </div>
    <a href="/posts/3ec6640a.html" class="post-nav-link">
      <div class="title">
        下一篇: <i class="fa fa-angle-right"></i>
        <div>CSS参考手册</div>
      </div>
      <!-- <div class="content">
        0.1 CSS 属性0.1.1 A


align-content
规定弹性容器内的行之间的对齐方式，当项目不使用所有可
      </div> -->
    </a>
  </div>

</div>

    
    

    <!-- 打赏 -->
    
      <div id="appDonate" class="post-donate">
  <div id="donate_board" class="donate_bar center" ref="donate">
    <a id="btn_donate" class="btn_donate" href="javascript:;" title="打赏" @click="showDialogDrawer()"></a>
  </div>
  <transition name="fade">
    <div 
      class="donate-box-mask"
      v-cloak 
      v-if="visible"
      @click="cancelDialogDrawer()"
    >
    </div>
  </transition>
  <transition name="bounce">
    <div class="donate-box" v-cloak v-if="visible">
      <div class="donate-box_close">
        <i class="fa fa-times" aria-hidden="true" @click="cancelDialogDrawer"></i>
      </div>
      <div class="donate-box_title">
        <h4>
          你的赏识是我前进的动力
        </h4>
      </div>
      <div class="donate-box_tab">
        <div class="Alipay" :class="{'active': tabActive === 'Alipay'}" @click="changeTabActive('Alipay')">
          支付宝
        </div>
        <div class="WeChatpay" :class="{'active': tabActive === 'WeChatpay'}" @click="changeTabActive('WeChatpay')">
          微信
        </div>
      </div>
      <div class="donate-box_img">
        <div class="AlipayImg" v-if="tabActive === 'Alipay'">
          <img src="/medias/zfb.jpg" alt="支付宝打赏" />
        </div> 
        <div class="WeChatpayImg" v-if="tabActive === 'WeChatpay'">
          <img src="/medias/wx.jpg" alt="微信打赏" />
        </div>
      </div>
    </div>
  </transition>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDonate',
    data: {
      visible: false,
      tabActive: 'Alipay',
      top: 0,
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        // function getScroll() {
        //   return {
        //     left: window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft || 0,
        //     top: window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0
        //   };
        // }
        this.top = $(document).scrollTop() // or getScroll().top
        // console.log('aa', $('.main-content'));
        body.style.cssText = 'overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
      changeTabActive(name) {
        this.tabActive = name;
      }
    },
    created() {}
  })
</script>
    

    <!-- 分享 -->
    
      <!-- https://github.com/overtrue/share.js -->

<div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>

<script src="/js/shareJs/social-share.min.js"></script>
</script>

<style>
  .social-share {
    margin: 20px 0;
  }
</style>


    
    
    <!-- 评论 -->
      
        <div id="myComment">
          
            <section id="comments" style="padding: 1em; margin: 15px auto;"
	class="animated bounceInUp">
	<div id="vcomment" class="comment"></div>
	<script src="/js/valine/av-min@3.0.4.js"></script>
	<script src="https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js"></script>
	<script>

		var requiredFields = 'nick,mail';
  		requiredFields  = requiredFields.split(',');

		var valine = new Valine({
			el: '#vcomment',
			notify: false,
			verify: false,
			app_id: "Y204Pb7cYvSCT5zrsAa4DhGe-gzGzoHsz",
			app_key: "mthXbDKXvBv6b8M9FjG9CjFT",
			placeholder: "客官，说点什么吧",
			avatar: "",
			master: "72efbb90c3f61603fe9482f17526f7ea",   //博主邮箱md5
			tagMeta: ["博主","小伙伴","访客"],     //标识字段名
			friends: "",
			metaPlaceholder: { "nick": "昵称/QQ号", "mail": "邮箱" },
			requiredFields: requiredFields,
			enableQQ: true,
			// 设置Bilibili表情包地址
			emojiCDN: '//i0.hdslb.com/bfs/emote/',
			// 表情title和图片映射	
			emojiMaps: {
				"口罩": "https://i0.hdslb.com/bfs/emote/3ad2f66b151496d2a5fb0a8ea75f32265d778dd3.png",
				"微笑": "https://i0.hdslb.com/bfs/emote/685612eadc33f6bc233776c6241813385844f182.png",
				"笑": "https://i0.hdslb.com/bfs/emote/81edf17314cea3b48674312b4364df44d5c01f17.png",
				"呲牙": "https://i0.hdslb.com/bfs/emote/b5a5898491944a4268360f2e7a84623149672eb6.png",
				"OK": "https://i0.hdslb.com/bfs/emote/4683fd9ffc925fa6423110979d7dcac5eda297f4.png",
				"星星眼": "https://i0.hdslb.com/bfs/emote/63c9d1a31c0da745b61cdb35e0ecb28635675db2.png",
				"哦呼": "https://i0.hdslb.com/bfs/emote/362bded07ea5434886271d23fa25f5d85d8af06c.png",
				"歪嘴": "https://i0.hdslb.com/bfs/emote/4384050fbab0586259acdd170b510fe262f08a17.png",
				"嫌弃": "https://i0.hdslb.com/bfs/emote/de4c0783aaa60ec03de0a2b90858927bfad7154b.png",
				"喜欢": "https://i0.hdslb.com/bfs/emote/8a10a4d73a89f665feff3d46ca56e83dc68f9eb8.png",
				"酸了": "https://i0.hdslb.com/bfs/emote/92b1c8cbceea3ae0e8e32253ea414783e8ba7806.png",
				"大哭": "https://i0.hdslb.com/bfs/emote/2caafee2e5db4db72104650d87810cc2c123fc86.png",
				"害羞": "https://i0.hdslb.com/bfs/emote/9d2ec4e1fbd6cb1b4d12d2bbbdd124ccb83ddfda.png",
				"无语": "https://i0.hdslb.com/bfs/emote/44667b7d9349957e903b1b62cb91fb9b13720f04.png",
				"疑惑": "https://i0.hdslb.com/bfs/emote/b7840db4b1f9f4726b7cb23c0972720c1698d661.png",
				"辣眼睛": "https://i0.hdslb.com/bfs/emote/35d62c496d1e4ea9e091243fa812866f5fecc101.png",
				"调皮": "https://i0.hdslb.com/bfs/emote/8290b7308325e3179d2154327c85640af1528617.png",
				"喜极而泣": "https://i0.hdslb.com/bfs/emote/485a7e0c01c2d70707daae53bee4a9e2e31ef1ed.png",
				"奸笑": "https://i0.hdslb.com/bfs/emote/bb84906573472f0a84cebad1e9000eb6164a6f5a.png",
				"偷笑": "https://i0.hdslb.com/bfs/emote/6c49d226e76c42cd8002abc47b3112bc5a92f66a.png",
				"大笑": "https://i0.hdslb.com/bfs/emote/ca94ad1c7e6dac895eb5b33b7836b634c614d1c0.png",
				"阴险": "https://i0.hdslb.com/bfs/emote/ba8d5f8e7d136d59aab52c40fd3b8a43419eb03c.png",
				"捂脸": "https://i0.hdslb.com/bfs/emote/6921bb43f0c634870b92f4a8ad41dada94a5296d.png",
				"囧": "https://i0.hdslb.com/bfs/emote/12e41d357a9807cc80ef1e1ed258127fcc791424.png",
				"呆": "https://i0.hdslb.com/bfs/emote/33ad6000d9f9f168a0976bc60937786f239e5d8c.png",
				"抠鼻": "https://i0.hdslb.com/bfs/emote/cb89184c97e3f6d50acfd7961c313ce50360d70f.png",
				"惊喜": "https://i0.hdslb.com/bfs/emote/0afecaf3a3499479af946f29749e1a6c285b6f65.png",
				"惊讶": "https://i0.hdslb.com/bfs/emote/f8e9a59cad52ae1a19622805696a35f0a0d853f3.png",
				"笑哭": "https://i0.hdslb.com/bfs/emote/c3043ba94babf824dea03ce500d0e73763bf4f40.png",
				"妙啊": "https://i0.hdslb.com/bfs/emote/b4cb77159d58614a9b787b91b1cd22a81f383535.png",
				"doge": "https://i0.hdslb.com/bfs/emote/bba7c12aa51fed0199c241465560dfc2714c593e.png",
				"滑稽": "https://i0.hdslb.com/bfs/emote/d15121545a99ac46774f1f4465b895fe2d1411c3.png",
				"吃瓜": "https://i0.hdslb.com/bfs/emote/4191ce3c44c2b3df8fd97c33f85d3ab15f4f3c84.png",
				"打call": "https://i0.hdslb.com/bfs/emote/431432c43da3ee5aab5b0e4f8931953e649e9975.png",
				"点赞": "https://i0.hdslb.com/bfs/emote/1a67265993913f4c35d15a6028a30724e83e7d35.png",
				"鼓掌": "https://i0.hdslb.com/bfs/emote/895d1fc616b4b6c830cf96012880818c0e1de00d.png",
				"尴尬": "https://i0.hdslb.com/bfs/emote/cb321684ed5ce6eacdc2699092ab8fe7679e4fda.png",
				"冷": "https://i0.hdslb.com/bfs/emote/cb0ebbd0668640f07ebfc0e03f7a18a8cd00b4ed.png",
				"灵魂出窍": "https://i0.hdslb.com/bfs/emote/43d3db7d97343c01b47e22cfabeca84b4251f35a.png",
				"委屈": "https://i0.hdslb.com/bfs/emote/d2f26cbdd6c96960320af03f5514c5b524990840.png",
				"傲娇": "https://i0.hdslb.com/bfs/emote/010540d0f61220a0db4922e4a679a1d8eca94f4e.png",
				"疼": "https://i0.hdslb.com/bfs/emote/905fd9a99ec316e353b9bd4ecd49a5f0a301eabf.png",
				"吓": "https://i0.hdslb.com/bfs/emote/9c10c5ebc7bef27ec641b8a1877674e0c65fea5d.png",
				"生病": "https://i0.hdslb.com/bfs/emote/0f25ce04ae1d7baf98650986454c634f6612cb76.png",
				"吐": "https://i0.hdslb.com/bfs/emote/06946bfe71ac48a6078a0b662181bb5cad09decc.png",
				"嘘声": "https://i0.hdslb.com/bfs/emote/e64af664d20716e090f10411496998095f62f844.png",
				"捂眼": "https://i0.hdslb.com/bfs/emote/c5c6d6982e1e53e478daae554b239f2b227b172b.png",
				"思考": "https://i0.hdslb.com/bfs/emote/cfa9b7e89e4bfe04bbcd34ccb1b0df37f4fa905c.png",
				"再见": "https://i0.hdslb.com/bfs/emote/fc510306bae26c9aec7e287cdf201ded27b065b9.png",
				"翻白眼": "https://i0.hdslb.com/bfs/emote/eba54707c7168925b18f6f8b1f48d532fe08c2b1.png",
				"哈欠": "https://i0.hdslb.com/bfs/emote/888d877729cbec444ddbd1cf4c9af155a7a06086.png",
				"奋斗": "https://i0.hdslb.com/bfs/emote/bb2060c15dba7d3fd731c35079d1617f1afe3376.png",
				"墨镜": "https://i0.hdslb.com/bfs/emote/3a03aebfc06339d86a68c2d893303b46f4b85771.png",
				"撇嘴": "https://i0.hdslb.com/bfs/emote/531863568e5668c5ac181d395508a0eeb1f0cda4.png",
				"难过": "https://i0.hdslb.com/bfs/emote/a651db36701610aa70a781fa98c07c9789b11543.png",
				"抓狂": "https://i0.hdslb.com/bfs/emote/4c87afff88c22439c45b79e9d2035d21d5622eba.png",
				"生气": "https://i0.hdslb.com/bfs/emote/3195714219c4b582a4fb02033dd1519913d0246d.png",
				"视频卫星": "https://i0.hdslb.com/bfs/emote/dce6fc7d6dfeafff01241924db60f8251cca5307.png",
				"十周年": "https://i0.hdslb.com/bfs/emote/1eacd3f7816e70aff9c1b1a2e9605240466f599b.png",
				"11周年": "https://i0.hdslb.com/bfs/emote/d3b2d5dc028c75ae4df379f4c3afbe186d0f6f9b.png",
				"鸡腿": "https://i0.hdslb.com/bfs/emote/c7860392815d345fa69c4f00ef18d67dccfbd574.png",
				"干杯": "https://i0.hdslb.com/bfs/emote/8da12d5f55a2c7e9778dcc05b40571979fe208e6.png",
				"爱心": "https://i0.hdslb.com/bfs/emote/ed04066ea7124106d17ffcaf75600700e5442f5c.png",
				"锦鲤": "https://i0.hdslb.com/bfs/emote/643d6c19c8164ffd89e3e9cdf093cf5d773d979c.png",
				"胜利": "https://i0.hdslb.com/bfs/emote/b49fa9f4b1e7c3477918153b82c60b114d87347c.png",
				"加油": "https://i0.hdslb.com/bfs/emote/c7aaeacb21e107292d3bb053e5abde4a4459ed30.png",
				"保佑": "https://i0.hdslb.com/bfs/emote/fafe8d3de0dc139ebe995491d2dac458a865fb30.png",
				"抱拳": "https://i0.hdslb.com/bfs/emote/89516218158dbea18ab78e8873060bf95d33bbbe.png",
				"响指": "https://i0.hdslb.com/bfs/emote/1b5c53cf14336903e1d2ae3527ca380a1256a077.png",
				"支持": "https://i0.hdslb.com/bfs/emote/3c210366a5585706c09d4c686a9d942b39feeb50.png",
				"拥抱": "https://i0.hdslb.com/bfs/emote/41780a4254750cdaaccb20735730a36044e98ef3.png",
				"怪我咯": "https://i0.hdslb.com/bfs/emote/07cc6077f7f7d75b8d2c722dd9d9828a9fb9e46d.png",
				"跪了": "https://i0.hdslb.com/bfs/emote/f2b3aee7e521de7799d4e3aa379b01be032698ac.png",
				"黑洞": "https://i0.hdslb.com/bfs/emote/e90ec4c799010f25391179118ccd9f66b3b279ba.png",
				"老鼠": "https://i0.hdslb.com/bfs/emote/8e6fb491eb1bb0d5862e7ec8ccf9a3da12b6c155.png",
				"2020": "https://i0.hdslb.com/bfs/emote/dc709fac0d361370bcf0d36d32adb97df7c95824.png",
				"福到了": "https://i0.hdslb.com/bfs/emote/5de5373d354c373cf1617b6b836f3a8d53c5a655.png",
				"加油武汉": "https://i0.hdslb.com/bfs/emote/eb966aaa5b690d3f9308a9f936f5b5a72a7f956b.png",
				"粽子": "https://i0.hdslb.com/bfs/emote/177999fb7d70d891fbf63b161f26b272e08dc1de.png",
				"月饼": "https://i0.hdslb.com/bfs/emote/89b19c5730e08d6f12fadf6996de5bc2e52f81fe.png",
				"高兴": "https://i0.hdslb.com/bfs/emote/416570a8aca7be12fb2c36e4b846906653f6d294.png",
				"气愤": "https://i0.hdslb.com/bfs/emote/069b029d17a086ab475fd331697a649e234850bb.png",
				"耍帅": "https://i0.hdslb.com/bfs/emote/d7a38b08d1f1cc35b19c35041f29ffcc48808e87.png",
				"酷仔": "https://i0.hdslb.com/bfs/emote/390100ada4659b4516984d386499fb22c0025084.png",
				"画风突变": "https://i0.hdslb.com/bfs/emote/ba4de7a3f97644038b15195bdc9f82a8fd118e77.png",
				"福": "https://i0.hdslb.com/bfs/emote/802429a301ac5b35a0480d9526a070ce67cd8097.png",
				"赞了": "https://i0.hdslb.com/bfs/emote/40ded585bbd6328fc390076b5de224fd38b46793.png",
				"暗中观察": "https://i0.hdslb.com/bfs/emote/80a752e0718db211e4135b4ba821813f4c151e2c.png",
				"么么哒": "https://i0.hdslb.com/bfs/emote/2f418440776e88605ddc426eac898202c1f5fa4d.png",
				"哭哭": "https://i0.hdslb.com/bfs/emote/cbf36e518f1d50618f6d054aa69993ecc339fe8f.png",
				"饿了": "https://i0.hdslb.com/bfs/emote/ff91ea94adf7c5b04db305c18d17b444f7360059.png",
				"问号": "https://i0.hdslb.com/bfs/emote/a905b58b32016a1f0ff7d9193b62749f0d491707.png",
				"嘿嘿": "https://i0.hdslb.com/bfs/emote/8a15a45e228179f912ce11dbd5478f6ad54e9854.png",
				"卖萌": "https://i0.hdslb.com/bfs/emote/a0d37b43d1e786ba811d9b0ae590c479dcce6c44.png",
				"喵": "https://i0.hdslb.com/bfs/emote/eb46e78c9d86ccbe9842f0235c7cb4f4e0e80a57.png",
				"tv-白眼": "https://i0.hdslb.com/bfs/emote/c1d59f439e379ee50eef488bcb5e5378e5044ea4.png",
				"tv-doge": "https://i0.hdslb.com/bfs/emote/6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png",
				"tv-坏笑": "https://i0.hdslb.com/bfs/emote/1f0b87f731a671079842116e0991c91c2c88645a.png",
				"tv-难过": "https://i0.hdslb.com/bfs/emote/87f46748d3f142ebc6586ff58860d0e2fc8263ba.png",
				"tv-生气": "https://i0.hdslb.com/bfs/emote/26702dcafdab5e8225b43ffd23c94ac1ff932654.png",
				"tv-委屈": "https://i0.hdslb.com/bfs/emote/d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png",
				"tv-斜眼笑": "https://i0.hdslb.com/bfs/emote/911f987aa8bc1bee12d52aafe62bc41ef4474e6c.png",
				"tv-呆": "https://i0.hdslb.com/bfs/emote/fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png",
				"tv-发怒": "https://i0.hdslb.com/bfs/emote/34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png",
				"tv-惊吓": "https://i0.hdslb.com/bfs/emote/0d15c7e2ee58e935adc6a7193ee042388adc22af.png",
				"tv-呕吐": "https://i0.hdslb.com/bfs/emote/9f996894a39e282ccf5e66856af49483f81870f3.png",
				"tv-思考": "https://i0.hdslb.com/bfs/emote/90cf159733e558137ed20aa04d09964436f618a1.png",
				"tv-微笑": "https://i0.hdslb.com/bfs/emote/70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png",
				"tv-疑问": "https://i0.hdslb.com/bfs/emote/0793d949b18d7be716078349c202c15ff166f314.png",
				"tv-大哭": "https://i0.hdslb.com/bfs/emote/23269aeb35f99daee28dda129676f6e9ea87934f.png",
				"tv-鼓掌": "https://i0.hdslb.com/bfs/emote/1d21793f96ef4e6f48b23e53e3b9e42da833a0f6.png",
				"tv-抠鼻": "https://i0.hdslb.com/bfs/emote/c666f55e88d471e51bbd9fab9bb308110824a6eb.png",
				"tv-亲亲": "https://i0.hdslb.com/bfs/emote/a8111ad55953ef5e3be3327ef94eb4a39d535d06.png",
				"tv-调皮": "https://i0.hdslb.com/bfs/emote/b9c41de8e82dd7a8515ae5e3cb63e898bf245186.png",
				"tv-笑哭": "https://i0.hdslb.com/bfs/emote/1abc628f6d4f4caf9d0e7800878f4697abbc8273.png",
				"tv-晕": "https://i0.hdslb.com/bfs/emote/5443c22b4d07fb1907ccc610c8e6db254f2461b7.png",
				"tv-点赞": "https://i0.hdslb.com/bfs/emote/f85c354995bd99e28fc76c869bfe42ba6438eff4.png",
				"tv-害羞": "https://i0.hdslb.com/bfs/emote/a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png",
				"tv-睡着": "https://i0.hdslb.com/bfs/emote/8b196675b53af58264f383c50ad0945048290b33.png",
				"tv-色": "https://i0.hdslb.com/bfs/emote/61822c7e9aae5da76475e7892534545336b23a6f.png",
				"tv-吐血": "https://i0.hdslb.com/bfs/emote/09dd16a7aa59b77baa1155d47484409624470c77.png",
				"tv-无奈": "https://i0.hdslb.com/bfs/emote/ea8ed89ee9878f2fece2dda0ea8a5dbfe21b5751.png",
				"tv-再见": "https://i0.hdslb.com/bfs/emote/180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png",
				"tv-流汗": "https://i0.hdslb.com/bfs/emote/cead1c351ab8d79e9f369605beb90148db0fbed3.png",
				"tv-偷笑": "https://i0.hdslb.com/bfs/emote/bb690d4107620f1c15cff29509db529a73aee261.png",
				"tv-抓狂": "https://i0.hdslb.com/bfs/emote/fe31c08edad661d63762b04e17b8d5ae3c71a757.png",
				"tv-黑人问号": "https://i0.hdslb.com/bfs/emote/45821a01f51bc867da9edbaa2e070410819a95b2.png",
				"tv-困": "https://i0.hdslb.com/bfs/emote/241ee304e44c0af029adceb294399391e4737ef2.png",
				"tv-打脸": "https://i0.hdslb.com/bfs/emote/56ab10b624063e966bfcb76ea5dc4794d87dfd47.png",
				"tv-闭嘴": "https://i0.hdslb.com/bfs/emote/c9e990da7f6e93975e25fd8b70e2e290aa4086ef.png",
				"tv-鄙视": "https://i0.hdslb.com/bfs/emote/6e72339f346a692a495b123174b49e4e8e781303.png",
				"tv-腼腆": "https://i0.hdslb.com/bfs/emote/89712c0d4af73e67f89e35cbc518420380a7f6f4.png",
				"tv-馋": "https://i0.hdslb.com/bfs/emote/fc7e829b845c43c623c8b490ee3602b7f0e76a31.png",
				"tv-可爱": "https://i0.hdslb.com/bfs/emote/9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png",
				"tv-发财": "https://i0.hdslb.com/bfs/emote/34db290afd2963723c6eb3c4560667db7253a21a.png",
				"tv-生病": "https://i0.hdslb.com/bfs/emote/8b0ec90e6b86771092a498c54f09fc94621c1900.png",
				"tv-流鼻血": "https://i0.hdslb.com/bfs/emote/c32d39db2737f89b904ca32700d140a9241b0767.png",
				"tv-尴尬": "https://i0.hdslb.com/bfs/emote/7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png",
				"tv-大佬": "https://i0.hdslb.com/bfs/emote/093c1e2c490161aca397afc45573c877cdead616.png",
				"tv-流泪": "https://i0.hdslb.com/bfs/emote/7e71cde7858f0cd50d74b0264aa26db612a8a167.png",
				"tv-冷漠": "https://i0.hdslb.com/bfs/emote/b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png",
				"tv-皱眉": "https://i0.hdslb.com/bfs/emote/72ccad6679fea0d14cce648b4d818e09b8ffea2d.png",
				"tv-鬼脸": "https://i0.hdslb.com/bfs/emote/0ffbbddf8a94d124ca2f54b360bbc04feb6bbfea.png",
				"tv-调侃": "https://i0.hdslb.com/bfs/emote/4bc022533ef31544ca0d72c12c808cf4a1cce3e3.png",
				"tv-目瞪口呆": "https://i0.hdslb.com/bfs/emote/0b8cb81a68de5d5365212c99375e7ace3e7891b7.png",
				"热词系列-知识增加": "https://i0.hdslb.com/bfs/emote/142409b595982b8210b2958f3d340f3b47942645.png",
				"热词系列-好家伙": "https://i0.hdslb.com/bfs/emote/63ec80dea3066bd9f449ba999ba531fa61f7b4eb.png",
				"热词系列-芜湖起飞": "https://i0.hdslb.com/bfs/emote/78d04c6ce78a613c90d510cd45fe7e25c57ba00b.png",
				"热词系列-爷青回": "https://i0.hdslb.com/bfs/emote/a26189ff1e681bddef7f6533f9aabe7604731a3e.png",
				"热词系列-梦幻联动": "https://i0.hdslb.com/bfs/emote/4809416be5ca787c2ec3e897e4fd022a58da6e0e.png",
				"热词系列-泪目": "https://i0.hdslb.com/bfs/emote/bba3703ab90b7d16fe9dbcb85ed949db687f8331.png",
				"热词系列-保护": "https://i0.hdslb.com/bfs/emote/55f8f6445ca7c3170cdfc5b16036abf639ce9b57.png",
				"热词系列-害怕": "https://i0.hdslb.com/bfs/emote/d77e2de26da143249f0c0ad7a608c27152c985bf.png",
				"热词系列-爱了爱了": "https://i0.hdslb.com/bfs/emote/2a165b555ba20391316366c664ed7891883dc5aa.png",
				"热词系列-吹爆": "https://i0.hdslb.com/bfs/emote/b528220f9c37256ed6a37f05bf118e44b08b81e5.png",
				"热词系列-三连": "https://i0.hdslb.com/bfs/emote/21f15fe11b7a84d2f2121c16dec50a4e4556f865.png",
				"热词系列-可以": "https://i0.hdslb.com/bfs/emote/e08543c71202b36c590094417fcfbb80c3506cd8.png",
				"热词系列-希望没事": "https://i0.hdslb.com/bfs/emote/6c0d2e6c486d1ba5afd6204a96e102652464a01d.png",
				"热词系列-打卡": "https://i0.hdslb.com/bfs/emote/a9cf77c78e1b9b40aa3ed4862402fba008ee2f51.png",
				"热词系列-skr": "https://i0.hdslb.com/bfs/emote/bd285ff94db16ad52557c3effe930d64663e8375.png",
				"热词系列-battle": "https://i0.hdslb.com/bfs/emote/f2f81c8e47db6252becd633a5d1ee14e15df2ea8.png",
				"热词系列-DNA": "https://i0.hdslb.com/bfs/emote/f6eb74f8230588f61a298af89061a7d75c5762e5.png",
				"热词系列-妙啊": "https://i0.hdslb.com/bfs/emote/0e98299d7decf5eaffad854977946075c3e91cb8.png",
				"热词系列-这次一定": "https://i0.hdslb.com/bfs/emote/a01ca28923daa7cc896c42f27deb4914e20dd572.png",
				"热词系列-AWSL": "https://i0.hdslb.com/bfs/emote/c37f88cf799f9badf9d84b7671dc3dd98c0fc0c2.png",
				"热词系列-递话筒": "https://i0.hdslb.com/bfs/emote/98e6950e39fbb4dd1c576042063ca632074070ba.png",
				"热词系列-你细品": "https://i0.hdslb.com/bfs/emote/535e00658e7e47966f154d3a167fa2365ebc4321.png",
				"热词系列-咕咕": "https://i0.hdslb.com/bfs/emote/d8065c2e7ce48c929317a94553499a46fecc262a.png",
				"热词系列-标准结局": "https://i0.hdslb.com/bfs/emote/3de98174b510cf7dc5fd1bd08c5d881065e79137.png",
				"热词系列-危": "https://i0.hdslb.com/bfs/emote/5cc6c3357c4df544dd8de9d5c5c0cec97c7c9a56.png",
				"热词系列-张三": "https://i0.hdslb.com/bfs/emote/255a938f39cea625032b6650036b31aa26c50a3c.png",
				"热词系列-害": "https://i0.hdslb.com/bfs/emote/cbe798a194612958537c5282fcca7c3bcd2aa15c.png",
				"热词系列-我裂开了": "https://i0.hdslb.com/bfs/emote/29bd57ec4e8952880fea6c9e47aee924e91f10c4.png",
				"热词系列-有内味了": "https://i0.hdslb.com/bfs/emote/7ca61680a905b5b6e2e335c630e725b648b03b4d.png",
				"热词系列-猛男必看": "https://i0.hdslb.com/bfs/emote/c97064450528a0e45c7e7c365a15fbb13fd61d8c.png",
				"热词系列-奥力给": "https://i0.hdslb.com/bfs/emote/c9b8683827ec6c00fea5327c9bec14f581cef2aa.png",
				"热词系列-问号": "https://i0.hdslb.com/bfs/emote/c1d1e76c12180adc8558f47006fe0e7ded4154bb.png",
				"热词系列-我哭了": "https://i0.hdslb.com/bfs/emote/9e0b3877d649aaf6538fbdd3f937e240a9d808e4.png",
				"热词系列-高产": "https://i0.hdslb.com/bfs/emote/9db817cba4a7f4a42398f3b2ec7c0a8e0c247c42.png",
				"热词系列-我酸了": "https://i0.hdslb.com/bfs/emote/a8cbf3f6b8cd9377eeb15b9172f3cd683b2e4650.png",
				"热词系列-真香": "https://i0.hdslb.com/bfs/emote/e68497c775feaac1c3b1a6cd63a50cfb11b767c4.png",
				"热词系列-我全都要": "https://i0.hdslb.com/bfs/emote/d424d1ad8d14c1c9b8367842bc68c658b9229bc1.png",
				"热词系列-神仙UP": "https://i0.hdslb.com/bfs/emote/a49e0d0db1e7d35a0f7411be13208951ab448f03.png",
				"热词系列-你币有了": "https://i0.hdslb.com/bfs/emote/84820c2b147a8ca02f3c4006b63f76c6313cbfa0.png",
				"热词系列-不愧是你": "https://i0.hdslb.com/bfs/emote/9ff2e356797c57ee3b1675ade0883d2d2247be9b.png",
				"热词系列-锤": "https://i0.hdslb.com/bfs/emote/35668cc12ae25b9545420e4a85bf21a0bfc03e5d.png",
				"热词系列-秀": "https://i0.hdslb.com/bfs/emote/50782fbf5d9b7f48f9467b5c53932981e321eedc.png",
				"热词系列-爷关更": "https://i0.hdslb.com/bfs/emote/faad40c56447f1f8abcb4045c17ce159d113d1fd.png",
				"热词系列-有生之年": "https://i0.hdslb.com/bfs/emote/f41fdafe2d0fbb8e8bc1598d2cf37e355560103a.png",
				"热词系列-镇站之宝": "https://i0.hdslb.com/bfs/emote/24e7a6a6e6383c987215fb905e3ee070aca259b5.png",
				"热词系列-我太南了": "https://i0.hdslb.com/bfs/emote/a523f3e4c63e4db1232365765d0ec452f83be97e.png",
				"热词系列-完结撒花": "https://i0.hdslb.com/bfs/emote/ea9db62ff5bca8e069cd70c4233353a802835422.png",
				"热词系列-大师球": "https://i0.hdslb.com/bfs/emote/f30089248dd137c568edabcb07cf67e0f6e98cf3.png",
				"热词系列-知识盲区": "https://i0.hdslb.com/bfs/emote/ccc94600b321a28116081e49ecedaa4ee8728312.png",
				"热词系列-“狼火”": "https://i0.hdslb.com/bfs/emote/33ccd3617bfa89e9d1498b13b7542b63f163e5de.png",
				"热词系列-你可真星": "https://i0.hdslb.com/bfs/emote/54c8ddff400abfe388060cabfbb579280fdea1be.png",
				"2233娘-大笑": "https://i0.hdslb.com/bfs/emote/16b8794be990cefa6caeba4d901b934a227ee3b8.png",
				"2233娘-吃惊": "https://i0.hdslb.com/bfs/emote/d1628c43d35b1530c0504a643ff80b6189fa0a43.png",
				"2233娘-大哭": "https://i0.hdslb.com/bfs/emote/476a2a60f6e337b8c0697a592e0aa82781f6b33b.png",
				"2233娘-耶": "https://i0.hdslb.com/bfs/emote/d7178e258a0efc969b65ccc2b1322fb235f5dff4.png",
				"2233娘-卖萌": "https://i0.hdslb.com/bfs/emote/ea893aa25355de95ab4f03c2dad3f0c58d0c159e.png",
				"2233娘-疑问": "https://i0.hdslb.com/bfs/emote/0b41f509351958dbb63d472fec0132d1bd03bd14.png",
				"2233娘-汗": "https://i0.hdslb.com/bfs/emote/247cd9df8cdf84b18368c21e3b2dd374e84c0927.png",
				"2233娘-困惑": "https://i0.hdslb.com/bfs/emote/714eeb4eae0d0933b4ff08b7df788b1982f6b940.png",
				"2233娘-怒": "https://i0.hdslb.com/bfs/emote/f31953119c51b9748016440ac0b632f779929b37.png",
				"2233娘-委屈": "https://i0.hdslb.com/bfs/emote/d9d0bf9d358af8d5761093ec66d4e3f60d963a63.png",
				"2233娘-郁闷": "https://i0.hdslb.com/bfs/emote/485203fe7100f2c8fc40b2800a18fe20b35f2f1a.png",
				"2233娘-第一": "https://i0.hdslb.com/bfs/emote/3754ee6e5985bd0bd7dfb668981f2a8733398ebd.png",
				"2233娘-喝水": "https://i0.hdslb.com/bfs/emote/695bf5429472049b52c1e0de586f8a2511195a23.png",
				"2233娘-吐魂": "https://i0.hdslb.com/bfs/emote/e999af499edf38a91ca68b1a9d2f97042c1d6734.png",
				"2233娘-无言": "https://i0.hdslb.com/bfs/emote/fdb5870f32cfaf7949e0f88a13f6feba4a48b719.png",
				"小电视-笑": "https://i0.hdslb.com/bfs/emote/f80d384875183dfe2e24be13011c595c0210d273.png",
				"小电视-发愁": "https://i0.hdslb.com/bfs/emote/05e279abbf3f72d5cc45548504a4220c5514b8b9.png",
				"小电视-赞": "https://i0.hdslb.com/bfs/emote/86ccf6d0b5480169bf80f3582fae09d7ed455c06.png",
				"小电视-差评": "https://i0.hdslb.com/bfs/emote/38456e3bde2839b00b536a8be13934fa57c8e298.png",
				"小电视-嘟嘴": "https://i0.hdslb.com/bfs/emote/6fd437f547ef1e4f231ff475d02f58bb94cef5a5.png",
				"小电视-汗": "https://i0.hdslb.com/bfs/emote/5c150cec77eae1b05d5ca46526450ff3beeb44d2.png",
				"小电视-害羞": "https://i0.hdslb.com/bfs/emote/de3aee88f7b6cc20ba9480c96c02f83a844381a9.png",
				"小电视-吃惊": "https://i0.hdslb.com/bfs/emote/05188008ea84c70d94e0076e28de15bf56f4c441.png",
				"小电视-哭泣": "https://i0.hdslb.com/bfs/emote/938bdf98df945576ae88e2a22931db07ded9e663.png",
				"小电视-太太喜欢": "https://i0.hdslb.com/bfs/emote/eb41a8c04840e4f77e76a4bff7a29ac89c432f4e.png",
				"小电视-好怒啊": "https://i0.hdslb.com/bfs/emote/68d524b7e515396b6563d320fb710c64abfb1063.png",
				"小电视-困惑": "https://i0.hdslb.com/bfs/emote/6853161f0eab3332b874ab7c6c0311035b7538f3.png",
				"小电视-我好兴奋": "https://i0.hdslb.com/bfs/emote/a695fe1301aab2675ab6f6e34757c25a863a8617.png",
				"小电视-思索": "https://i0.hdslb.com/bfs/emote/f8219e484d5a55787c3f1722dc3112d0eba03a69.png",
				"小电视-无语": "https://i0.hdslb.com/bfs/emote/fbd12affebfdaadd3d721bffdb685a6b1ee71219.png",
				"罗小黑-鼓掌": "https://i0.hdslb.com/bfs/emote/622ce9f5ec001269203aaaf8339dffdc7d67d2a3.png",
				"罗小黑-你好呀": "https://i0.hdslb.com/bfs/emote/65728d4bedb13fd75c1555c9c4c9de67d276b153.png",
				"罗小黑-加油": "https://i0.hdslb.com/bfs/emote/50d9d9e5f57c202be83cdfdba812a15524d02406.png",
				"罗小黑-可可爱爱": "https://i0.hdslb.com/bfs/emote/bcdfa28cd019333cdb243c3a8d73374236924585.png",
				"罗小黑-吃瓜": "https://i0.hdslb.com/bfs/emote/57d8965331c9fb87afa1756416b622a22e406c43.png",
				"罗小黑-嗨": "https://i0.hdslb.com/bfs/emote/7f5e00355af3331964884f27611cc9a0c64e5ce7.png",
				"罗小黑-大麦": "https://i0.hdslb.com/bfs/emote/0f5a51e0272c5fcc2c318e078e92e0f8fea77980.png",
				"罗小黑-干杯": "https://i0.hdslb.com/bfs/emote/04cf6b7a2f0f24909e1894694daa5c6c668e1f17.png",
				"罗小黑-找彩蛋": "https://i0.hdslb.com/bfs/emote/59e34db87c0cb601a5e100c2db0ccfb2894aa02f.png",
				"罗小黑-撒花": "https://i0.hdslb.com/bfs/emote/bbaaaa40328f32f3e3e41ffc77a70c057d0a13ad.png",
				"罗小黑-来了": "https://i0.hdslb.com/bfs/emote/fd1950da6509171ba144d138c4d0a81f0840794e.png",
				"罗小黑-歪在吗": "https://i0.hdslb.com/bfs/emote/0caf23cc530b0e021c32c623dee045160a2449fa.png",
				"罗小黑-求包养": "https://i0.hdslb.com/bfs/emote/2277c2b72646cf22a7217897f3cd62c5c80a6451.png",
				"罗小黑-看电影": "https://i0.hdslb.com/bfs/emote/eedd49d8d1d6c5b0eafc3e0a10966f508a7ab6f1.png",
				"罗小黑-真棒": "https://i0.hdslb.com/bfs/emote/f03fbb80a7939eafa4819388df80e9c777e8ab7d.png",
				"罗小黑-自来水": "https://i0.hdslb.com/bfs/emote/4a0c602ed9d4f1e5550c0595ea63653a9cbf88bd.png",
				"蛆音娘-卖萌": "https://i0.hdslb.com/bfs/emote/4cd1024d0c2ecee93224477946656d32c1705ccf.png",
				"蛆音娘-吃瓜群众": "https://i0.hdslb.com/bfs/emote/5d0d6cc54b508d30b4f50b6b5f7b7e1e259d84ea.png",
				"蛆音娘-吃惊": "https://i0.hdslb.com/bfs/emote/7a4cb0b644214d476ce198ddf6a7a0aa31311199.png",
				"蛆音娘-害怕": "https://i0.hdslb.com/bfs/emote/7407634bf67bfe9d7806f15d57608a1b18c2b4c2.png",
				"蛆音娘-扶额": "https://i0.hdslb.com/bfs/emote/a4d8f95baaa24821fd591a7dbeee1b869e760f59.png",
				"蛆音娘-滑稽": "https://i0.hdslb.com/bfs/emote/d3717f10ffe9787336bc39a09214270988521a67.png",
				"蛆音娘-哼": "https://i0.hdslb.com/bfs/emote/8854f1b8a82126e3b87f3a1563da5feb55b23e71.png",
				"蛆音娘-机智": "https://i0.hdslb.com/bfs/emote/e543c0a823ca915df9362283f4ae950e9e9cc2e9.png",
				"蛆音娘-哭泣": "https://i0.hdslb.com/bfs/emote/a23055546c19eba663b16370b8e072394d87ff53.png",
				"蛆音娘-睡觉觉": "https://i0.hdslb.com/bfs/emote/40ef7e6d931acb37e5514b70d13663e86dc3698b.png",
				"蛆音娘-生气": "https://i0.hdslb.com/bfs/emote/bf398cbbcfaae107d1b59aaf03895f38422e3d87.png",
				"蛆音娘-偷看": "https://i0.hdslb.com/bfs/emote/52463ded4f23649db10ba3ced662ed946c5edf0b.png",
				"蛆音娘-吐血": "https://i0.hdslb.com/bfs/emote/5772d22015e5b2b40a9fe302b5967ec7282ac848.png",
				"蛆音娘-无语": "https://i0.hdslb.com/bfs/emote/b6c763c6484ce2e48299ceb21861e46318868871.png",
				"蛆音娘-摇头": "https://i0.hdslb.com/bfs/emote/b7278f750c6f2235f41f37056d727f25d3bf781f.png",
				"蛆音娘-疑问": "https://i0.hdslb.com/bfs/emote/7750b698d15a1b8e83c0f59106e8e9cd5cb57897.png",
				"蛆音娘-die": "https://i0.hdslb.com/bfs/emote/52543025a070fde5c01a10320c9636ec3173ac99.png",
				"蛆音娘-OK": "https://i0.hdslb.com/bfs/emote/52a0dcee66c91bf123bf53bd48a269b1317d17f9.png",
				"蛆音娘-肥皂": "https://i0.hdslb.com/bfs/emote/7f1a857e9430dcf3050ce0ef5fa19aefebea6dc4.png",
				"蛆音娘-大笑": "https://i0.hdslb.com/bfs/emote/1d3355fb89c24ab3c50e5c152d8b990a290dc63e.png",
				"洛天依-傲娇": "https://i0.hdslb.com/bfs/emote/5d7c8307af10540909fce6121066249df3935a24.png",
				"洛天依-吃包群众": "https://i0.hdslb.com/bfs/emote/f8cdabfc1b81fd25b85b8457ee49a20a4fc5d91b.png",
				"洛天依-吃药": "https://i0.hdslb.com/bfs/emote/883e6654176ebcecafd3e52efa8ee842357e18a0.png",
				"洛天依-滑稽": "https://i0.hdslb.com/bfs/emote/692cef7ca51f935aaa499de7e4d6048c53f42324.png",
				"洛天依-哈哈哈": "https://i0.hdslb.com/bfs/emote/677c2f5555c1e79fc336a6283fdbbdc7ea88fec4.png",
				"洛天依-看透一切": "https://i0.hdslb.com/bfs/emote/4fac414b5002c3739b1ae24f2fc27b5f150ade24.png",
				"洛天依-打尻": "https://i0.hdslb.com/bfs/emote/2ab983b2519dc241666254de8e5352fbeedc96bb.png",
				"洛天依-前排": "https://i0.hdslb.com/bfs/emote/fbbc45e7aee2f256f691df539db0cfcc35b3be7d.png",
				"洛天依-去吧": "https://i0.hdslb.com/bfs/emote/0edeeb0d10d44302854e636c47f5dc3aa96a9206.png",
				"洛天依-冷漠": "https://i0.hdslb.com/bfs/emote/5f4385db3c9806b08ea15bd9ff444af9d9fe0c3a.png",
				"洛天依-可以": "https://i0.hdslb.com/bfs/emote/967377b83e37a0d5dd13bc0f4e4323abf10e4cbf.png",
				"洛天依-掀桌": "https://i0.hdslb.com/bfs/emote/803129b7a1143faabc63c2648335b7d506229e7a.png",
				"洛天依-消灭你": "https://i0.hdslb.com/bfs/emote/d96dccf8fa248ee34c7e4aba94e813bec28d2dd8.png",
				"洛天依-阴阳先生": "https://i0.hdslb.com/bfs/emote/65e195a8ac54bb678dd1c1e6ce6c5d4ba02761b3.png",
				"洛天依-无言以对": "https://i0.hdslb.com/bfs/emote/9cfd368b370acd40c1b8f933cec3fb24883356a5.png",
				"洛天依-？？？": "https://i0.hdslb.com/bfs/emote/f5f1ebe50c26d5f6d4e17cb983bd5ae59f103dda.png",
				"洛天依-爱你哦": "https://i0.hdslb.com/bfs/emote/7102c9e25359af8348489ff8529b3bb2c5bd05d0.png",
				"小A和小B-喝茶": "https://i0.hdslb.com/bfs/emote/d2acc1227312dd64284d809ab66d3c7f7d8ec020.png",
				"小A和小B-报警": "https://i0.hdslb.com/bfs/emote/7f482b82a3de44ae14537cbafcbc40cf65f7113e.png",
				"小A和小B-大哭": "https://i0.hdslb.com/bfs/emote/77545a5e420e2c43e0e4a7996a71769638ae3f90.png",
				"小A和小B-低头": "https://i0.hdslb.com/bfs/emote/0d23b726b084280f941f14919ce63c43f8bc724c.png",
				"小A和小B-哈哈哈哈": "https://i0.hdslb.com/bfs/emote/6f5210b7d0a6b14f586df1f91f5c3a46c1296b43.png",
				"小A和小B-司令": "https://i0.hdslb.com/bfs/emote/a594a91717e28bdcab82821086a41160a1345c45.png",
				"小A和小B-撒花": "https://i0.hdslb.com/bfs/emote/874d2c39a0ca891abce5e65fafc287e0c2d3bbea.png",
				"小A和小B-摊手": "https://i0.hdslb.com/bfs/emote/6f058f78bce5d1c9b370c3807c891e685bb68a17.png",
				"小A和小B-问号": "https://i0.hdslb.com/bfs/emote/f077d5ecf0e86f24991a104f995b3a652091d529.png",
				"小A和小B-躺": "https://i0.hdslb.com/bfs/emote/9038d450dbadaf132847d67cb26931aa5bf76d4c.png",
				"小A和小B-无语": "https://i0.hdslb.com/bfs/emote/1a805b885a1691e9bf4425164a9400e2457f4d1b.png",
				"小A和小B-应援": "https://i0.hdslb.com/bfs/emote/af8f017e383a1999e26a7f91c3ec3c83fbb7ba77.png",
				"小A和小B-NO": "https://i0.hdslb.com/bfs/emote/ee0de8296b20d295b79ea9b70ca4f126eb4aff1d.png",
				"小A和小B-OK": "https://i0.hdslb.com/bfs/emote/5ae25cc388c59192133f08345e461098fad4e63b.png",
				"小A和小B-吃瓜": "https://i0.hdslb.com/bfs/emote/70776b579d2952580249ac6a52e724850d037591.png",
				"小A和小B-捕捉": "https://i0.hdslb.com/bfs/emote/8bf33ff2f9699286102fb1a256a2523695c17d35.png",
				"芮小凸小凹-嗯？": "https://i0.hdslb.com/bfs/emote/f3c72e045ebd2487a381f50291be15b053767a80.png",
				"芮小凸小凹-超棒": "https://i0.hdslb.com/bfs/emote/987947c1bdac0bc10b684f28baaec78176023b83.png",
				"芮小凸小凹-哎": "https://i0.hdslb.com/bfs/emote/38bcf3a53b34551e5efa0cd0ee84fc7faa477a49.png",
				"芮小凸小凹-666": "https://i0.hdslb.com/bfs/emote/3e505cef421024a650b971c1f2db7f8ef1ad1840.png",
				"芮小凸小凹-哼": "https://i0.hdslb.com/bfs/emote/92e4a9d422f1604f2b1b3ea3f6057636273db56e.png",
				"芮小凸小凹-怀疑": "https://i0.hdslb.com/bfs/emote/587f22aa1cfaa4b2d91928998e023be29d8c3975.png",
				"芮小凸小凹-发现": "https://i0.hdslb.com/bfs/emote/147b6ba27d5cbb90d155f34c41cb45f1f00b6007.png",
				"芮小凸小凹-绝望": "https://i0.hdslb.com/bfs/emote/22ad072a785604f3bd8c1aae4ea1ceb1e4694cec.png",
				"芮小凸小凹-可爱": "https://i0.hdslb.com/bfs/emote/8bddb47b5877fd79e937aafeb7f4d69f58a8b6e4.png",
				"芮小凸小凹-警告": "https://i0.hdslb.com/bfs/emote/54607206c814409a99fac65fb3b780c6bbd1e60d.png",
				"芮小凸小凹-呵呵": "https://i0.hdslb.com/bfs/emote/811aa3ba5809a8d5936f988f953e5af7fd7c5351.png",
				"芮小凸小凹-膜拜": "https://i0.hdslb.com/bfs/emote/038c86c0e616f7ead667c6f7af32e54feac32965.png",
				"芮小凸小凹-哭": "https://i0.hdslb.com/bfs/emote/000c0dddd08950133740487a57873b389a3af457.png",
				"芮小凸小凹-无聊": "https://i0.hdslb.com/bfs/emote/62527ee5c4e80aad9b42069778c91f905c90d986.png",
				"芮小凸小凹-围观": "https://i0.hdslb.com/bfs/emote/c9b4fe6161f4a3cc884a5b03e9674c8a58ee228f.png",
				"芮小凸小凹-失落": "https://i0.hdslb.com/bfs/emote/813f98c0632587286c6e809a49eda15a2edfa447.png",
				"芮小凸小凹-是吗": "https://i0.hdslb.com/bfs/emote/05b7153fb606e526ce8d102febd25889828ce425.png",
				"芮小凸小凹-心动": "https://i0.hdslb.com/bfs/emote/24afe39fbf8755a28673bdf51bdf8ce72bc62d51.png",
				"芮小凸小凹-喜欢": "https://i0.hdslb.com/bfs/emote/b389e30a3c7924ca2b59a5333412b8d92cad07df.png",
				"芮小凸小凹-嘻嘻": "https://i0.hdslb.com/bfs/emote/b7a4a07a7c24f5fa23a99ca6749708fadfedf765.png",
				"芮小凸小凹-震撼": "https://i0.hdslb.com/bfs/emote/79c8b68509a9d316618d61aedaae93097669dae6.png",
				"芮小凸小凹-有见解": "https://i0.hdslb.com/bfs/emote/7f842228b9a2c36851cecab0527fca55a1f01b58.png",
				"芮小凸小凹-震惊": "https://i0.hdslb.com/bfs/emote/be4b48350b817af496bdccba2ab85c77b711cec3.png",
				"芮小凸小凹-心痛": "https://i0.hdslb.com/bfs/emote/b2217e8b81f122949f3960d99c08ac72eac5923b.png",
				"灵笼-鄙视": "https://i0.hdslb.com/bfs/emote/20eda4b6b0074c6fb568e11698eb8dfc57011ac1.png",
				"灵笼-不用了": "https://i0.hdslb.com/bfs/emote/a7a027228e024d13f743ee42d9be107d53464134.png",
				"灵笼-吃瓜": "https://i0.hdslb.com/bfs/emote/2e0cab7ca9bedcb00830b483725fcc9c314faaf8.png",
				"灵笼-吃糖": "https://i0.hdslb.com/bfs/emote/c65e3e8dd67a7a7ce438649d5d1544e4eba0c3a6.png",
				"灵笼-机智": "https://i0.hdslb.com/bfs/emote/4e0e67f242b29c39bd9f8bbc03ab31e1ce232d37.png",
				"灵笼-惊吓": "https://i0.hdslb.com/bfs/emote/7b7fd1cdaccb0a69c2cdfe2a5fe8b97524ebf1d8.png",
				"灵笼-生闷气": "https://i0.hdslb.com/bfs/emote/9fe2340ff00fa447cac6ffd64650fc0842a2a4de.png",
				"灵笼-玩手机": "https://i0.hdslb.com/bfs/emote/c40b4dc357514724eeabbc94b26e89a9850466b6.png",
				"灵笼-问号": "https://i0.hdslb.com/bfs/emote/5b1a7af13e40057a9f48c802241e230bd0f3bcf4.png",
				"灵笼-嫌弃": "https://i0.hdslb.com/bfs/emote/8386721ed1e19c7b1e268a6457bbd3463ab220c0.png",
				"灵笼-笑哭": "https://i0.hdslb.com/bfs/emote/bfa87db44e8758701b7452f5b0aa2f107f69ec0f.png",
				"灵笼-兴奋": "https://i0.hdslb.com/bfs/emote/b211b575c45d1f0ebb347e06999b3dbe7c256c64.png",
				"灵笼-阴暗": "https://i0.hdslb.com/bfs/emote/92cd50cd6a4fd863751be57ef2b82e4d965955aa.png",
				"灵笼-约吗": "https://i0.hdslb.com/bfs/emote/275c161b17c3a4bdda2833720989a67b2e5b264d.png",
				"灵笼-boom": "https://i0.hdslb.com/bfs/emote/e27fbd34d8232f9c69b53a2b7013a3b597086444.png",
				"灵笼-偷窥": "https://i0.hdslb.com/bfs/emote/4c1f0ba96b2baa6d44f33553d0298d63ec47bfbd.png",
				"正经人-欢呼": "https://i0.hdslb.com/bfs/emote/3cd297676b2a08a896deab91ed7f139a8bc7c46c.png",
				"正经人-火": "https://i0.hdslb.com/bfs/emote/78579a24b156501c0b5583121beb42a72e9229b5.png",
				"正经人-挤": "https://i0.hdslb.com/bfs/emote/7a3e753fcb876753800424edd2fa3563005abf4a.png",
				"正经人-惊": "https://i0.hdslb.com/bfs/emote/233b14fd3803a5078f79d31fecd5d7a60524e330.png",
				"正经人-放屁": "https://i0.hdslb.com/bfs/emote/b590df4714084b012e9a5dfab03a3a13936dff48.png",
				"正经人-ok": "https://i0.hdslb.com/bfs/emote/21e069065373be45b227a4ffdbe9570d309e3d05.png",
				"正经人-趴": "https://i0.hdslb.com/bfs/emote/39156acb0afcbde9cf73ac1657adff62d3a84af7.png",
				"正经人-开始": "https://i0.hdslb.com/bfs/emote/4f745fad9a77f2f41ea63c2214af0739ab7ea8f1.png",
				"正经人-揉脸": "https://i0.hdslb.com/bfs/emote/a9d5376d6d79482c4447eb5a169385fa91f39ddd.png",
				"正经人-躺": "https://i0.hdslb.com/bfs/emote/c135f76ad7ec50a7414095cf7c633eb5551c9fe3.png",
				"正经人-拉": "https://i0.hdslb.com/bfs/emote/03e7319b34763e9c82c2ae93b1fd8f613335d90a.png",
				"正经人-心": "https://i0.hdslb.com/bfs/emote/536561d0806f8b181473fd89bba15e71cb8d585e.png",
				"正经人-悠闲": "https://i0.hdslb.com/bfs/emote/17542aaef102f28508e30fed8895cc1afeaf70f0.png",
				"正经人-赞": "https://i0.hdslb.com/bfs/emote/589816d36c5b7c2f2bc78cb162d6ac90fda948f2.png",
				"正经人-哭": "https://i0.hdslb.com/bfs/emote/b9882f0679b4ae24624660412464f1f88bda48fe.png",
				"请吃红小豆吧！-wow": "https://i0.hdslb.com/bfs/emote/3392ba98d2bbdc4c1932952bf63796f7ac1b1f41.png",
				"请吃红小豆吧！-吃包": "https://i0.hdslb.com/bfs/emote/f6cbadf8ff006c246c7bd583288587a6e20e6069.png",
				"请吃红小豆吧！-倒地": "https://i0.hdslb.com/bfs/emote/5b7ede3d668a82ae9ef50d380bb41274757c7780.png",
				"请吃红小豆吧！-盯": "https://i0.hdslb.com/bfs/emote/5c1cad1724fff3597913fe9a09bcb4b41b712ecf.png",
				"请吃红小豆吧！-翻白眼": "https://i0.hdslb.com/bfs/emote/633249bc889384ab3f1e2bd45d578fb7dbe2e109.png",
				"请吃红小豆吧！-好难": "https://i0.hdslb.com/bfs/emote/116cf8aff996554df096b9a1bdc59dd182fa8b22.png",
				"请吃红小豆吧！-喝水": "https://i0.hdslb.com/bfs/emote/c227ab352460cab6af9e543811a3451d6aa63908.png",
				"请吃红小豆吧！-嘿嘿嘿": "https://i0.hdslb.com/bfs/emote/b24f7db309a7ab96a00f81a1f26d1d4e06761c2d.png",
				"请吃红小豆吧！-开心": "https://i0.hdslb.com/bfs/emote/0903bb143efa6ec71ce5eb91e1bcd9815028eace.png",
				"请吃红小豆吧！-哭唧唧": "https://i0.hdslb.com/bfs/emote/516bc179c7312b7087573b5e2d7fc7b1ababa8e2.png",
				"请吃红小豆吧！-略略略": "https://i0.hdslb.com/bfs/emote/8bd5c57cb9ef5f511b3cb8119072182e3029fddc.png",
				"请吃红小豆吧！-么么": "https://i0.hdslb.com/bfs/emote/7a59397394b007fef659fc240bb2c3348930efb6.png",
				"请吃红小豆吧！-哦": "https://i0.hdslb.com/bfs/emote/20bcbc681d217027f605c1d667332ecc45744569.png",
				"请吃红小豆吧！-撒娇": "https://i0.hdslb.com/bfs/emote/74e611ffcd6702fce6e75bea435eb01744c503f8.png",
				"请吃红小豆吧！-受到惊吓": "https://i0.hdslb.com/bfs/emote/ffe8b5af6c2e3baa13e8ba9bb5685896311cab84.png",
				"请吃红小豆吧！-睡觉": "https://i0.hdslb.com/bfs/emote/f6098a8f9a77eb0753064aea2d17e9093d4ef8e0.png",
				"请吃红小豆吧！-问号脸": "https://i0.hdslb.com/bfs/emote/c6fe095df24f3fbf27f2e0fbb4b6eb983cbd430f.png",
				"请吃红小豆吧！-耶耶耶": "https://i0.hdslb.com/bfs/emote/973dd2de70275ec9f325ac8f64957f2e763c6ea3.png",
				"请吃红小豆吧！-一脸懵逼": "https://i0.hdslb.com/bfs/emote/8f6e7d3128bbc070116617cf840ceccbf2412187.png",
				"请吃红小豆吧！-眨眼": "https://i0.hdslb.com/bfs/emote/b2106dbba47b42276ea39a8d7d39b8cd21297485.png",
				"异常生物见闻录-good": "https://i0.hdslb.com/bfs/emote/5ca4eda998ed16a5826e7f92ca2e3f3969889e63.png",
				"异常生物见闻录-不信任": "https://i0.hdslb.com/bfs/emote/edb38ebc3b3be3583df4fd4c57e1b29347516d74.png",
				"异常生物见闻录-财迷": "https://i0.hdslb.com/bfs/emote/c67bbb41136823e7a2847ce72480df0e870b4d88.png",
				"异常生物见闻录-嘲讽": "https://i0.hdslb.com/bfs/emote/a061406fa8f03f619aa28d456f5a8fcf683b3fb7.png",
				"异常生物见闻录-痴呆": "https://i0.hdslb.com/bfs/emote/1b3dba852ac79d76d8e8ff26d0b2839daf26adb9.png",
				"异常生物见闻录-憧憬": "https://i0.hdslb.com/bfs/emote/1e932e3f290f5374a251b7d87af215e63e007c80.png",
				"异常生物见闻录-道德标兵": "https://i0.hdslb.com/bfs/emote/eca679781792c534bfb7f918c35eb3c43153f5d1.png",
				"异常生物见闻录-抵死不从": "https://i0.hdslb.com/bfs/emote/2f237e931a437308568ba7ca181320fc8ea800ce.png",
				"异常生物见闻录-发现食物": "https://i0.hdslb.com/bfs/emote/5bc67e4826ba7e10cba116bd2c2ececd21cb1c42.png",
				"异常生物见闻录-奸笑": "https://i0.hdslb.com/bfs/emote/038f3bda1084fa6908698697bb0fc2f059ff4b32.png",
				"异常生物见闻录-绝望": "https://i0.hdslb.com/bfs/emote/2b4ba4af99f37b973d84f92fa7a27197812fa605.png",
				"异常生物见闻录-开心": "https://i0.hdslb.com/bfs/emote/1942ee8a4df95e2f1f58202c92cda1dd06cc4816.png",
				"异常生物见闻录-困倦": "https://i0.hdslb.com/bfs/emote/009cdfcf48cf227a2cc8da24958a8a5238053dc7.png",
				"异常生物见闻录-冷汗": "https://i0.hdslb.com/bfs/emote/2dc15a9724034c1061fb0c884db17c2d45028ad8.png",
				"异常生物见闻录-凉凉": "https://i0.hdslb.com/bfs/emote/8b2ec7e8bbcbfc5f752dbb4e4f3c1b5ce6681d86.png",
				"异常生物见闻录-萌": "https://i0.hdslb.com/bfs/emote/cd7465b0bb19bdf89f057ba8c3f5c279375936aa.png",
				"异常生物见闻录-请闭嘴": "https://i0.hdslb.com/bfs/emote/a8ab9e926321c865b9cb66e64668dbddb87a6b7b.png",
				"异常生物见闻录-帅醒": "https://i0.hdslb.com/bfs/emote/93b1ff2409f733079ca1145e7add98fe6540a07c.png",
				"异常生物见闻录-无语": "https://i0.hdslb.com/bfs/emote/d3d02774b35dcc6ef3483b1655d08e472e4ca3c7.png",
				"异常生物见闻录-装傻": "https://i0.hdslb.com/bfs/emote/d81eba4cf9800a72a9b72a11ca00c4ad458a8bc8.png",
				"异常生物见闻录-装文静": "https://i0.hdslb.com/bfs/emote/748ce4b0c5da67489f2ed070ccf9233293fedcd4.png",
				"星梦手记-吃瓜": "https://i0.hdslb.com/bfs/emote/9227318a903c96e0e4a61f06ef208150ce470f66.png",
				"星梦手记-薇薇惊吓": "https://i0.hdslb.com/bfs/emote/093634e9099f40f40886a83133de5a67ca148bce.png",
				"星梦手记-惺梛认真": "https://i0.hdslb.com/bfs/emote/16fcbf1de40cb19d26a13552a3740150e45aa89f.png",
				"星梦手记-石化": "https://i0.hdslb.com/bfs/emote/f6a6d33835a48e4141fb433bbd0215b1130cf681.png",
				"星梦手记-问号": "https://i0.hdslb.com/bfs/emote/4ced3d8866f502487ec2e93b326f592f4c358fbf.png",
				"星梦手记-卖萌": "https://i0.hdslb.com/bfs/emote/375e4296c26f65be888e86bea4af4f858642a7bb.png",
				"星梦手记-尴尬": "https://i0.hdslb.com/bfs/emote/423347d687184c14d9ce8b47a8342fd8d23e99b9.png",
				"星梦手记-要抱": "https://i0.hdslb.com/bfs/emote/c125f4fc66ac8587fe4dd264254aad5dc4b31bef.png",
				"星梦手记-未来认真": "https://i0.hdslb.com/bfs/emote/330306ba001db1bd9f78bc99b8b6ec9341acbbcb.png",
				"星梦手记-摊手": "https://i0.hdslb.com/bfs/emote/acd565a268f66fa27e0ccea409b3ff57c814b360.png",
				"星梦手记-委屈": "https://i0.hdslb.com/bfs/emote/55f3974a6dded58365ef21e0a61d91725c3db431.png",
				"星梦手记-轮胎": "https://i0.hdslb.com/bfs/emote/bc13e24a1a0b58d9ef826b38e45960bfb4a3e11c.png",
				"星梦手记-没钱": "https://i0.hdslb.com/bfs/emote/e7d3feef58bf65441cbca1b8cd3c4b79cb923d15.png",
				"星梦手记-无辜": "https://i0.hdslb.com/bfs/emote/0be73bd600367f162a2a14d48c11ad72b3527858.png",
				"星梦手记-弃疗": "https://i0.hdslb.com/bfs/emote/fee923c0e57d1f1e3426b397edcfeac93d770b76.png",
				"星梦手记-雨照惊吓": "https://i0.hdslb.com/bfs/emote/4b1316f5bfd5c1745f8c721d845a6917d663c715.png",
				"冷兔-吃瓜": "https://i0.hdslb.com/bfs/emote/eed6831c5e3ceb1b23cb2ef0446b9c3c4d30f067.png",
				"冷兔-233": "https://i0.hdslb.com/bfs/emote/a7375691637b59ccbf75059fca01d9f95727a98a.png",
				"冷兔-这不科学": "https://i0.hdslb.com/bfs/emote/c9b24ea4f2e17d2faf88c0a2f1df367b135f45e7.png",
				"冷兔-？？？": "https://i0.hdslb.com/bfs/emote/8871cfa274a50f913cae368aa2ae428fbefe42da.png",
				"冷兔-等更": "https://i0.hdslb.com/bfs/emote/eb2763a2d48734d77327de5f57af43e155414b13.png",
				"冷兔-丢你雷姆": "https://i0.hdslb.com/bfs/emote/7ff16758d617cd1455c5f717f9c5b6863105abc1.png",
				"冷兔-耶": "https://i0.hdslb.com/bfs/emote/58b11a31381162761b3ebfb2e3e78bedf740cf17.png",
				"冷兔-无语": "https://i0.hdslb.com/bfs/emote/a22b1afafdfbee8b60b918cefce27ebd0c5dc915.png",
				"冷兔-额": "https://i0.hdslb.com/bfs/emote/805a33cfd96009f474ec2a7b6d0923e1a743aa29.png",
				"冷兔-呵呵": "https://i0.hdslb.com/bfs/emote/f6a80eda4c0401c523fe9931297a132d2c5c41a6.png",
				"冷兔-一无所知": "https://i0.hdslb.com/bfs/emote/d300fae68fa32dd918196e05f1d274e500a10087.png",
				"冷兔-体前屈": "https://i0.hdslb.com/bfs/emote/0f04dc139d9dd38e7b2f8db72c71f5ce89f60ac7.png",
				"冷兔-喜欢": "https://i0.hdslb.com/bfs/emote/4eda384b1e97430e48cd2faa28454f08f6daa70a.png",
				"冷兔-哭": "https://i0.hdslb.com/bfs/emote/bec3a906385324a4b472f0ed3b5323f905ae0f6b.png",
				"冷兔-赞": "https://i0.hdslb.com/bfs/emote/b001a8210f1c2166f436c8de080a76c33637036e.png",
				"冷兔-低头": "https://i0.hdslb.com/bfs/emote/ebe445da276339c0506267b0bb59a0b5ea3300d3.png",
				"冷兔-卖萌": "https://i0.hdslb.com/bfs/emote/4d9f8b35f0789afa40a48b0ce06769e5b4e60cb0.png",
				"冷兔-扶额": "https://i0.hdslb.com/bfs/emote/ff5c34e9072a83b56c2f2648cfe6ecf11b92f7be.png",
				"冷兔-掀桌": "https://i0.hdslb.com/bfs/emote/50d837346517f128442702eb7df04a82d20dbe89.png",
				"冷兔-吸欧气": "https://i0.hdslb.com/bfs/emote/16e696a795186a7ca2a4aeaa1dafcf225246add4.png",
				"那兔-合个影": "https://i0.hdslb.com/bfs/emote/0c12e40154dd0c73e2dd5e02ab8315bbaf905aec.png",
				"那兔-囧": "https://i0.hdslb.com/bfs/emote/0a6519dc3f8b4b58fea10e3b8a26d700728f95bf.png",
				"那兔-。。。": "https://i0.hdslb.com/bfs/emote/f5968dc3f8342019f4777d85c56fdda9df460ad4.png",
				"那兔-好滴": "https://i0.hdslb.com/bfs/emote/6d292369dc9d578da241b3e5680d4e2fa95b9aeb.png",
				"那兔-讲道理": "https://i0.hdslb.com/bfs/emote/29643a9f37d2b8981c50741fe6943947f9f31661.png",
				"那兔-懒得理你": "https://i0.hdslb.com/bfs/emote/3e1c2e302a52f7b03e9fda5ed37cc00844ba62bb.png",
				"那兔-奈我何": "https://i0.hdslb.com/bfs/emote/a6e38393214099abe9d402070d67d7747150cbbd.png",
				"那兔-你丫试试": "https://i0.hdslb.com/bfs/emote/0802020cec4543e96256d7dfadfd3cef9662aae0.png",
				"那兔-深思": "https://i0.hdslb.com/bfs/emote/44bde865b0954e1230caaa545ea91a5b6d90e424.png",
				"那兔-恶代官": "https://i0.hdslb.com/bfs/emote/91bcc90beb6f9cd1c7b3da4011f68d1ee7ab7132.png",
				"那兔-说什么喵": "https://i0.hdslb.com/bfs/emote/adca5e0ea594bcfd1d6480a6755f1bec3984811e.png",
				"那兔-心碎": "https://i0.hdslb.com/bfs/emote/f016a83fcdb0dbb5738e2f9fb62efd1f0971d17f.png",
				"那兔-一见钟情": "https://i0.hdslb.com/bfs/emote/cd6ae74fe5dd1b1252a1603af0a34c94b9ba931e.png",
				"那兔-痴呆": "https://i0.hdslb.com/bfs/emote/6a7020931d20380be2fb50a8d8c2e582f6d8ff89.png",
				"那兔-找事儿": "https://i0.hdslb.com/bfs/emote/55022a863de195f355394296647a8cea2ad69d57.png",
				"那兔-呃": "https://i0.hdslb.com/bfs/emote/06105d9eafe0316d69453da63b05ae76fdfa9a8a.png",
				"那兔-擦": "https://i0.hdslb.com/bfs/emote/db5d5e113501e2ec8ea51dee1c716a932d929949.png",
				"我家大师兄脑子有坑-比心": "https://i0.hdslb.com/bfs/emote/d675489bfcfdbac9734cc0760fd25b1cb1b57ba2.png",
				"我家大师兄脑子有坑-吃瓜": "https://i0.hdslb.com/bfs/emote/816198d849984d510a1713c3d6426754475f8ddd.png",
				"我家大师兄脑子有坑-大笑": "https://i0.hdslb.com/bfs/emote/1af457c164e174376c558e62f26b86ca18d67844.png",
				"我家大师兄脑子有坑-汗": "https://i0.hdslb.com/bfs/emote/834905aff2a69e52eed7d8f48cb0344b600829b0.png",
				"我家大师兄脑子有坑-机智": "https://i0.hdslb.com/bfs/emote/a56e6a8d21498abac50f886559767172934262da.png",
				"我家大师兄脑子有坑-哭": "https://i0.hdslb.com/bfs/emote/d7d9809e3118b2a57bcf28a4605abfef12359a73.png",
				"我家大师兄脑子有坑-期待": "https://i0.hdslb.com/bfs/emote/ef74493b15b9029ac73dddcb6fe1fcc265058fb5.png",
				"我家大师兄脑子有坑-撒花": "https://i0.hdslb.com/bfs/emote/e0755e2432241f9ea5e9b5594a0a59f0ba68455d.png",
				"我家大师兄脑子有坑-吐魂": "https://i0.hdslb.com/bfs/emote/5e6482f392ee60e1b0bfbf3bb0abf8afe32fb7f6.png",
				"我家大师兄脑子有坑-晕": "https://i0.hdslb.com/bfs/emote/2f10c278536711e836ec9a3ba77c19c6433b3608.png",
				"喂，看见耳朵啦！-懵": "https://i0.hdslb.com/bfs/emote/51725a9abd80ce5dca5a31b7d752c61bdc063a44.png",
				"喂，看见耳朵啦！-嗷": "https://i0.hdslb.com/bfs/emote/203d29bcc8e2ab7ce4a12bc07140403390f4b2e6.png",
				"喂，看见耳朵啦！-抱大腿": "https://i0.hdslb.com/bfs/emote/d5eebcecad919c86d68ae495f39743fc80b20ad9.png",
				"喂，看见耳朵啦！-抱走": "https://i0.hdslb.com/bfs/emote/0576f4f1463f6757101a236c10049ed40ba748cb.png",
				"喂，看见耳朵啦！-壁咚": "https://i0.hdslb.com/bfs/emote/759a8a54f10767bdc40fd014b70a783ae0e568ef.png",
				"喂，看见耳朵啦！-冷漠": "https://i0.hdslb.com/bfs/emote/edb3d7e86fd768b55c50588110a765e3d9cafd4b.png",
				"喂，看见耳朵啦！-嘤嘤嘤": "https://i0.hdslb.com/bfs/emote/d061ef8b91ca866fc6ce3ac0eaaf831457e08c52.png",
				"喂，看见耳朵啦！-吓": "https://i0.hdslb.com/bfs/emote/9ed824796f9494f8ef4adadb68f271cbf1790dcf.png",
				"喂，看见耳朵啦！-chu": "https://i0.hdslb.com/bfs/emote/912c436fee4d16f94cc5f794abc6a6edf3beda4d.png",
				"喂，看见耳朵啦！-爱你": "https://i0.hdslb.com/bfs/emote/68fb8141a242cdcde94ba12e91dee1ad6b37978e.png",
				"喂，看见耳朵啦！-舔": "https://i0.hdslb.com/bfs/emote/c57b984be871913cd502e9bb6b971ce311229d99.png",
				"喂，看见耳朵啦！-睡觉觉": "https://i0.hdslb.com/bfs/emote/9adec4fb28034e50dde7a2ca5de234c80f95dc04.png",
				"喂，看见耳朵啦！-举高高": "https://i0.hdslb.com/bfs/emote/a413e5eeeec632074b6c01274bf8fcb510991e0e.png",
				"喂，看见耳朵啦！-不可描述": "https://i0.hdslb.com/bfs/emote/fda54b79413faa735b1c96eb9acd497e3207ba4d.png",
				"喂，看见耳朵啦！-摔倒啦": "https://i0.hdslb.com/bfs/emote/cb626004cd67af4a48fd48f15a9f36f564052082.png",
				"喂，看见耳朵啦！-说什么都对": "https://i0.hdslb.com/bfs/emote/4bddfe880ce46bd46b39b3f7a3f45300cbd330f9.png",
				"小绿和小蓝-不想说话": "https://i0.hdslb.com/bfs/emote/eb0e4730ecb42c342e1507330ce495deef0128bd.png",
				"小绿和小蓝-吵架": "https://i0.hdslb.com/bfs/emote/420d20935484170ac24c67872f29458bc0c79f5a.png",
				"小绿和小蓝-得意脸": "https://i0.hdslb.com/bfs/emote/ef7c7605c4975f89896f3ed37c4e097c4e1713d7.png",
				"小绿和小蓝-高兴": "https://i0.hdslb.com/bfs/emote/614798a8c875540d417b7200b9ea1ac3e1a934a3.png",
				"小绿和小蓝-哦": "https://i0.hdslb.com/bfs/emote/dab5061b6f299a5f38b85a115da8eab8024426e8.png",
				"小绿和小蓝-捂脸": "https://i0.hdslb.com/bfs/emote/7108030a92e01945817e2e73cc9206cfed4069a3.png",
				"小绿和小蓝-邪恶脸": "https://i0.hdslb.com/bfs/emote/da35ac592ab48d23d299034315eb3b4efe15015b.png",
				"小绿和小蓝-要哭了": "https://i0.hdslb.com/bfs/emote/f1c4d2b6cfcf43b985af38da8dc5a4fcdfbcc600.png",
				"小绿和小蓝-疑问": "https://i0.hdslb.com/bfs/emote/80d7b4f10cd51dee05c0e307169aab9e9c2ea37e.png",
				"小绿和小蓝-打滚": "https://i0.hdslb.com/bfs/emote/a0523e55635cf3e09dc286e2042fbbac6b50409c.png",
				"小绿和小蓝-诶": "https://i0.hdslb.com/bfs/emote/302e36652f710d0e7a8260090eaf63eac3bd28bf.png",
				"小绿和小蓝-机智一比": "https://i0.hdslb.com/bfs/emote/54816a3dd363e620e5d999f1bdf75290645bd35e.png",
				"小绿和小蓝-喵喵喵": "https://i0.hdslb.com/bfs/emote/a2019a775d69b7888d663e82b3c29bd0c2281188.png",
				"小绿和小蓝-跑": "https://i0.hdslb.com/bfs/emote/a73a2d7b884e735ab26ee1f871dd38c499f7b84a.png",
				"小绿和小蓝-喂": "https://i0.hdslb.com/bfs/emote/707e9e784b745fad291ab15d9a31a24c7efa6c1f.png",
				"小绿和小蓝-已关机": "https://i0.hdslb.com/bfs/emote/ea0769dadca17598873306ab8500aab1dd8994bd.png",
				"小绿和小蓝-直接躺平": "https://i0.hdslb.com/bfs/emote/92a77c53d7a66763d2bd9dab80ddd2afa6cf6387.png",
				"小绿和小蓝-呆住": "https://i0.hdslb.com/bfs/emote/978ab4d7ea39f7428fc945ba68c96b2291d26751.png",
				"小绿和小蓝-哈哈": "https://i0.hdslb.com/bfs/emote/22144e5e3ea83b587483ea473c2e191284d64b44.png",
				"小绿和小蓝-喝水": "https://i0.hdslb.com/bfs/emote/1e5592c8200419164f5730a0de6c30281a5c5a57.png",
				"小绿和小蓝-生气": "https://i0.hdslb.com/bfs/emote/a9cc35254663a736cbd0e020634765b5f147fcdd.png",
				"小绿和小蓝-哇啊啊啊": "https://i0.hdslb.com/bfs/emote/d67db235a945fdbd0b537aebddb4abc5ffc01184.png",
				"小绿和小蓝-一本正经": "https://i0.hdslb.com/bfs/emote/822a803bf5b340090c9c7053a74aa43c1b527c27.png",
				"小绿和小蓝-惊呆": "https://i0.hdslb.com/bfs/emote/15091032588cf3ccf2a7969460fe7705ec00e9c7.png",
				"小绿和小蓝-开心": "https://i0.hdslb.com/bfs/emote/08dab1d9250043f97273b211253d0341f92fb0f8.png",
				"小绿和小蓝-苦恼": "https://i0.hdslb.com/bfs/emote/14a0716224369f5211d5c69c249354f11f5026cb.png",
				"小绿和小蓝-灵光乍现": "https://i0.hdslb.com/bfs/emote/dc3fae4b42056970f5aa407e8297e96cd2ede2b2.png",
				"小绿和小蓝-思考": "https://i0.hdslb.com/bfs/emote/aecd0b1b0a5848765f002c857b73092677dec31f.png",
				"一人之下-机智": "https://i0.hdslb.com/bfs/emote/afdcd367d011fbe5b78032daf519689c0bbcdc5e.png",
				"一人之下-刀": "https://i0.hdslb.com/bfs/emote/68036be8868b42a6cbdb61327cfdb50bedde1a38.png",
				"一人之下-埋了": "https://i0.hdslb.com/bfs/emote/2784a335e41ac4cdf2ec94bf430a906f933f11f4.png",
				"一人之下-蟑螂": "https://i0.hdslb.com/bfs/emote/a95014fff53b7921b5f1850781ccf5af5ef73234.png",
				"一人之下-抽打": "https://i0.hdslb.com/bfs/emote/a6a0a0a20019de939232bdaf3f1882e6d8ffd75e.png",
				"一人之下-燃": "https://i0.hdslb.com/bfs/emote/f2a78e0e05bb90b38b550f57355173f8e9e32a7f.png",
				"一人之下-超凶": "https://i0.hdslb.com/bfs/emote/aea3aa73a14350613628a0dac83e77c6c8fa9d68.png",
				"一人之下-干翻苍穹": "https://i0.hdslb.com/bfs/emote/e5de003a4eb9fef32fe722cd06ad2abc9a3d4ec3.png",
				"一人之下-糟了": "https://i0.hdslb.com/bfs/emote/45ad7c1b87cf95743a2ad000b8dd2eedfcf73107.png",
				"一人之下-孙贼": "https://i0.hdslb.com/bfs/emote/a689c37d5779cda0774d6f4be65cd587c4d0e27f.png",
				"一人之下-养生": "https://i0.hdslb.com/bfs/emote/32adfeb34ecc2e4ab9702813ab547fc0bb09aac7.png",
				"一人之下-瘫": "https://i0.hdslb.com/bfs/emote/721c2b271d9edbb937c6dec61ba25568797b27aa.png",
				"一人之下-打call": "https://i0.hdslb.com/bfs/emote/7f979ab31d61e09acb3da46b52c52376e1131abe.png",
				"一人之下-比心": "https://i0.hdslb.com/bfs/emote/fafec3459f631f0ba76adde9faf8aa112469e9c4.png",
				"一人之下-摸头": "https://i0.hdslb.com/bfs/emote/500171557765a27c500a7024888c698680c73653.png",
				"一人之下-八卦": "https://i0.hdslb.com/bfs/emote/5be05cddd588d7b635cd55501b9b7a47af5dc5bc.png",
				"一人之下-狐狸": "https://i0.hdslb.com/bfs/emote/022b95f086cd4469aec2a44045729bfda6fd8c95.png",
				"一人之下-承让": "https://i0.hdslb.com/bfs/emote/6a21366ea70b7369b1d3c867f04bf8932e7c9be4.png",
				"一人之下-哎？": "https://i0.hdslb.com/bfs/emote/ece804d0f852c6c6c9ae280dca523de672d5631d.png",
				"一人之下-叹气": "https://i0.hdslb.com/bfs/emote/f5c79a00613d3e1f71d18332d474c7c0af31e4b2.png",
				"一人之下-雷": "https://i0.hdslb.com/bfs/emote/75bbf0f391e8136d79109ff1d6904b688555b49b.png",
				"狐妖-不服憋着": "https://i0.hdslb.com/bfs/emote/d3633ea35afac42d46679a3d31775a9860e63c2d.png",
				"狐妖-吃瓜": "https://i0.hdslb.com/bfs/emote/8c5ad49f83b29262e2e785124bec6651670ae36b.png",
				"狐妖-不明嚼栗": "https://i0.hdslb.com/bfs/emote/71601899fe445454c3593e7d82e4ea01f980b230.png",
				"狐妖-抽打": "https://i0.hdslb.com/bfs/emote/43bb8e363f6c94c97a396a68852c8f2182651fc0.png",
				"狐妖-吃我安利": "https://i0.hdslb.com/bfs/emote/3a0bf7d0320a84002ea8b4907e6c3baa97ec0dd0.png",
				"狐妖-伐开心": "https://i0.hdslb.com/bfs/emote/01f6b69d1f69e8ea879569827e7363f4da630cba.png",
				"狐妖-惊": "https://i0.hdslb.com/bfs/emote/e1c6e6aca03b634f32bc71762015c44431dafd74.png",
				"狐妖-大笑": "https://i0.hdslb.com/bfs/emote/38bc9f4e39c2ec9d7442f2d67e13092fd535846b.png",
				"狐妖-震惊": "https://i0.hdslb.com/bfs/emote/83361a40f6fd010e6da88825aa27320189ad2df5.png",
				"狐妖-脸红": "https://i0.hdslb.com/bfs/emote/79175b3bc469061020d15114e22ac261b0668819.png",
				"狐妖-冷漠": "https://i0.hdslb.com/bfs/emote/842b69b5c3e98d11292edd4f4cf6abb8504c18bc.png",
				"狐妖-哭": "https://i0.hdslb.com/bfs/emote/29de352176c8ead5b301212aa61facb5e3abcd55.png",
				"狐妖-目瞪口呆": "https://i0.hdslb.com/bfs/emote/c75e6841c81a5c020971debe394334d8b2700151.png",
				"狐妖-前排": "https://i0.hdslb.com/bfs/emote/4d2702f9383dec00c7c77ff026768c3ddaaf6d60.png",
				"狐妖-沙发": "https://i0.hdslb.com/bfs/emote/5ff883da9618dfd9740256e569279244bbff03b1.png",
				"狐妖-掀桌": "https://i0.hdslb.com/bfs/emote/f0917c6d982a86c2ab02c979359226f761581c37.png",
				"狐妖-心": "https://i0.hdslb.com/bfs/emote/77123fd85c11478b46d762a1c8553328013637ef.png",
				"狐妖-晕": "https://i0.hdslb.com/bfs/emote/64702d1fc92c44e8aaa39ffdacdc87aaa6d38d3d.png",
				"狐妖-吃药": "https://i0.hdslb.com/bfs/emote/059d810cbc5ad4df4f9bbf08e44643b022a2354f.png",
				"狐妖-mdzz": "https://i0.hdslb.com/bfs/emote/e68fd21a5bcfa50b6d45f2a8f5926f992f484ae3.png",
				"战双帕弥什-吃瓜": "https://i0.hdslb.com/bfs/emote/8541c44effd3f69a71b1e96a586ac0fe5b765c45.png",
				"战双帕弥什-哼": "https://i0.hdslb.com/bfs/emote/59748ef499690a7931c198cd4e0343d5a05d63da.png",
				"战双帕弥什-抱抱": "https://i0.hdslb.com/bfs/emote/83a6ae3a34c54e6ebef7d0ca5ad540f61c1df678.png",
				"战双帕弥什-画圈圈": "https://i0.hdslb.com/bfs/emote/167a9b59900ef721dd3fd19e6216a71d4eb85dfb.png",
				"战双帕弥什-痴汉": "https://i0.hdslb.com/bfs/emote/9987980413cc6f550ea7e5f071fe1166cef729b7.png",
				"战双帕弥什-挠头": "https://i0.hdslb.com/bfs/emote/b1930eefe111a6e140f17669368aed831aeab5f4.png",
				"战双帕弥什-肥宅": "https://i0.hdslb.com/bfs/emote/3ac9e30424ff0122d4ca274cac3ed236d2853e46.png",
				"战双帕弥什-柠檬茶": "https://i0.hdslb.com/bfs/emote/02180f96d9b38797873286035dcfe738ad382cbb.png",
				"战双帕弥什-诶嘿": "https://i0.hdslb.com/bfs/emote/98c27f2281019fa5ef0872da88401d03313463b2.png",
				"战双帕弥什-拍桌": "https://i0.hdslb.com/bfs/emote/2bd9551d81a1edf8013dc75ca18b875050db9dd3.png",
				"战双帕弥什-哭哭": "https://i0.hdslb.com/bfs/emote/71e7feb027f42ec299a440c3031534d6bdc4e604.png",
				"战双帕弥什-吐血": "https://i0.hdslb.com/bfs/emote/3b53c31e32cf8806770f760a74b167b14610df8c.png",
				"战双帕弥什-凉了": "https://i0.hdslb.com/bfs/emote/142bcb77a9564db8ab5f429ad1e623c9fa446abd.png",
				"战双帕弥什-托腮": "https://i0.hdslb.com/bfs/emote/e196eeadb34eb7238206d606b801ef8e0516d00a.png",
				"战双帕弥什-喷了": "https://i0.hdslb.com/bfs/emote/5424a9d241653492c296d8c8b4c889f2202fac8a.png",
				"战双帕弥什-星星眼": "https://i0.hdslb.com/bfs/emote/1595f4072f90b756f15834f70bb188872c107a37.png",
				"战双帕弥什-我即天命": "https://i0.hdslb.com/bfs/emote/2dd6a60bcdce44e54f07c090b1b8849ee76ae4a0.png",
				"战双帕弥什-作战预备": "https://i0.hdslb.com/bfs/emote/82d3b0c747cff3e8523cfd10e0e58c03dac885a3.png",
				"大王不高兴-开心": "https://i0.hdslb.com/bfs/emote/cb17a1a0b113c1b2c4a42c273d0e9a434289a95c.png",
				"大王不高兴-生气": "https://i0.hdslb.com/bfs/emote/5c3aa8d501c1a1a3c3e627edfc98703c1066e91b.png",
				"大王不高兴-哭": "https://i0.hdslb.com/bfs/emote/f0677bb46861c5b03137e356d06a51a562fd0a59.png",
				"大王不高兴-比心": "https://i0.hdslb.com/bfs/emote/0ce7501326cdf4be8c81a106054680458d4fa247.png",
				"大王不高兴-疑问": "https://i0.hdslb.com/bfs/emote/3e0ebc9bd1cb54a2ceed82a90a3fdd2586a517ae.png",
				"大王不高兴-我好了": "https://i0.hdslb.com/bfs/emote/997095a106b2fb7319f07c6f9260468410734a56.png",
				"大王不高兴-汗": "https://i0.hdslb.com/bfs/emote/7b02c3d608f3ca9cdc6b46d64f06f8909017f164.png",
				"大王不高兴-点赞": "https://i0.hdslb.com/bfs/emote/f85e02492f0f87ee94f274f1684787170ceefcdb.png",
				"大王不高兴-害怕": "https://i0.hdslb.com/bfs/emote/461eff396cde49246614731caacef13200730709.png",
				"大王不高兴-滑稽": "https://i0.hdslb.com/bfs/emote/0004ca2d9be95b769d8a9778aaee3a07482550ba.png",
				"大王不高兴-目瞪口呆": "https://i0.hdslb.com/bfs/emote/83d687d404ce04c68cf5f968a74a2d936097486e.png",
				"大王不高兴-前排": "https://i0.hdslb.com/bfs/emote/8b02d412a194f8c424c12c0c9f22159f3a1895f8.png",
				"崩坏3-点赞": "https://i0.hdslb.com/bfs/emote/055a130541fe95e20aa541db5a5a48d0cbc728b6.png",
				"崩坏3-入欧": "https://i0.hdslb.com/bfs/emote/5d532eab104881e7dd63be1083a78ab36878c3b4.png",
				"崩坏3-脱非": "https://i0.hdslb.com/bfs/emote/ac31b7219032b6e714c189d65a669ca3ca2d3e77.png",
				"崩坏3-快乐": "https://i0.hdslb.com/bfs/emote/a3ec46f1255dbf96d413231862399b939dc2110e.png",
				"崩坏3-注入灵魂": "https://i0.hdslb.com/bfs/emote/5bf261f6fb91463e1ff1c80dd0fefd6bcd31aedf.png",
				"崩坏3-危险": "https://i0.hdslb.com/bfs/emote/3a6af29282b6e09ce7881c9aebc187d03268b25f.png",
				"崩坏3-吃瓜": "https://i0.hdslb.com/bfs/emote/9ecead2805adf05a308e1093fb8d4941d0366189.png",
				"崩坏3-糖葫芦": "https://i0.hdslb.com/bfs/emote/f54e160beaf3f7b55a87d0da9a6eccefc7bd70d6.png",
				"崩坏3-路过": "https://i0.hdslb.com/bfs/emote/13a7f9e81f4005c29466e8d65eabbf3167902f9d.png",
				"崩坏3-魔法少女": "https://i0.hdslb.com/bfs/emote/da063804b5b8d44c288dd2c45f472741c00c8625.png",
				"崩坏3-特效": "https://i0.hdslb.com/bfs/emote/a1bb1caf129b5e28f2c331667f9e38808050e8a8.png",
				"崩坏3-唢呐": "https://i0.hdslb.com/bfs/emote/032301ad0e61395a266e7f9b4ebcf83bd2acca03.png",
				"崩坏3-琵琶": "https://i0.hdslb.com/bfs/emote/13c3e61eec3a61a3e0ae2883a488ce9b45cddecc.png",
				"崩坏3-二胡": "https://i0.hdslb.com/bfs/emote/b2e3acfba545c61c334eacf5a5b7694e071d834f.png",
				"崩坏3-笛子": "https://i0.hdslb.com/bfs/emote/3dae79d5ce1d826d6d16404dff7bf22474c7015b.png",
				"崩坏3-镲": "https://i0.hdslb.com/bfs/emote/dcce1ad4d53a25c52946821c0d3a4b7dd80e5a42.png",
				"崩坏3-红包": "https://i0.hdslb.com/bfs/emote/4bd80539d828ad6894ccb099b5b04769820d49d6.png",
				"崩坏3-谈话": "https://i0.hdslb.com/bfs/emote/4794f82d166b1f8bfae7783859913e03fe42ae81.png",
				"崩坏3-无辜": "https://i0.hdslb.com/bfs/emote/4e1f4e9a375beaa4e93d057a4e285c924635235f.png",
				"崩坏3-星星眼": "https://i0.hdslb.com/bfs/emote/b5fffeead2dc05c7f902f1c7136178c6a63e508a.png",
				"崩坏3-微笑": "https://i0.hdslb.com/bfs/emote/c2c6c0604af985b745322954814863e47f6fb6d5.png",
				"崩坏3-开心": "https://i0.hdslb.com/bfs/emote/3657a825b87ec063d6e2a3c201da2056e45db938.png",
				"崩坏3-幸福": "https://i0.hdslb.com/bfs/emote/714cc90d3485a003f53eecec336bea8a0b2dc12d.png",
				"崩坏3-吃": "https://i0.hdslb.com/bfs/emote/c26ae762270b756b68a7f5c63d43078e874fbead.png",
				"崩坏3-口水": "https://i0.hdslb.com/bfs/emote/7a66d7e1902b766a2b930009687be5171018f1ff.png",
				"崩坏3-惊": "https://i0.hdslb.com/bfs/emote/672ab0cac8e29270a0ea1788df5711ce716b6942.png",
				"崩坏3-哭哭": "https://i0.hdslb.com/bfs/emote/f432d349d44aad9873da18b27a6367c3ea7cfebc.png",
				"崩坏3-纠结": "https://i0.hdslb.com/bfs/emote/864ff2ef1546534f5b53b279332e3950a86cf008.png",
				"崩坏3-疑问": "https://i0.hdslb.com/bfs/emote/bdda506f56f5a42e365b6f2f8d2128f799f8310e.png",
				"崩坏3-有主意了": "https://i0.hdslb.com/bfs/emote/38676ebb4c51fdda6302a5cb131ae94d35be4f8b.png",
				"阴阳师缘结神-你高尚": "https://i0.hdslb.com/bfs/emote/f88abffb5a8d570b1efc68cd5440d9515b8a45e6.png",
				"阴阳师缘结神-菜哭": "https://i0.hdslb.com/bfs/emote/5c9907d23378704942227aa5a2834ff35f2e425d.png",
				"阴阳师缘结神-姐妹！": "https://i0.hdslb.com/bfs/emote/972913308e0633454e382e6e1c01b810c24cd574.png",
				"阴阳师缘结神-我身体好": "https://i0.hdslb.com/bfs/emote/1852865c39b446a63ecb07da68a196dc4dd2c96e.png",
				"阴阳师缘结神-我磕到了": "https://i0.hdslb.com/bfs/emote/5f59b958267f9441d82956071586fa25c9ee5e7c.png",
				"阴阳师缘结神-爱心发射": "https://i0.hdslb.com/bfs/emote/25cdfac5b23e5cb007d1fa643b82751c9b07d31a.png",
				"阴阳师缘结神-快去结婚": "https://i0.hdslb.com/bfs/emote/90402b80a3fd1ab81c9d78a31354f00f0a0cb1ba.png",
				"阴阳师缘结神-亲一个": "https://i0.hdslb.com/bfs/emote/611591c16d0e621b21e035045c026e2039e52c29.png",
				"阴阳师缘结神-KWSL": "https://i0.hdslb.com/bfs/emote/8bddeede5426262701d09a9bdffd3cc7a89bee69.png",
				"阴阳师缘结神-缘结神哒": "https://i0.hdslb.com/bfs/emote/f7a03dfd13018213d210d4de8467e51f8b9d91e3.png",
				"阴阳师缘结神-该结婚了": "https://i0.hdslb.com/bfs/emote/c7b591beb0e613e0a9f95fc5becf42d7896a5869.png",
				"阴阳师缘结神-兄弟情？": "https://i0.hdslb.com/bfs/emote/2606e0614cd56d7d9c3a5c8e4ed6d96ef9eea888.png",
				"阴阳师缘结神-别骚了": "https://i0.hdslb.com/bfs/emote/fb58e9683265087ad8bdbe3e834f7813cf72f990.png",
				"阴阳师缘结神-开心": "https://i0.hdslb.com/bfs/emote/f1a2a63ef7a89eae87da511f5de5b04d0e9ae06c.png",
				"阴阳师缘结神-在一起": "https://i0.hdslb.com/bfs/emote/4ccc36204a64787b0fb67d47edcffaf3c45acc42.png",
				"阴阳师缘结神-期待": "https://i0.hdslb.com/bfs/emote/b80475b53b481f3d11ec05b07c55ad390f091b35.png",
				"阴阳师缘结神-多喝热水": "https://i0.hdslb.com/bfs/emote/b6f923ac40cf7faf24d3bc8ca6ebcdf6425a876f.png",
				"阴阳师缘结神-有粮不": "https://i0.hdslb.com/bfs/emote/6fdd3e5e15dc307c3c6990a621df860634527f47.png",
				"阴阳师缘结神-等粮中": "https://i0.hdslb.com/bfs/emote/0126cb6e58fa39fbd0f2e5242461ae0e101ea904.png",
				"阴阳师缘结神-求你产粮": "https://i0.hdslb.com/bfs/emote/95011ad80649de14a966c827db305579a8311b63.png",
				"阴阳师缘结神-我不活啦": "https://i0.hdslb.com/bfs/emote/48de67de9c96dc5340af62ccc76200e07ceaffda.png",
				"公主连结-不错": "https://i0.hdslb.com/bfs/emote/e0ac5fff71fd2aabd8c20505a548f5bca36bc7a5.png",
				"公主连结-鼓气": "https://i0.hdslb.com/bfs/emote/a3fb7d3a867ba3523e6a0faa2ca42af797328d6d.png",
				"公主连结-害怕": "https://i0.hdslb.com/bfs/emote/c305b2bd36063b700fd9fac093c21639c0806138.png",
				"公主连结-惊吓": "https://i0.hdslb.com/bfs/emote/57ad87c4e597a366dac713ad4800cecbd520175e.png",
				"公主连结-来啊": "https://i0.hdslb.com/bfs/emote/a82ab04d1a10c742b5eadafb2a0e04d77daa84d4.png",
				"公主连结-累死了": "https://i0.hdslb.com/bfs/emote/8c68c16f8f4c79f14bb16c6ea64378d77abdf0d0.png",
				"公主连结-冷漠": "https://i0.hdslb.com/bfs/emote/04a257a00ae097d61498db6118f6da393d4c85b7.png",
				"公主连结-厉害了": "https://i0.hdslb.com/bfs/emote/066c5c59e39f163345d2a41123d53596b39a2ce3.png",
				"公主连结-你干嘛": "https://i0.hdslb.com/bfs/emote/422897481963e6efdd93dce8581c112e7af80a1e.png",
				"公主连结-扭扭捏捏": "https://i0.hdslb.com/bfs/emote/4c20cd2aed2598dd18507fdd03c7d39b6eb7842c.png",
				"公主连结-祈祷": "https://i0.hdslb.com/bfs/emote/a63b3da12e46314470413fea6975579b0871d1f8.png",
				"公主连结-思索": "https://i0.hdslb.com/bfs/emote/3c6741be302ec54f152093ab00f950b00a083d6d.png",
				"公主连结-投币": "https://i0.hdslb.com/bfs/emote/6bd0c47917f94d510990db020ce3a7c07ed698e9.png",
				"公主连结-无奈": "https://i0.hdslb.com/bfs/emote/7f78404ee98cc8738b9b738f7e4446a6fdbaff00.png",
				"公主连结-邪恶": "https://i0.hdslb.com/bfs/emote/97d25106924c7f3db1fe26ed7d67db943ffcc92e.png",
				"公主连结-阴谋": "https://i0.hdslb.com/bfs/emote/705f87da382b4c46d6bf19579b62c88bf4aa702c.png",
				"公主连结-怎么这样": "https://i0.hdslb.com/bfs/emote/7461756bf9c49c4b48d1c26083695044b468ad7c.png",
				"公主连结-emmm": "https://i0.hdslb.com/bfs/emote/99ca73b1f486042cd8ab6b17fd5ad638ed777899.png",
				"2020拜年祭-哈气": "https://i0.hdslb.com/bfs/emote/464fb79ad8dc0b8ba192bef47e03c044fc8ec8ac.png",
				"2020拜年祭-期待": "https://i0.hdslb.com/bfs/emote/34d9883978304d61b0a6bfe4dc5ed3cce849a954.png",
				"2020拜年祭-吸欧气": "https://i0.hdslb.com/bfs/emote/d7d2033c871fbe06747c6ca93a7856f27765d9e7.png",
				"2020拜年祭-领红包": "https://i0.hdslb.com/bfs/emote/d8425bcf66fe383d0c693c41678202bb2167f476.png",
				"2020拜年祭-谢谢老板": "https://i0.hdslb.com/bfs/emote/2aa0fef536c594d29b8936c2e7be0e68decd44a8.png",
				"2020拜年祭-灯笼": "https://i0.hdslb.com/bfs/emote/814b999e584f93769a5c6a0285c91ab3c2f57002.png",
				"2020拜年祭-火锅": "https://i0.hdslb.com/bfs/emote/2bfbeb3a1502187b0c505e49a460be1dbffd3df0.png",
				"2020拜年祭-2020": "https://i0.hdslb.com/bfs/emote/5f28eb21ed39a86e369d5316579573b285ccf34f.png",
				"2020拜年祭-红包": "https://i0.hdslb.com/bfs/emote/cebc5603f3ff1df7f9f2e67c8c7e6309da0b506c.png",
				"2020拜年祭-新年好": "https://i0.hdslb.com/bfs/emote/9da7e2f2fd6187c506423398dc22f7bf5ba814f4.png",
				"Cat-escort": "https://i0.hdslb.com/bfs/emote/81784f53f5ca7004a90d316c81889d8161dc05a6.png",
				"Cat-coffeebath": "https://i0.hdslb.com/bfs/emote/f80cfd44e0f216f4171a549e869aab32d80d4c39.png",
				"Cat-stealth": "https://i0.hdslb.com/bfs/emote/21f7d24b1e8de29f2c61f64e70af9f6aec14e394.png",
				"Cat-hightouch": "https://i0.hdslb.com/bfs/emote/3d7264b8349bc1be6d45beebbcfab69e7b9895fc.png",
				"Cat-lonely": "https://i0.hdslb.com/bfs/emote/72a9d2f20fb79883bbed3cac914187545ac3a0cc.png",
				"Cat-heart": "https://i0.hdslb.com/bfs/emote/3f98c4debfe792a1969b99ae71f7f5d4bf00c3d5.png",
				"Cat-slip": "https://i0.hdslb.com/bfs/emote/a6e45e065ed17e2af03f7263784bc36d94b25e74.png",
				"Cat-chips": "https://i0.hdslb.com/bfs/emote/12d2d3ce0e72749c45706444cca580dc22148876.png",
				"Cat-study": "https://i0.hdslb.com/bfs/emote/9f6d28ecd7e33c3f5e7cd74cc36f4feedb42e995.png",
				"Cat-dash": "https://i0.hdslb.com/bfs/emote/0f2d1f99efd5df816c694da76e91a173fa643589.png",
				"Cat-pressure": "https://i0.hdslb.com/bfs/emote/c6c270e9989e7152457b907595a6e34064d0c1b2.png",
				"Cat-hibye": "https://i0.hdslb.com/bfs/emote/9e4955f479a1211d401fbaa71ceaf5186b9e57bd.png",
				"Cat-confuse": "https://i0.hdslb.com/bfs/emote/107ebcbd4dd5895f4595ea6db963dc4566809c6e.png",
				"Cat-ignore": "https://i0.hdslb.com/bfs/emote/94de4f63a5f965ee8312a88e4c57c07c0174acce.png",
				"Cat-agree": "https://i0.hdslb.com/bfs/emote/48b00f75518a727d64c385fe8ca2fa49aeb08c77.png",
				"Cat-fight": "https://i0.hdslb.com/bfs/emote/e39c491906d0fcd0176eede702305655d44044c5.png",
				"Cat-splash": "https://i0.hdslb.com/bfs/emote/9513157fed2425ed2caa4eb9bc84a0bca80df9bc.png",
				"Cat-calledme": "https://i0.hdslb.com/bfs/emote/aacb6fb852f6acbbc8386ecef76c98b77178e23e.png",
				"Cat-sleep": "https://i0.hdslb.com/bfs/emote/39b964d10bde1634f136b662f5b624fcb3bcedb8.png",
				"Cat-congrats": "https://i0.hdslb.com/bfs/emote/98f6e73340d9ed43403242fc842e42508d38bba6.png",
				"最强蜗牛西能-Hi": "https://i0.hdslb.com/bfs/emote/cacd7cd54a1d210cfacd79f5b1f061708c3dba4e.png",
			}
		});
		
		function debounce(fn) {
			var timerID = null
			return function(){
				var arg = arguments[0]   //获取事件
				if(timerID) {
					clearTimeout (timerID)
				}
				timerID = setTimeout( function(){
					fn(arg)              //事件传入函数
				},200)
			}
		}
		//查询评论 valine.Q('*').limit(7) -- 查询所有，限制7条, 下面的的代码是查询当前页面
		let themeDanmu = eval('true');
		let themeLoop = eval('false');
		let themeLooperTime = '5000' || 5000;
		let speed = '20' || 20;
		let isBarrager = true;
		if (themeDanmu == true) {
			do_barrager();
			$('.navbar').append('<div class="danmuBox"><div class="danmuBtn open"><span class="danmuCircle"></span><span class="danmuText">弹幕</span></div></div>');
			$('.danmuBtn').on('click', debounce(
				function () {
					if ($('.danmuBtn').hasClass('open')) {
						$('.danmuBtn').removeClass('open')
						clearInterval(looper);
						$.fn.barrager.removeAll();
					} else {
						$('.danmuBtn').addClass("open");
						do_barrager();
					}
				}
			))
		}
		function do_barrager() {
			isBarrager && valine.Q(window.location.pathname).find().then(function (comments) {
				// let num = 0; // 可以记录条数，循环调用的时候只取最新的评论放入弹幕中
				let run_once = true;
				let looper_time = themeLooperTime;
				let total = comments.length;
				let index = 0;
				if (total > 0) {
					barrager();
				} else {
					// 当评论数为0的时候，自动关闭弹幕
					// $('.danmuBtn').removeClass('open');
				}
				function barrager() {
					if(run_once) {
						//如果是首次执行,则设置一个定时器,并且把首次执行置为false
						looper = setInterval(barrager,looper_time);                
						run_once = false;
					}
					let content = comments[index]._serverData.comment;
					let email = comments[index]._serverData.mail;
					let link = comments[index]._serverData.link;
					let newcontent = content.substring(0, 50).replace(/<[^>]+>/g,"");
					//发布一个弹幕
					const item = {
						img: `https://q1.qlogo.cn/g?b=qq&nk=${email}&s=640`, //图片 
						info: newcontent, //文字 
						href: link, //链接 
						close:true, //显示关闭按钮 
						speed: speed, //延迟,单位秒,默认6 
						color:'#fff', //颜色,默认白色 
						old_ie_color:'#000000', //ie低版兼容色,不能与网页背景相同,默认黑色
					}
					$('body').barrager(item);
					//索引自增
					index++;
					//所有弹幕发布完毕，清除计时器。
					if(index == total) {
						clearInterval(looper);
						if (themeLoop === true) {
							setTimeout(function(){ 
								do_barrager();
							}, 5000);
						} else {
							$('.danmuBtn').removeClass('open');
						}
						return false;
					}

				}
			})
		}
	</script>
</section>
<style>
	#comments {
		background: rgba(255,255,255,0.9);
	}
	#veditor {
		background-image: url('/medias/comment-bg.gif');
		background-size: contain;
		background-repeat: no-repeat;
		background-position: right;
		background-color: rgba(255, 255, 255, 0);
		resize: vertical;
	}
	#veditor:focus{
		background-position-y: 200px;
		transition: all 0.2s ease-in-out 0s;
	}
	#vcomment .vcards .vcard .vh .vhead .vtag.vvisitor {
		background-color: #42b983;
	}
	.v[data-class=v] .vbtn:active, .v[data-class=v] .vbtn:hover {
		color: #42b983;
		border-color: #42b983;
	}
	#vcomment .vcards .vcard .vhead .vsys i {
		display: none;
	}
	/* 底部valine链接 */
	#vcomment .vpower {
		display: none;
	}
	
	/* 底下注释是修改 名称和邮箱和网址输入框的样式 */
	/* #vcomment .vheader {
		display: flex;
		justify-content: space-around;
	}
	
	#vcomment .vheader .vnick {
		width: 31%;
		border: 2px solid #dedede;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 5px
	}

	#vcomment .vheader .vmail {
		width: 31%;
		border: 2px solid #dedede;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 5px
	}

	#vcomment .vheader .vlink {
		width: 31%;
		border: 2px solid #dedede;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 5px
	} */

	img.vimg {
		transition: all 1s;
		/* 头像旋转时间为 1s */
	}

	img.vimg:hover {
		transform: rotate(360deg);
		-webkit-transform: rotate(360deg);
		-moz-transform: rotate(360deg);
		-o-transform: rotate(360deg);
		-ms-transform: rotate(360deg);
	}

	#vcomment .vcards .vcard {
		padding: 15px 20px 0 20px;
		border-radius: 10px;
		margin-bottom: 15px;
		box-shadow: 0 0 4px 1px rgba(0, 0, 0, .12);
		transition: all .3s
	}

	#vcomment .vcards .vcard:hover {
		box-shadow: 0 0 8px 3px rgba(0, 0, 0, .12)
	}

	#vcomment .vcards .vcard .vh .vcard {
		border: none;
		box-shadow: none;
	}
</style>
          
        </div>
      
  </div>

  
    <div class="toc-aside">
      <div class="toc-main">
        <div class="toc-aside-title">
          <i class="fa fa-list-ul" aria-hidden="true"></i><span>本文目录</span>
          <div class="toc-open-close">本文目录</div>
        </div>
        <div class="toc-content">
          <link href="/js/tocbot/tocbot.css" rel="stylesheet">
<script src="/js/tocbot/tocbot.min.js"></script>
<div class="toc"></div>

<script>
  if ($('.toc').length > 0) {
    var headerEl = 'h1, h2, h3, h4, h5, h6',  //headers 
      content = '.post-detail',//文章容器
      idArr = {};  //标题数组以确定是否增加索引id
      //add #id

    $(content).children(headerEl).each(function () {
      //去除空格以及多余标点
      var headerId = $(this).text().replace(/[\s|\~|`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\_|\+|\=|\||\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?|\：|\，|\。]/g, '');

      headerId = headerId.toLowerCase();
      if (idArr[headerId]) {
        //id已经存在
        $(this).attr('id', headerId + '-' + idArr[headerId]);
        idArr[headerId]++;
      }
      else {
        //id未存在
        idArr[headerId] = 1;
        $(this).attr('id', headerId);
      }
    });

    tocbot.init({
      // Where to render the table of contents.
      tocSelector: '.toc',
      // Where to grab the headings to build the table of contents.
      contentSelector: content,
      // Which headings to grab inside of the contentSelector element.
      headingSelector: headerEl,
      scrollSmooth: true,
      scrollSmoothOffset: -80,
      headingsOffset: 130,
      positionFixedSelector: '.toc-main',
      positionFixedClass: 'is-position-fixed',
      fixedSidebarOffset: 'auto',
    });
  }

</script>

<style>
.is-position-fixed {
  position:fixed !important;
  top: 64px;
}
.toc-main ul {
  counter-reset: show-list;
}
.toc-main ul li::before {
  content: counter(item)".";
  display: block;
  position: absolute;
  left: 12px;
  top:0;
}
.toc > .toc-list {
  padding-left: 35px;
}
.toc>.toc-list li {
  list-style: decimal;
}
.toc-list {
  padding-left: 25px;
}
</style>
        </div>
      </div>
    </div>

    

    <script>
      let openOrCloseBtn = $('.toc-aside .toc-aside-title .toc-open-close');
      let open = eval('' || 'true');
      openOrCloseBtn.click(function() {
        if (open === true) {
          $(".toc-aside").css({'width': 0, 'padding': 0});
          $(".toc-content").css({'width': 0});
          $(".toc-aside-title span, .toc-aside-title i").css({'display': 'none'});
          $(".main-content").css({'width': '75%', 'margin': '10px auto'});
          open = false;
        } else {
          $(".toc-aside").css({'width': '300px', 'padding': '0 10px'});
          $(".toc-content").css({'width': '300px'});
          $(".toc-aside-title span, .toc-aside-title i").css({'display': 'inline-block'});
          $(".main-content").css({'width': '65%', 'margin-right': '10px', 'margin-left': 'calc(35% - 350px)'});
          open = true;
        }
      });
    </script>
  
</div>


    </main>
    <div class="footer bg-color">
    <div class="footer-main">
        <div class="link">
            <a target="_blank" rel="noopener" href="https://github.com/flyghost/">
                <i class="fa fa-github" aria-hidden="true"></i>
            </a>
            <a href="mailto:1307095684@qq.com">
                <i class="fa fa-envelope-o" aria-hidden="true"></i>
            </a>
            <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1307095684">
                <i class="fa fa-qq" aria-hidden="true"></i>
            </a>
            <a href="/atom.xml" target="_blank">
                <i class="fa fa-rss" aria-hidden="true"></i>
            </a>
        </div>
        <div class="footer-copyright">
            Copyright © 2019 - 2020 <a target="_blank" rel="noopener" href="https://github.com/flyghost">flyghost</a> | Powered by <a href="https://www.creekwater.cn">creekwater</a>
        </div>
        
            
  <!-- 不蒜子统计 -->
  <span id="busuanzi_container_site_pv">
        <i class="fa fa-book" aria-hidden="true"></i>该页面总阅读量：<span id="busuanzi_value_page_pv"></span> 次
  </span>
  <span id="busuanzi_container_site_pv">
        <i class="fa fa-eye" aria-hidden="true"></i>本站点击量：<span id="busuanzi_value_site_pv"></span> 次
  </span>
  <span class="post-meta-divider">|</span>
  <span id="busuanzi_container_site_uv" style='display:none'>
        <i class="fa fa-users" aria-hidden="true"></i>本站访客数：<span id="busuanzi_value_site_uv"></span> 人
  </span>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

                
    </div>
</div>

    
      <div class="goTop top-btn-color border-color">
  <i class="fa fa-arrow-up" aria-hidden="true"></i>
</div>
<script src="/js/goTop.js"></script>
    

    

    <!-- 图片放大 -->
    
      <script src="/js/fancybox/jquery.fancybox.min.js"></script>
    

    <script src="/js/wrapImage.js"></script>
    
    <!-- 爱心点击 -->
    
       
        <script src="/js/cursor/clicklove.js"></script> 
      
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script type="text/javascript" size="100" alpha='0.4' zIndex="-1" src="/js/ribbon.min.js"></script>
    
      <script src="/js/aos/aos.js"></script>
      <script>
        // https://github.com/michalsnik/aos
        const themeOffset = parseInt('120') || 120;
        const themeDelay = parseInt('0')|| 0;
        const themeDuration = parseInt('400') || 400;
        const themeEasing = 'ease' || 'ease';
        const themeOnce = eval('true') || false;
        const themeMirror = eval('false') || false;
        const themeAnchorPlacement = 'top-bottom' || 'top-bottom';
        AOS.init({
          // Global settings:
          disable: false, // accepts following values: 'phone', 'tablet', 'mobile', boolean, expression or function
          startEvent: 'DOMContentLoaded', // name of the event dispatched on the document, that AOS should initialize on
          initClassName: 'aos-init', // class applied after initialization
          animatedClassName: 'aos-animate', // class applied on animation
          useClassNames: false, // if true, will add content of `data-aos` as classes on scroll
          disableMutationObserver: false, // disables automatic mutations' detections (advanced)
          debounceDelay: 50, // the delay on debounce used while resizing window (advanced)
          throttleDelay: 99, // the delay on throttle used while scrolling the page (advanced)

          // Settings that can be overridden on per-element basis, by `data-aos-*` attributes:
          offset: themeOffset, // offset (in px) from the original trigger point
          delay: themeDelay, // values from 0 to 3000, with step 50ms
          duration: themeDuration, // values from 0 to 3000, with step 50ms
          easing: themeEasing, // default easing for AOS animations
          once: themeOnce, // whether animation should happen only once - while scrolling down
          mirror: themeMirror, // whether elements should animate out while scrolling past them
          anchorPlacement: themeAnchorPlacement, // defines which position of the element regarding to window should trigger the animation

        });
      </script>
    

    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.css">
<script src="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.umd.min.js"></script>
<div id="appCopy">
</div>
<script>
  var vm = new Vue({
    el: '#appCopy',
    data: {
    },
    computed: {
    },
    mounted() {
      const that = this;
      //  监听 ctrl + c事件  
      $(document).unbind('keypress').bind('keypress', function (e) {
        if (e.ctrlKey && e.keyCode == 67) {
          doSomething();
          // 返回false, 防止重复触发copy事件  
          return false;
        }
      })

      // 鼠标右键的复制事件  
      $(document).unbind('copy').bind('copy', function (e) {
        doSomething();
        // console.log('右键复制 监听成功');
      });

      function doSomething() {
        that.$notify({
          title: "成功",
          content: "已复制，请遵守相关授权协议。",
          type: 'success'
        })
        // console.log('ctrl + c 监听成功');  
      }
    },
    methods: {
    },
    created() { }
  })
</script>
    

    <!-- 输入框打字特效 -->
    
      <script src="/js/activate-power-mode.js"></script>
      <script>
          POWERMODE.colorful = true;  // 打开随机颜色特效
          POWERMODE.shake = false;    // 关闭输入框抖动
          document.body.addEventListener('input', POWERMODE);//监听打字事件
      </script>
    

    <!-- markdown代码一键复制功能 -->
    <script src="/js/clipboard/clipboard.min.js"></script>
    <script>
      !function (e, t, a) {
        var copy = '复制';
        /* code */
        var initCopyCode = function(){
          var copyHtml = '';
          copyHtml += '<button class="btn-copy" data-clipboard-snippet="" style="position:absolute;top:0;right:0;z-index:1;">';
          copyHtml += '<i class="fa fa-copy"></i><span>' + copy + '</span>';
          copyHtml += '</button>';
          $(".post-detail pre").not('.gutter pre').wrap("<div class='codeBox' style='position:relative;width:100%;'></div>")
          $(".post-detail pre").not('.gutter pre').before(copyHtml);
          new ClipboardJS('.btn-copy', {
              target: function(trigger) {
                  return trigger.nextElementSibling;
              }
          });
        }
        initCopyCode();
      }(window, document);
    </script>

    <script src="/js/lazyload/lazyload@1.9.1.js"></script>
    <script>
      $(function() {
        $("div.lazyload, img.lazyload, a.lazyload").lazyload(
            {
                effect: "fadeIn",
                placeholder: "/medias/loading.gif"    //图片未加载出来时显示的占位图
            }
        );
    });
    </script>
    
    <script src="/js/app.js"></script>
  </body>
</html>